---
title: "Mediation model for social isolation, pro/antisocial behaviours, and ADHD symptoms in childhood"
output:  
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: false
    number_sections: false
    highlight: monochrome
    theme: flatly
    code_folding: hide
    includes:
      after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment = NA,
                      prompt = FALSE,
                      cache = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      results = 'asis')

options(bitmapType = 'quartz') # to render fonts better
```

```{r Clear global environment, include=FALSE}
remove(list = ls())
```

```{r Load packages, include=FALSE}
library(knitr)
library(haven)
library(summarytools)
library(psych)
library(lavaan)
library(tidyverse)
library(dplyr) #conflicts with tidyverse for e.g. rename and row_number
```

```{r source the data file path, include=FALSE}
#source raw data directory: data_raw and data included
source("../isolation_ADHD_data_path.R")
```

```{r read in dta data file}
dat.raw <- read_dta(paste0(data.raw_path, "Katie_10Mar22.dta"))
colnames(dat.raw)

dat <- dat.raw %>%
  dplyr::select(id = atwinid,
         sampsex,
         seswq35,
         sisoem5,  # social isolation mother report
         sisoem7,
         sisoem10,
         sisoem12,
         sisoet5,    # social isolation teacher report
         sisoet7, 
         sisoet10,
         sisoet12,
         sisoe5,    # social isolation teacher report
         sisoe7, 
         sisoe10,
         sisoe12,
         tadhdem5,   # total ADHD mother report
         tadhdem7,
         tadhdem10,
         tadhdem12,
         tadhdet5,   # total ADHD teacher report
         tadhdet7,
         tadhdet10,
         tadhdet12,
         hyem5,      # hyperactivity ADHD mother report
         hyem7,
         hyem10,
         hyem12, 
         hyet5,      # hyperactivity ADHD teacher report
         hyet7,
         hyet10,
         hyet12,
         inem5,     # inattention ADHD mother report
         inem7,
         inem10,
         inem12,
         inet5,     # inattention ADHD teacher report
         inet7,
         inet10,
         inet12,
         proem5,    # prosocial total scores mother report
         proem7,
         proem10,
         proem12, 
         proet5,    # prosocial total scores teacher report
         proet7,
         proet10,
         proet12, 
         asbem5,   # antisocial total scores mother report
         asbem7,
         asbem10,
         asbem12, 
         asbet5,   # antisocial total scores teacher report
         asbet7,
         asbet10,
         asbet12
  )

colnames(dat)
```

***

```{r functions}
# Table of model fit 
table.model.fit <- function(model){
  model.fit <- as.data.frame(t(as.data.frame(model$FIT))) %>%
    dplyr::select(chisq, df, chisq.scaled, cfi.robust, tli.robust, rmsea.robust, rmsea.ci.lower.robust, rmsea.ci.upper.robust, srmr) 
  return(model.fit)
}

# Table of regression and correlation (standardised covariance) coefficients
table.model.coef <- function(model, step){
  if (step == "S1"){
    model.coef <- as.tibble(model$PE[c(1:27,64:67),]) %>% dplyr::select(-exo, -std.lv, -std.nox)
    return(model.coef)
  } else if(step == "S2"){
    model.coef <- as.tibble(model$PE[c(1:27,64,65),]) %>% dplyr::select(-exo, -std.lv, -std.nox)
    return(model.coef)
  } else if(step == "S3"){
    model.coef <- as.tibble(model$PE[c(25:51,121:124),]) %>% dplyr::select(-exo, -std.lv, -std.nox)
    return(model.coef)
  } else if(step == "S4"){
    model.coef <- as.tibble(model$PE[c(25:51,121,122),]) %>% dplyr::select(-exo, -std.lv, -std.nox)
    return(model.coef)
  } else {model.coef <- NULL}
}
```

***

**For all mediation analyses we will use mother and teacher report combined scores. Models will then be split into total ADHD score, hyperactivity, and inattention.**

# Variable creation

Before running the mediation models, we need to create several variables:
* Combined (averaged) parent and teacher report for total ADHD, hyperactivity, and inattention at each age
* Combined (averaged) parent and teacher report for prosocial behaviour at each age
* Combined (averaged) parent and teacher report for antisocial behaviour at each age

## Combined report ADHD variables

```{r create combined total adhd variables}
# age 5
dat <- dat %>%
  mutate(tadhde5 = 
           case_when(
             is.na(tadhdem5) & is.na(tadhdet5) ~ NA_real_,
             is.na(tadhdem5) & !is.na(tadhdet5) ~ as.numeric(tadhdet5),
             is.na(tadhdet5) & !is.na(tadhdem5) ~ as.numeric(tadhdem5),
             !is.na(tadhdem5) & !is.na(tadhdet5) ~ as.numeric(rowMeans(across(.cols = c(tadhdem5,tadhdet5)))))
  )
# age 7
dat <- dat %>%
  mutate(tadhde7 = 
           case_when(
             is.na(tadhdem7) & is.na(tadhdet7) ~ NA_real_,
             is.na(tadhdem7) & !is.na(tadhdet7) ~ as.numeric(tadhdet7),
             is.na(tadhdet7) & !is.na(tadhdem7) ~ as.numeric(tadhdem7),
             !is.na(tadhdem7) & !is.na(tadhdet7) ~ as.numeric(rowMeans(across(.cols = c(tadhdem7,tadhdet7)))))
  )
# age 10
dat <- dat %>%
  mutate(tadhde10 = 
           case_when(
             is.na(tadhdem10) & is.na(tadhdet10) ~ NA_real_,
             is.na(tadhdem10) & !is.na(tadhdet10) ~ as.numeric(tadhdet10),
             is.na(tadhdet10) & !is.na(tadhdem10) ~ as.numeric(tadhdem10),
             !is.na(tadhdem10) & !is.na(tadhdet10) ~ as.numeric(rowMeans(across(.cols = c(tadhdem10,tadhdet10)))))
  )
# age 12
dat <- dat %>%
  mutate(tadhde12 = 
           case_when(
             is.na(tadhdem12) & is.na(tadhdet12) ~ NA_real_,
             is.na(tadhdem12) & !is.na(tadhdet12) ~ as.numeric(tadhdet12),
             is.na(tadhdet12) & !is.na(tadhdem12) ~ as.numeric(tadhdem12),
             !is.na(tadhdem12) & !is.na(tadhdet12) ~ as.numeric(rowMeans(across(.cols = c(tadhdem12,tadhdet12)))))
  )
```

```{r create combined hyperactivity adhd variables}
# age 5
dat <- dat %>%
  mutate(hye5 = 
           case_when(
             is.na(hyem5) & is.na(hyet5) ~ NA_real_,
             is.na(hyem5) & !is.na(hyet5) ~ as.numeric(hyet5),
             is.na(hyet5) & !is.na(hyem5) ~ as.numeric(hyem5),
             !is.na(hyem5) & !is.na(hyet5) ~ as.numeric(rowMeans(across(.cols = c(hyem5,hyet5)))))
  )
# age 7
dat <- dat %>%
  mutate(hye7 = 
           case_when(
             is.na(hyem7) & is.na(hyet7) ~ NA_real_,
             is.na(hyem7) & !is.na(hyet7) ~ as.numeric(hyet7),
             is.na(hyet7) & !is.na(hyem7) ~ as.numeric(hyem7),
             !is.na(hyem7) & !is.na(hyet7) ~ as.numeric(rowMeans(across(.cols = c(hyem7,hyet7)))))
  )
# age 10
dat <- dat %>%
  mutate(hye10 = 
           case_when(
             is.na(hyem10) & is.na(hyet10) ~ NA_real_,
             is.na(hyem10) & !is.na(hyet10) ~ as.numeric(hyet10),
             is.na(hyet10) & !is.na(hyem10) ~ as.numeric(hyem10),
             !is.na(hyem10) & !is.na(hyet10) ~ as.numeric(rowMeans(across(.cols = c(hyem10,hyet10)))))
  )
# age 12
dat <- dat %>%
  mutate(hye12 = 
           case_when(
             is.na(hyem12) & is.na(hyet12) ~ NA_real_,
             is.na(hyem12) & !is.na(hyet12) ~ as.numeric(hyet12),
             is.na(hyet12) & !is.na(hyem12) ~ as.numeric(hyem12),
             !is.na(hyem12) & !is.na(hyet12) ~ as.numeric(rowMeans(across(.cols = c(hyem12,hyet12)))))
  )
```

```{r create combined inattention adhd variables}
# age 5
dat <- dat %>%
  mutate(ine5 = 
           case_when(
             is.na(inem5) & is.na(inet5) ~ NA_real_,
             is.na(inem5) & !is.na(inet5) ~ as.numeric(inet5),
             is.na(inet5) & !is.na(inem5) ~ as.numeric(inem5),
             !is.na(inem5) & !is.na(inet5) ~ as.numeric(rowMeans(across(.cols = c(inem5,inet5)))))
  )
# age 7
dat <- dat %>%
  mutate(ine7 = 
           case_when(
             is.na(inem7) & is.na(inet7) ~ NA_real_,
             is.na(inem7) & !is.na(inet7) ~ as.numeric(inet7),
             is.na(inet7) & !is.na(inem7) ~ as.numeric(inem7),
             !is.na(inem7) & !is.na(inet7) ~ as.numeric(rowMeans(across(.cols = c(inem7,inet7)))))
  )
# age 10
dat <- dat %>%
  mutate(ine10 = 
           case_when(
             is.na(inem10) & is.na(inet10) ~ NA_real_,
             is.na(inem10) & !is.na(inet10) ~ as.numeric(inet10),
             is.na(inet10) & !is.na(inem10) ~ as.numeric(inem10),
             !is.na(inem10) & !is.na(inet10) ~ as.numeric(rowMeans(across(.cols = c(inem10,inet10)))))
  )
# age 12
dat <- dat %>%
  mutate(ine12 = 
           case_when(
             is.na(inem12) & is.na(inet12) ~ NA_real_,
             is.na(inem12) & !is.na(inet12) ~ as.numeric(inet12),
             is.na(inet12) & !is.na(inem12) ~ as.numeric(inem12),
             !is.na(inem12) & !is.na(inet12) ~ as.numeric(rowMeans(across(.cols = c(inem12,inet12)))))
  )
```

## Combined report prosocial variables

```{r create combined report prosocial variables }
# age 5
dat <- dat %>%
  mutate(proe5 = 
           case_when(
             is.na(proem5) & is.na(proet5) ~ NA_real_,
             is.na(proem5) & !is.na(proet5) ~ as.numeric(proet5),
             is.na(proet5) & !is.na(proem5) ~ as.numeric(proem5),
             !is.na(proem5) & !is.na(proet5) ~ as.numeric(rowMeans(across(.cols = c(proem5,proet5)))))
  )
# age 7
dat <- dat %>%
  mutate(proe7 = 
           case_when(
             is.na(proem7) & is.na(proet7) ~ NA_real_,
             is.na(proem7) & !is.na(proet7) ~ as.numeric(proet7),
             is.na(proet7) & !is.na(proem7) ~ as.numeric(proem7),
             !is.na(proem7) & !is.na(proet7) ~ as.numeric(rowMeans(across(.cols = c(proem7,proet7)))))
  )
# age 10
dat <- dat %>%
  mutate(proe10 = 
           case_when(
             is.na(proem10) & is.na(proet10) ~ NA_real_,
             is.na(proem10) & !is.na(proet10) ~ as.numeric(proet10),
             is.na(proet10) & !is.na(proem10) ~ as.numeric(proem10),
             !is.na(proem10) & !is.na(proet10) ~ as.numeric(rowMeans(across(.cols = c(proem10,proet10)))))
  )
# age 12
dat <- dat %>%
  mutate(proe12 = 
           case_when(
             is.na(proem12) & is.na(proet12) ~ NA_real_,
             is.na(proem12) & !is.na(proet12) ~ as.numeric(proet12),
             is.na(proet12) & !is.na(proem12) ~ as.numeric(proem12),
             !is.na(proem12) & !is.na(proet12) ~ as.numeric(rowMeans(across(.cols = c(proem12,proet12)))))
  )
```

## Combined report antisocial variables

```{r create combined report asbsocial variables }
# age 5
dat <- dat %>%
  mutate(asbe5 = 
           case_when(
             is.na(asbem5) & is.na(asbet5) ~ NA_real_,
             is.na(asbem5) & !is.na(asbet5) ~ as.numeric(asbet5),
             is.na(asbet5) & !is.na(asbem5) ~ as.numeric(asbem5),
             !is.na(asbem5) & !is.na(asbet5) ~ as.numeric(rowMeans(across(.cols = c(asbem5,asbet5)))))
  )
# age 7
dat <- dat %>%
  mutate(asbe7 = 
           case_when(
             is.na(asbem7) & is.na(asbet7) ~ NA_real_,
             is.na(asbem7) & !is.na(asbet7) ~ as.numeric(asbet7),
             is.na(asbet7) & !is.na(asbem7) ~ as.numeric(asbem7),
             !is.na(asbem7) & !is.na(asbet7) ~ as.numeric(rowMeans(across(.cols = c(asbem7,asbet7)))))
  )
# age 10
dat <- dat %>%
  mutate(asbe10 = 
           case_when(
             is.na(asbem10) & is.na(asbet10) ~ NA_real_,
             is.na(asbem10) & !is.na(asbet10) ~ as.numeric(asbet10),
             is.na(asbet10) & !is.na(asbem10) ~ as.numeric(asbem10),
             !is.na(asbem10) & !is.na(asbet10) ~ as.numeric(rowMeans(across(.cols = c(asbem10,asbet10)))))
  )
# age 12
dat <- dat %>%
  mutate(asbe12 = 
           case_when(
             is.na(asbem12) & is.na(asbet12) ~ NA_real_,
             is.na(asbem12) & !is.na(asbet12) ~ as.numeric(asbet12),
             is.na(asbet12) & !is.na(asbem12) ~ as.numeric(asbem12),
             !is.na(asbem12) & !is.na(asbet12) ~ as.numeric(rowMeans(across(.cols = c(asbem12,asbet12)))))
  )
```

# Correlations between all variables

```{r create data frame for correlation matrix}
# items 
items <- c("proe5",
           "asbe5",
           "proe7",
           "asbe7",
           "proe10",
           "asbe10",
           "proe12",
           "asbe12",
           "proem5",
           "asbem5",
           "proem7",
           "asbem7",
           "proem10",
           "asbem10",
           "proem12",
           "asbem12",
           "proet5",
           "asbet5",
           "proet7",
           "asbet7",
           "proet10",
           "asbet10",
           "proet12",
           "asbet12")

# create data frame
items.df <- as.data.frame(dat[,items])
is.data.frame(items.df)  #check 

colnames(items.df) <- c("Combined Prosocial behaviour age 5",
                        "Combined Antisocial behaviour age 5",
                        "Combined Prosocial behaviour age 7",
                        "Combined Antisocial behaviour age 7",
                        "Combined Prosocial behaviour age 10",
                        "Combined Antisocial behaviour age 10",
                        "Combined Prosocial behaviour age 12",
                        "Combined Antisocial behaviour age 12",
                        "Mother Prosocial behaviour age 5",
                        "Mother Antisocial behaviour age 5",
                        "Mother Prosocial behaviour age 7",
                        "Mother Antisocial behaviour age 7",
                        "Mother Prosocial behaviour age 10",
                        "Mother Antisocial behaviour age 10",
                        "Mother Prosocial behaviour age 12",
                        "Mother Antisocial behaviour age 12",
                        "Teacher Prosocial behaviour age 5",
                        "Teacher Antisocial behaviour age 5",
                        "Teacher Prosocial behaviour age 7",
                        "Teacher Antisocial behaviour age 7",
                        "Teacher Prosocial behaviour age 10",
                        "Teacher Antisocial behaviour age 10",
                        "Teacher Prosocial behaviour age 12",
                        "Teacher Antisocial behaviour age 12"
                        )
```

```{r correlation matrix for factor scores and sum scores}
item.cor.matrix <- cor(items.df, 
                       method = "pearson", 
                       use = "pairwise.complete.obs")

as.data.frame(item.cor.matrix) %>% mutate_if(is.numeric, round, 2)

as.data.frame(item.cor.matrix) %>% mutate_if(is.numeric, round, 2) %>% select(`Mother Antisocial behaviour age 12`)
```

# Full (four time points) longitudinal mediation - combined parent and teacher report

**For each set of ADHD symptoms, we present four models for each mediator (prosocial/antisocial behvaiour):**
 * Step 1: CLPM mediation model - rather than two variables, we now have three and can calculate the mediation path 
 * Step 2: Constrained CLPM mediation model - crosslags will be constrained over time
 * Step 3: RICLPM mediation model - add in random intercepts to create a three variable RI-CLPM where the mediation path is calculated whilst accounting for between person differences
 * Step 4: Constrained RI-CLPM mediation model - crosslags will be constrained over time. 
 
We have established the direction of the association - ADHD predicts later social isolation. Therefore the two mediator paths are (for example): 1. `proem7 ~ a1*tadhdem5` and `sisoem10 ~ b1*proem7`, 2. `proem10 ~ a2*tadhdem7` and `sisoem12 ~ b2*proem10`. This indirect mediation effect is then calculated using `indirect1 := a*b`. Using the constrained model, the two mediation paths will also be constrained to be equal, resulting in one a*b path. 

To test the bidirectional mediation, we also calculated the mediator path (for example): 1. `proem7 ~ c1*sisoem5` and `tadhdem10 ~ d1*proem7`, 2. `proem10 ~ c2*sisoem7` and `tadhdem12 ~ d2*proem10`. This indirect mediation effect is then calculated using `indirect2 := c*d`.
                              
Our code could be synthesized further by combining regression paths, however aid clarity of which paths have been estimated all path coefficients are written out in full.

The "direct c paths" have not been estimated here. Therefore, for all models, the effects from age 5 have to go through age 7/10 and are not directly associated with age 12. 

Model notation is as follows: 
* med = mediation model
* long = longitudinal
* pro = prosocial
* asb = antisocial 
* hyp = hyperactivity 
* inat = inattention
* ri = random intercepts

## Prosocial behaviour

### Total ADHD symptoms 

#### Step 1. The full CLPM mediation model

```{r med.long.pro}
med.long.pro <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoe7 ~ sisoe5
                  sisoe10 ~ sisoe7
                  sisoe12 ~ sisoe10
                  ## Pro social bahviour
                  proe7 ~ proe5
                  proe10 ~ proe7
                  proe12 ~ proe10
                  ## ADHD
                  tadhde7 ~ tadhde5
                  tadhde10 ~ tadhde7
                  tadhde12 ~ tadhde10

                  ###### Cross lag paths ######
                  ## Isolation
                  tadhde7 ~ sisoe5
                  tadhde10 ~ sisoe7
                  tadhde12 ~ sisoe10
                  ## ADHD
                  sisoe7 ~ tadhde5
                  sisoe10 ~ tadhde7
                  sisoe12 ~ tadhde10
                  ## Prosocial
                  sisoe7 ~ proe5
                  tadhde7 ~ proe5
                  proe12 ~ sisoe10
                  proe12 ~ tadhde10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proe7 ~ a1*tadhde5 
                  sisoe10 ~ b1*proe7
                  proe10 ~ a2*tadhde7 
                  sisoe12 ~ b2*proe10
                  ## Isolation to ADHD
                  proe7 ~ c1*sisoe5
                  tadhde10 ~ d1*proe7
                  proe10 ~ c2*sisoe7
                  tadhde12 ~ d2*proe10

                  ###### Covariances ######
                  sisoe5 ~~ proe5
                  proe5 ~~ tadhde5
                  sisoe5 ~~ tadhde5
                  sisoe7 ~~ proe7
                  proe7 ~~ tadhde7
                  sisoe7 ~~ tadhde7
                  sisoe10 ~~ proe10
                  proe10 ~~ tadhde10
                  sisoe10 ~~ tadhde10
                  sisoe12 ~~ proe12
                  proe12 ~~ tadhde12
                  sisoe12 ~~ tadhde12
                    
                  ###### Variances ######
                  ## Variances
                  tadhde5 ~~ tadhde5 
                  sisoe5 ~~ sisoe5 
                  proe5 ~~ proe5
                  ## Residual variances
                  tadhde7 ~~ tadhde7 
                  sisoe7 ~~ sisoe7 
                  proe7 ~~ proe7
                  tadhde10 ~~ tadhde10 
                  sisoe10 ~~ sisoe10 
                  proe10 ~~ proe10
                  tadhde12 ~~ tadhde12 
                  sisoe12 ~~ sisoe12
                  proe12 ~~ proe12

                  ###### Indirect effects (a*b) ######
                  indirect1a := a1*b1
                  indirect1b := a2*b2
                  indirect2a := c1*d1
                  indirect2b := c2*d2
         '
```

```{r  fit med.long.pro}
med.long.pro.fit <- lavaan(model = med.long.pro, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long.pro.fit.summary <- summary(med.long.pro.fit, standardized = TRUE, fit.measures = TRUE)
```

#### Step 2. Constrained full CLPM mediation model

```{r med.long2.pro}
med.long2.pro <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoe7 ~ sisoe5
                  sisoe10 ~ sisoe7
                  sisoe12 ~ sisoe10
                  ## Pro social bahviour
                  proe7 ~ proe5
                  proe10 ~ proe7
                  proe12 ~ proe10
                  ## ADHD
                  tadhde7 ~ tadhde5
                  tadhde10 ~ tadhde7
                  tadhde12 ~ tadhde10

                  ###### Cross lag paths ######
                  ## Isolation
                  tadhde7 ~ e*sisoe5
                  tadhde10 ~ e*sisoe7
                  tadhde12 ~ e*sisoe10
                  ## ADHD
                  sisoe7 ~ f*tadhde5
                  sisoe10 ~ f*tadhde7
                  sisoe12 ~ f*tadhde10
                  ## Prosocial
                  sisoe7 ~ b*proe5
                  tadhde7 ~ d*proe5
                  proe12 ~ c*sisoe10
                  proe12 ~ a*tadhde10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proe7 ~ a*tadhde5 
                  sisoe10 ~ b*proe7
                  proe10 ~ a*tadhde7 
                  sisoe12 ~ b*proe10
                  ## Isolation to ADHD
                  proe7 ~ c*sisoe5
                  tadhde10 ~ d*proe7
                  proe10 ~ c*sisoe7
                  tadhde12 ~ d*proe10

                  ###### Covariances ######
                  sisoe5 ~~ proe5
                  proe5 ~~ tadhde5
                  sisoe5 ~~ tadhde5
                  sisoe7 ~~ proe7
                  proe7 ~~ tadhde7
                  sisoe7 ~~ tadhde7
                  sisoe10 ~~ proe10
                  proe10 ~~ tadhde10
                  sisoe10 ~~ tadhde10
                  sisoe12 ~~ proe12
                  proe12 ~~ tadhde12
                  sisoe12 ~~ tadhde12
                    
                  ###### Variances ######
                  ## Variances
                  tadhde5 ~~ tadhde5 
                  sisoe5 ~~ sisoe5 
                  proe5 ~~ proe5
                  ## Residual variances
                  tadhde7 ~~ tadhde7 
                  sisoe7 ~~ sisoe7 
                  proe7 ~~ proe7
                  tadhde10 ~~ tadhde10 
                  sisoe10 ~~ sisoe10 
                  proe10 ~~ proe10
                  tadhde12 ~~ tadhde12 
                  sisoe12 ~~ sisoe12
                  proe12 ~~ proe12

                  ###### Indirect effects (a*b) ######
                  indirect1 := a*b
                  indirect2 := c*d
         '
```

```{r  fit med.long.pro}
med.long2.pro.fit <- lavaan(model = med.long2.pro, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long2.pro.fit.summary <- summary(med.long2.pro.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med.long.pro.fit and med.long2.pro.fit}
lavTestLRT(med.long.pro.fit, med.long2.pro.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.5204). Therefore this model 2 will be carried forward.

```{r results table for mother report prosocial and total adhd}
# Model fit 
med.long2.pro.fit.summary.fit <- table.model.fit(med.long2.pro.fit.summary)
# Coefficients
med.long2.pro.fit.summary.reg <- table.model.coef(model = med.long2.pro.fit.summary, step = "S2") %>% mutate_if(is.numeric, round, 3)

med.long2.pro.fit.summary.reg %>%
  select(lhs, op, rhs, label, std.all, pvalue)
```

#### Step 3. The full RI-CLPM mediation model 

```{r ri.med.long.pro.full}
ri.med.long.pro.full <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhde5 + 1*tadhde7 + 1*tadhde10 + 1*tadhde12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIpro =~ 1*proe5 + 1*proe7 + 1*proe10  + 1*proe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*tadhde5
                  wad7 =~ 1*tadhde7
                  wad10 =~ 1*tadhde10
                  wad12 =~ 1*tadhde12
                  ## Prosocial 
                  wpro5 =~ 1*proe5
                  wpro7 =~ 1*proe7
                  wpro10 =~ 1*proe10
                  wpro12 =~ 1*proe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## Pro social bahviour
                  wpro7 ~ wpro5
                  wpro10 ~ wpro7
                  wpro12 ~ wpro10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ wsi5
                  wad10 ~ wsi7
                  wad12 ~ wsi10
                  ## ADHD
                  wsi7 ~ wad5
                  wsi10 ~ wad7
                  wsi12 ~ wad10
                  ## Prosocial
                  wsi7 ~ wpro5
                  wad7 ~ wpro5
                  wpro12 ~ wsi10
                  wpro12 ~ wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro7 ~ a1*wad5 
                  wsi10 ~ b1*wpro7
                  wpro10 ~ a2*wad7 
                  wsi12 ~ b2*wpro10
                  ## Isolation to ADHD
                  wpro7 ~ wsi5
                  wad10 ~ wpro7
                  wpro10 ~ wsi7
                  wad12 ~ wpro10
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wpro7
                  wpro7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wpro10
                  wpro10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wpro7 ~~ wpro7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wpro10 ~~ wpro10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect1 := a1*b1
                  indirect2 := a2*b2
         '
```

```{r fit ri.med.long.pro.full}
ri.med.long.pro.full.fit <- lavaan(model = ri.med.long.pro.full, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long.pro.full.fit.summary <- summary(ri.med.long.pro.full.fit, standardized = TRUE, fit.measures = TRUE)
```

#### Step 4. Constrained full cross-lag RI-CLPM mediation model 

```{r ri.med.long4.pro}
ri.med.long.pro.full2 <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhde5 + 1*tadhde7 + 1*tadhde10 + 1*tadhde12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIpro =~ 1*proe5 + 1*proe7 + 1*proe10  + 1*proe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*tadhde5
                  wad7 =~ 1*tadhde7
                  wad10 =~ 1*tadhde10
                  wad12 =~ 1*tadhde12
                  ## Prosocial 
                  wpro5 =~ 1*proe5
                  wpro7 =~ 1*proe7
                  wpro10 =~ 1*proe10
                  wpro12 =~ 1*proe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## Pro social bahviour
                  wpro7 ~ wpro5
                  wpro10 ~ wpro7
                  wpro12 ~ wpro10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ e*wsi5
                  wad10 ~ e*wsi7
                  wad12 ~ e*wsi10
                  ## ADHD
                  wsi7 ~ f*wad5
                  wsi10 ~ f*wad7
                  wsi12 ~ f*wad10
                  ## Prosocial
                  wsi7 ~ b*wpro5
                  wad7 ~ d*wpro5
                  wpro12 ~ c*wsi10
                  wpro12 ~ a*wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro7 ~ a*wad5 
                  wsi10 ~ b*wpro7
                  wpro10 ~ a*wad7 
                  wsi12 ~ b*wpro10
                  ## Isolation to ADHD
                  wpro7 ~ c*wsi5
                  wad10 ~ d*wpro7
                  wpro10 ~ c*wsi7
                  wad12 ~ d*wpro10
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wpro7
                  wpro7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wpro10
                  wpro10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wpro7 ~~ wpro7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wpro10 ~~ wpro10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect1 := a*b
                  indirect2 := c*d
                  indirect3 := d*f
         '
```

```{r fit ri.med.long.pro.full2}
ri.med.long.pro.full2.fit <- lavaan(model = ri.med.long.pro.full2, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long.pro.full2.fit.summary <- summary(ri.med.long.pro.full2.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med.long.pro.fit and ri.med.long4a.pro.fit}
lavTestLRT(ri.med.long.pro.full.fit, ri.med.long.pro.full2.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.4722). 

```{r results table for random intercept mother report prosocial and total adhd}
# Model fit 
ri.med.long.pro.full2.fit.summary.fit <- table.model.fit(ri.med.long.pro.full2.fit.summary)
# Coefficients -
ri.med.long.pro.full2.fit.summary.reg <- table.model.coef(model = ri.med.long.pro.full2.fit.summary, step = "S4") %>% mutate_if(is.numeric, round, 3)

ri.med.long.pro.full2.fit.summary.reg %>%
  select(lhs, op, rhs, label, std.all, pvalue) %>%
  filter(lhs == "indirect1" | lhs == "indirect2" | lhs == "indirect3")
```

### Hyperactivity 

#### Step 1. The full CLPM mediation model

```{r med_hyp.long.pro}
med_hyp.long.pro <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoe7 ~ sisoe5
                  sisoe10 ~ sisoe7
                  sisoe12 ~ sisoe10
                  ## Pro social bahviour
                  proe7 ~ proe5
                  proe10 ~ proe7
                  proe12 ~ proe10
                  ## ADHD
                  hye7 ~ hye5
                  hye10 ~ hye7
                  hye12 ~ hye10

                  ###### Cross lag paths ######
                  ## Isolation
                  hye7 ~ sisoe5
                  hye10 ~ sisoe7
                  hye12 ~ sisoe10
                  ## ADHD
                  sisoe7 ~ hye5
                  sisoe10 ~ hye7
                  sisoe12 ~ hye10
                  ## Prosocial
                  sisoe7 ~ proe5
                  hye7 ~ proe5
                  proe12 ~ sisoe10
                  proe12 ~ hye10
                  
                  ###### mediation paths ######
                  ## ADHD to Isolation
                  proe7 ~ a1*hye5 
                  sisoe10 ~ b1*proe7
                  proe10 ~ a2*hye7 
                  sisoe12 ~ b2*proe10
                  ## Isolation to ADHD
                  proe7 ~ c1*sisoe5
                  hye10 ~ d1*proe7
                  proe10 ~ c2*sisoe7
                  hye12 ~ d2*proe10

                  ###### Covariances ######
                  sisoe5 ~~ proe5
                  proe5 ~~ hye5
                  sisoe5 ~~ hye5
                  sisoe7 ~~ proe7
                  proe7 ~~ hye7
                  sisoe7 ~~ hye7
                  sisoe10 ~~ proe10
                  proe10 ~~ hye10
                  sisoe10 ~~ hye10
                  sisoe12 ~~ proe12
                  proe12 ~~ hye12
                  sisoe12 ~~ hye12
                    
                  ###### Variances ######
                  ## Variances
                  hye5 ~~ hye5 
                  sisoe5 ~~ sisoe5 
                  proe5 ~~ proe5
                  ## Residual variances
                  hye7 ~~ hye7 
                  sisoe7 ~~ sisoe7 
                  proe7 ~~ proe7
                  hye10 ~~ hye10 
                  sisoe10 ~~ sisoe10 
                  proe10 ~~ proe10
                  hye12 ~~ hye12 
                  sisoe12 ~~ sisoe12
                  proe12 ~~ proe12

                  ###### Indirect effects (a*b) ######
                  indirect1a := a1*b1
                  indirect1b := a2*b2
                  indirect2a := c1*d1
                  indirect2b := c2*d2
         '
```

```{r  fit med_hyp.long.pro}
med_hyp.long.pro.fit <- lavaan(model = med_hyp.long.pro, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long.pro.fit.summary <- summary(med_hyp.long.pro.fit, standardized = TRUE, fit.measures = TRUE)
```

#### Step 2. Constrained full CLPM mediation model

```{r med_hyp.long2.pro}
med_hyp.long2.pro <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoe7 ~ sisoe5
                  sisoe10 ~ sisoe7
                  sisoe12 ~ sisoe10
                  ## Pro social bahviour
                  proe7 ~ proe5
                  proe10 ~ proe7
                  proe12 ~ proe10
                  ## ADHD
                  hye7 ~ hye5
                  hye10 ~ hye7
                  hye12 ~ hye10

                  ###### Cross lag paths ######
                  ## Isolation
                  hye7 ~ e*sisoe5
                  hye10 ~ e*sisoe7
                  hye12 ~ e*sisoe10
                  ## ADHD
                  sisoe7 ~ f*hye5
                  sisoe10 ~ f*hye7
                  sisoe12 ~ f*hye10
                  ## Prosocial
                  sisoe7 ~ b*proe5
                  hye7 ~ d*proe5
                  proe12 ~ c*sisoe10
                  proe12 ~ a*hye10
                  
                  ###### mediation paths ######
                  ## ADHD to Isolation
                  proe7 ~ a*hye5 
                  sisoe10 ~ b*proe7
                  proe10 ~ a*hye7 
                  sisoe12 ~ b*proe10
                  ## Isolation to ADHD
                  proe7 ~ c*sisoe5
                  hye10 ~ d*proe7
                  proe10 ~ c*sisoe7
                  hye12 ~ d*proe10

                  ###### Covariances ######
                  sisoe5 ~~ proe5
                  proe5 ~~ hye5
                  sisoe5 ~~ hye5
                  sisoe7 ~~ proe7
                  proe7 ~~ hye7
                  sisoe7 ~~ hye7
                  sisoe10 ~~ proe10
                  proe10 ~~ hye10
                  sisoe10 ~~ hye10
                  sisoe12 ~~ proe12
                  proe12 ~~ hye12
                  sisoe12 ~~ hye12
                    
                  ###### Variances ######
                  ## Variances
                  hye5 ~~ hye5 
                  sisoe5 ~~ sisoe5 
                  proe5 ~~ proe5
                  ## Residual variances
                  hye7 ~~ hye7 
                  sisoe7 ~~ sisoe7 
                  proe7 ~~ proe7
                  hye10 ~~ hye10 
                  sisoe10 ~~ sisoe10 
                  proe10 ~~ proe10
                  hye12 ~~ hye12 
                  sisoe12 ~~ sisoe12
                  proe12 ~~ proe12

                  ###### Indirect effects (a*b) ######
                  indirect1 := a*b
                  indirect2 := c*d
         '
```

```{r  fit med_hyp.long.pro}
med_hyp.long2.pro.fit <- lavaan(model = med_hyp.long2.pro, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long2.pro.fit.summary <- summary(med_hyp.long2.pro.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_hyp.long.pro.fit and med_hyp.long2.pro.fit}
lavTestLRT(med_hyp.long.pro.fit, med_hyp.long2.pro.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.3275). Therefore this model 2 will be carried forward.

```{r results table for mother report prosocial and total adhd}
# Model fit 
med_hyp.long2.pro.fit.summary.fit <- table.model.fit(med_hyp.long2.pro.fit.summary)
# Coefficients
med_hyp.long2.pro.fit.summary.reg <- table.model.coef(model = med_hyp.long2.pro.fit.summary, step = "S2") %>% mutate_if(is.numeric, round, 3)

med_hyp.long2.pro.fit.summary.reg %>%
  select(lhs, op, rhs, label, std.all, pvalue)
```

#### Step 3. The full RI-CLPM mediation model 

```{r ri.med_hyp.long.pro.full}
ri.med_hyp.long.pro.full <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hye5 + 1*hye7 + 1*hye10 + 1*hye12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIpro =~ 1*proe5 + 1*proe7 + 1*proe10  + 1*proe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*hye5
                  wad7 =~ 1*hye7
                  wad10 =~ 1*hye10
                  wad12 =~ 1*hye12
                  ## Prosocial 
                  wpro5 =~ 1*proe5
                  wpro7 =~ 1*proe7
                  wpro10 =~ 1*proe10
                  wpro12 =~ 1*proe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## Pro social bahviour
                  wpro7 ~ wpro5
                  wpro10 ~ wpro7
                  wpro12 ~ wpro10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ wsi5
                  wad10 ~ wsi7
                  wad12 ~ wsi10
                  ## ADHD
                  wsi7 ~ wad5
                  wsi10 ~ wad7
                  wsi12 ~ wad10
                  ## Prosocial
                  wsi7 ~ wpro5
                  wad7 ~ wpro5
                  wpro12 ~ wsi10
                  wpro12 ~ wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro7 ~ a1*wad5 
                  wsi10 ~ b1*wpro7
                  wpro10 ~ a2*wad7 
                  wsi12 ~ b2*wpro10
                  ## Isolation to ADHD
                  wpro7 ~ wsi5
                  wad10 ~ wpro7
                  wpro10 ~ wsi7
                  wad12 ~ wpro10
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wpro7
                  wpro7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wpro10
                  wpro10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wpro7 ~~ wpro7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wpro10 ~~ wpro10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect1 := a1*b1
                  indirect2 := a2*b2
         '
```

```{r fit ri.med_hyp.long.pro.full}
ri.med_hyp.long.pro.full.fit <- lavaan(model = ri.med_hyp.long.pro.full, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long.pro.full.fit.summary <- summary(ri.med_hyp.long.pro.full.fit, standardized = TRUE, fit.measures = TRUE)
```

#### Step 4. Constrained full cross-lag RI-CLPM mediation model 

```{r ri.med_hyp.long4.pro}
ri.med_hyp.long.pro.full2 <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hye5 + 1*hye7 + 1*hye10 + 1*hye12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIpro =~ 1*proe5 + 1*proe7 + 1*proe10  + 1*proe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*hye5
                  wad7 =~ 1*hye7
                  wad10 =~ 1*hye10
                  wad12 =~ 1*hye12
                  ## Prosocial 
                  wpro5 =~ 1*proe5
                  wpro7 =~ 1*proe7
                  wpro10 =~ 1*proe10
                  wpro12 =~ 1*proe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## Pro social bahviour
                  wpro7 ~ wpro5
                  wpro10 ~ wpro7
                  wpro12 ~ wpro10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ e*wsi5
                  wad10 ~ e*wsi7
                  wad12 ~ e*wsi10
                  ## ADHD
                  wsi7 ~ f*wad5
                  wsi10 ~ f*wad7
                  wsi12 ~ f*wad10
                  ## Prosocial
                  wsi7 ~ b*wpro5
                  wad7 ~ d*wpro5
                  wpro12 ~ c*wsi10
                  wpro12 ~ a*wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro7 ~ a*wad5 
                  wsi10 ~ b*wpro7
                  wpro10 ~ a*wad7 
                  wsi12 ~ b*wpro10
                  ## Isolation to ADHD
                  wpro7 ~ c*wsi5
                  wad10 ~ d*wpro7
                  wpro10 ~ c*wsi7
                  wad12 ~ d*wpro10
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wpro7
                  wpro7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wpro10
                  wpro10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wpro7 ~~ wpro7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wpro10 ~~ wpro10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect1 := a*b
                  indirect2 := c*d
                  indirect3 := d*f
         '
```

```{r fit ri.med_hyp.long.pro.full2}
ri.med_hyp.long.pro.full2.fit <- lavaan(model = ri.med_hyp.long.pro.full2, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long.pro.full2.fit.summary <- summary(ri.med_hyp.long.pro.full2.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_hyp.long.pro.fit and ri.med_hyp.long4a.pro.fit}
lavTestLRT(ri.med_hyp.long.pro.full.fit, ri.med_hyp.long.pro.full2.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.4722). 

```{r results table for random intercept mother report prosocial and total adhd}
# Model fit 
ri.med_hyp.long.pro.full2.fit.summary.fit <- table.model.fit(ri.med_hyp.long.pro.full2.fit.summary)
# Coefficients -
ri.med_hyp.long.pro.full2.fit.summary.reg <- table.model.coef(model = ri.med_hyp.long.pro.full2.fit.summary, step = "S4") %>% mutate_if(is.numeric, round, 3)

ri.med_hyp.long.pro.full2.fit.summary.reg %>%
  select(lhs, op, rhs, std.all, pvalue) %>%
  filter(lhs == "indirect1" | lhs == "indirect2")

ri.med_hyp.long.pro.full2.fit.summary.reg %>%
  select(lhs, op, rhs, label,std.all, pvalue)
```

### Inattention 

#### Step 1. The full CLPM mediation model

```{r med_inat.long.pro}
med_inat.long.pro <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoe7 ~ sisoe5
                  sisoe10 ~ sisoe7
                  sisoe12 ~ sisoe10
                  ## Pro social bahviour
                  proe7 ~ proe5
                  proe10 ~ proe7
                  proe12 ~ proe10
                  ## ADHD
                  ine7 ~ ine5
                  ine10 ~ ine7
                  ine12 ~ ine10

                  ###### Cross lag paths ######
                  ## Isolation
                  ine7 ~ sisoe5
                  ine10 ~ sisoe7
                  ine12 ~ sisoe10
                  ## ADHD
                  sisoe7 ~ ine5
                  sisoe10 ~ ine7
                  sisoe12 ~ ine10
                  ## Prosocial
                  sisoe7 ~ proe5
                  ine7 ~ proe5
                  proe12 ~ sisoe10
                  proe12 ~ ine10
                  
                  ###### mediation paths ######
                  ## ADHD to Isolation
                  proe7 ~ a1*ine5 
                  sisoe10 ~ b1*proe7
                  proe10 ~ a2*ine7 
                  sisoe12 ~ b2*proe10
                  ## Isolation to ADHD
                  proe7 ~ c1*sisoe5
                  ine10 ~ d1*proe7
                  proe10 ~ c2*sisoe7
                  ine12 ~ d2*proe10

                  ###### Covariances ######
                  sisoe5 ~~ proe5
                  proe5 ~~ ine5
                  sisoe5 ~~ ine5
                  sisoe7 ~~ proe7
                  proe7 ~~ ine7
                  sisoe7 ~~ ine7
                  sisoe10 ~~ proe10
                  proe10 ~~ ine10
                  sisoe10 ~~ ine10
                  sisoe12 ~~ proe12
                  proe12 ~~ ine12
                  sisoe12 ~~ ine12
                    
                  ###### Variances ######
                  ## Variances
                  ine5 ~~ ine5 
                  sisoe5 ~~ sisoe5 
                  proe5 ~~ proe5
                  ## Residual variances
                  ine7 ~~ ine7 
                  sisoe7 ~~ sisoe7 
                  proe7 ~~ proe7
                  ine10 ~~ ine10 
                  sisoe10 ~~ sisoe10 
                  proe10 ~~ proe10
                  ine12 ~~ ine12 
                  sisoe12 ~~ sisoe12
                  proe12 ~~ proe12

                  ###### Indirect effects (a*b) ######
                  indirect1a := a1*b1
                  indirect1b := a2*b2
                  indirect2a := c1*d1
                  indirect2b := c2*d2
         '
```

```{r  fit med_inat.long.pro}
med_inat.long.pro.fit <- lavaan(model = med_inat.long.pro, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long.pro.fit.summary <- summary(med_inat.long.pro.fit, standardized = TRUE, fit.measures = TRUE)
```

#### Step 2. Constrained full CLPM mediation model

```{r med_inat.long2.pro}
med_inat.long2.pro <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoe7 ~ sisoe5
                  sisoe10 ~ sisoe7
                  sisoe12 ~ sisoe10
                  ## Pro social bahviour
                  proe7 ~ proe5
                  proe10 ~ proe7
                  proe12 ~ proe10
                  ## ADHD
                  ine7 ~ ine5
                  ine10 ~ ine7
                  ine12 ~ ine10

                  ###### Cross lag paths ######
                  ## Isolation
                  ine7 ~ e*sisoe5
                  ine10 ~ e*sisoe7
                  ine12 ~ e*sisoe10
                  ## ADHD
                  sisoe7 ~ f*ine5
                  sisoe10 ~ f*ine7
                  sisoe12 ~ f*ine10
                  ## Prosocial
                  sisoe7 ~ b*proe5
                  ine7 ~ d*proe5
                  proe12 ~ c*sisoe10
                  proe12 ~ a*ine10
                  
                  ###### mediation paths ######
                  ## ADHD to Isolation
                  proe7 ~ a*ine5 
                  sisoe10 ~ b*proe7
                  proe10 ~ a*ine7 
                  sisoe12 ~ b*proe10
                  ## Isolation to ADHD
                  proe7 ~ c*sisoe5
                  ine10 ~ d*proe7
                  proe10 ~ c*sisoe7
                  ine12 ~ d*proe10

                  ###### Covariances ######
                  sisoe5 ~~ proe5
                  proe5 ~~ ine5
                  sisoe5 ~~ ine5
                  sisoe7 ~~ proe7
                  proe7 ~~ ine7
                  sisoe7 ~~ ine7
                  sisoe10 ~~ proe10
                  proe10 ~~ ine10
                  sisoe10 ~~ ine10
                  sisoe12 ~~ proe12
                  proe12 ~~ ine12
                  sisoe12 ~~ ine12
                    
                  ###### Variances ######
                  ## Variances
                  ine5 ~~ ine5 
                  sisoe5 ~~ sisoe5 
                  proe5 ~~ proe5
                  ## Residual variances
                  ine7 ~~ ine7 
                  sisoe7 ~~ sisoe7 
                  proe7 ~~ proe7
                  ine10 ~~ ine10 
                  sisoe10 ~~ sisoe10 
                  proe10 ~~ proe10
                  ine12 ~~ ine12 
                  sisoe12 ~~ sisoe12
                  proe12 ~~ proe12

                  ###### Indirect effects (a*b) ######
                  indirect1 := a*b
                  indirect2 := c*d
         '
```

```{r  fit med_inat.long.pro}
med_inat.long2.pro.fit <- lavaan(model = med_inat.long2.pro, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long2.pro.fit.summary <- summary(med_inat.long2.pro.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_inat.long.pro.fit and med_inat.long2.pro.fit}
lavTestLRT(med_inat.long.pro.fit, med_inat.long2.pro.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.3934). Therefore this model 2 will be carried forward.

```{r results table for mother report prosocial and total adhd}
# Model fit 
med_inat.long2.pro.fit.summary.fit <- table.model.fit(med_inat.long2.pro.fit.summary)
# Coefficients
med_inat.long2.pro.fit.summary.reg <- table.model.coef(model = med_inat.long2.pro.fit.summary, step = "S2") %>% mutate_if(is.numeric, round, 3)

med_inat.long2.pro.fit.summary.reg %>%
  select(lhs, op, rhs, label, std.all, pvalue)
```

#### Step 3. The full RI-CLPM mediation model 

```{r ri.med_inat.long.pro.full}
ri.med_inat.long.pro.full <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*ine5 + 1*ine7 + 1*ine10 + 1*ine12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIpro =~ 1*proe5 + 1*proe7 + 1*proe10  + 1*proe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*ine5
                  wad7 =~ 1*ine7
                  wad10 =~ 1*ine10
                  wad12 =~ 1*ine12
                  ## antisocial 
                  wpro5 =~ 1*proe5
                  wpro7 =~ 1*proe7
                  wpro10 =~ 1*proe10
                  wpro12 =~ 1*proe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## antisocial bahviour
                  wpro7 ~ wpro5
                  wpro10 ~ wpro7
                  wpro12 ~ wpro10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ wsi5
                  wad10 ~ wsi7
                  wad12 ~ wsi10
                  ## ADHD
                  wsi7 ~ wad5
                  wsi10 ~ wad7
                  wsi12 ~ wad10
                  ## antisocial
                  wsi7 ~ wpro5
                  wad7 ~ wpro5
                  wpro12 ~ wsi10
                  wpro12 ~ wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro7 ~ a1*wad5 
                  wsi10 ~ b1*wpro7
                  wpro10 ~ a2*wad7 
                  wsi12 ~ b2*wpro10
                  ## Isolation to ADHD
                  wpro7 ~ wsi5
                  wad10 ~ wpro7
                  wpro10 ~ wsi7
                  wad12 ~ wpro10
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wpro7
                  wpro7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wpro10
                  wpro10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wpro7 ~~ wpro7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wpro10 ~~ wpro10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect1 := a1*b1
                  indirect2 := a2*b2
         '
```

```{r fit ri.med_inat.long.pro.full}
ri.med_inat.long.pro.full.fit <- lavaan(model = ri.med_inat.long.pro.full, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long.pro.full.fit.summary <- summary(ri.med_inat.long.pro.full.fit, standardized = TRUE, fit.measures = TRUE)
```

#### Step 4. Constrained full cross-lag RI-CLPM mediation model 

```{r ri.med_inat.long4.pro}
ri.med_inat.long.pro.full2 <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*ine5 + 1*ine7 + 1*ine10 + 1*ine12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIpro =~ 1*proe5 + 1*proe7 + 1*proe10  + 1*proe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*ine5
                  wad7 =~ 1*ine7
                  wad10 =~ 1*ine10
                  wad12 =~ 1*ine12
                  ## prosocial 
                  wpro5 =~ 1*proe5
                  wpro7 =~ 1*proe7
                  wpro10 =~ 1*proe10
                  wpro12 =~ 1*proe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## pro social bahviour
                  wpro7 ~ wpro5
                  wpro10 ~ wpro7
                  wpro12 ~ wpro10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ e*wsi5
                  wad10 ~ e*wsi7
                  wad12 ~ e*wsi10
                  ## ADHD
                  wsi7 ~ f*wad5
                  wsi10 ~ f*wad7
                  wsi12 ~ f*wad10
                  ## prosocial
                  wsi7 ~ b*wpro5
                  wad7 ~ d*wpro5
                  wpro12 ~ c*wsi10
                  wpro12 ~ a*wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro7 ~ a*wad5 
                  wsi10 ~ b*wpro7
                  wpro10 ~ a*wad7 
                  wsi12 ~ b*wpro10
                  ## Isolation to ADHD
                  wpro7 ~ c*wsi5
                  wad10 ~ d*wpro7
                  wpro10 ~ c*wsi7
                  wad12 ~ d*wpro10
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wpro7
                  wpro7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wpro10
                  wpro10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wpro7 ~~ wpro7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wpro10 ~~ wpro10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect1 := a*b
                  indirect2 := c*d
         '
```

```{r fit ri.med_inat.long.pro.full2}
ri.med_inat.long.pro.full2.fit <- lavaan(model = ri.med_inat.long.pro.full2, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long.pro.full2.fit.summary <- summary(ri.med_inat.long.pro.full2.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_inat.long.pro.fit and ri.med_inat.long4a.pro.fit}
lavTestLRT(ri.med_inat.long.pro.full.fit, ri.med_inat.long.pro.full2.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.2155). 

```{r results table for random intercept mother report prosocial and total adhd}
# Model fit 
ri.med_inat.long.pro.full2.fit.summary.fit <- table.model.fit(ri.med_inat.long.pro.full2.fit.summary)
# Coefficients -
ri.med_inat.long.pro.full2.fit.summary.reg <- table.model.coef(model = ri.med_inat.long.pro.full2.fit.summary, step = "S4") %>% mutate_if(is.numeric, round, 3)

ri.med_inat.long.pro.full2.fit.summary.reg %>%
  select(lhs, op, rhs, std.all, pvalue) %>%
  filter(lhs == "indirect1" | lhs == "indirect2")

ri.med_inat.long.pro.full2.fit.summary.reg %>%
  select(lhs, op, rhs, label, std.all, pvalue)
```

## Antisocial behaviour

### Total ADHD symptoms 

#### Step 1. The full CLPM mediation model

```{r med.long.asb}
med.long.asb <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoe7 ~ sisoe5
                  sisoe10 ~ sisoe7
                  sisoe12 ~ sisoe10
                  ## Anti social bahviour
                  asbe7 ~ asbe5
                  asbe10 ~ asbe7
                  asbe12 ~ asbe10
                  ## ADHD
                  tadhde7 ~ tadhde5
                  tadhde10 ~ tadhde7
                  tadhde12 ~ tadhde10

                  ###### Cross lag paths ######
                  ## Isolation
                  tadhde7 ~ sisoe5
                  tadhde10 ~ sisoe7
                  tadhde12 ~ sisoe10
                  ## ADHD
                  sisoe7 ~ tadhde5
                  sisoe10 ~ tadhde7
                  sisoe12 ~ tadhde10
                  ## antisocial
                  sisoe7 ~ asbe5
                  tadhde7 ~ asbe5
                  asbe12 ~ sisoe10
                  asbe12 ~ tadhde10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbe7 ~ a1*tadhde5 
                  sisoe10 ~ b1*asbe7
                  asbe10 ~ a2*tadhde7 
                  sisoe12 ~ b2*asbe10
                  ## Isolation to ADHD
                  asbe7 ~ c1*sisoe5
                  tadhde10 ~ d1*asbe7
                  asbe10 ~ c2*sisoe7
                  tadhde12 ~ d2*asbe10

                  ###### Covariances ######
                  sisoe5 ~~ asbe5
                  asbe5 ~~ tadhde5
                  sisoe5 ~~ tadhde5
                  sisoe7 ~~ asbe7
                  asbe7 ~~ tadhde7
                  sisoe7 ~~ tadhde7
                  sisoe10 ~~ asbe10
                  asbe10 ~~ tadhde10
                  sisoe10 ~~ tadhde10
                  sisoe12 ~~ asbe12
                  asbe12 ~~ tadhde12
                  sisoe12 ~~ tadhde12
                    
                  ###### Variances ######
                  ## Variances
                  tadhde5 ~~ tadhde5 
                  sisoe5 ~~ sisoe5 
                  asbe5 ~~ asbe5
                  ## Residual variances
                  tadhde7 ~~ tadhde7 
                  sisoe7 ~~ sisoe7 
                  asbe7 ~~ asbe7
                  tadhde10 ~~ tadhde10 
                  sisoe10 ~~ sisoe10 
                  asbe10 ~~ asbe10
                  tadhde12 ~~ tadhde12 
                  sisoe12 ~~ sisoe12
                  asbe12 ~~ asbe12

                  ###### Indirect effects (a*b) ######
                  indirect1a := a1*b1
                  indirect1b := a2*b2
                  indirect2a := c1*d1
                  indirect2b := c2*d2
         '
```

```{r  fit med.long.asb}
med.long.asb.fit <- lavaan(model = med.long.asb, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long.asb.fit.summary <- summary(med.long.asb.fit, standardized = TRUE, fit.measures = TRUE)
```

#### Step 2. Constrained full CLPM mediation model

```{r med.long2.asb}
med.long2.asb <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoe7 ~ sisoe5
                  sisoe10 ~ sisoe7
                  sisoe12 ~ sisoe10
                  ## Anti social bahviour
                  asbe7 ~ asbe5
                  asbe10 ~ asbe7
                  asbe12 ~ asbe10
                  ## ADHD
                  tadhde7 ~ tadhde5
                  tadhde10 ~ tadhde7
                  tadhde12 ~ tadhde10

                  ###### Cross lag paths ######
                  ## Isolation
                  tadhde7 ~ e*sisoe5
                  tadhde10 ~ e*sisoe7
                  tadhde12 ~ e*sisoe10
                  ## ADHD
                  sisoe7 ~ f*tadhde5
                  sisoe10 ~ f*tadhde7
                  sisoe12 ~ f*tadhde10
                  ## Antisocial
                  sisoe7 ~ b*asbe5
                  tadhde7 ~ d*asbe5
                  asbe12 ~ c*sisoe10
                  asbe12 ~ a*tadhde10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbe7 ~ a*tadhde5 
                  sisoe10 ~ b*asbe7
                  asbe10 ~ a*tadhde7 
                  sisoe12 ~ b*asbe10
                  ## Isolation to ADHD
                  asbe7 ~ c*sisoe5
                  tadhde10 ~ d*asbe7
                  asbe10 ~ c*sisoe7
                  tadhde12 ~ d*asbe10

                  ###### Covariances ######
                  sisoe5 ~~ asbe5
                  asbe5 ~~ tadhde5
                  sisoe5 ~~ tadhde5
                  sisoe7 ~~ asbe7
                  asbe7 ~~ tadhde7
                  sisoe7 ~~ tadhde7
                  sisoe10 ~~ asbe10
                  asbe10 ~~ tadhde10
                  sisoe10 ~~ tadhde10
                  sisoe12 ~~ asbe12
                  asbe12 ~~ tadhde12
                  sisoe12 ~~ tadhde12
                    
                  ###### Variances ######
                  ## Variances
                  tadhde5 ~~ tadhde5 
                  sisoe5 ~~ sisoe5 
                  asbe5 ~~ asbe5
                  ## Residual variances
                  tadhde7 ~~ tadhde7 
                  sisoe7 ~~ sisoe7 
                  asbe7 ~~ asbe7
                  tadhde10 ~~ tadhde10 
                  sisoe10 ~~ sisoe10 
                  asbe10 ~~ asbe10
                  tadhde12 ~~ tadhde12 
                  sisoe12 ~~ sisoe12
                  asbe12 ~~ asbe12

                  ###### Indirect effects (a*b) ######
                  indirect1 := a*b
                  indirect2 := c*d
         '
```

```{r  fit med.long.asb}
med.long2.asb.fit <- lavaan(model = med.long2.asb, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long2.asb.fit.summary <- summary(med.long2.asb.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med.long.asb.fit and med.long2.asb.fit}
lavTestLRT(med.long.asb.fit, med.long2.asb.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.6973). Therefore this model 2 will be carried forward.

```{r results table for mother report asbsocial and total adhd}
# Model fit 
med.long2.asb.fit.summary.fit <- table.model.fit(med.long2.asb.fit.summary)
# Coefficients
med.long2.asb.fit.summary.reg <- table.model.coef(model = med.long2.asb.fit.summary, step = "S2") %>% mutate_if(is.numeric, round, 3)

med.long2.asb.fit.summary.reg %>%
  select(lhs, op, rhs, label, std.all, pvalue)
```

#### Step 3. The full RI-CLPM mediation model 

```{r ri.med.long.asb.full}
ri.med.long.asb.full <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhde5 + 1*tadhde7 + 1*tadhde10 + 1*tadhde12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIasb =~ 1*asbe5 + 1*asbe7 + 1*asbe10  + 1*asbe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*tadhde5
                  wad7 =~ 1*tadhde7
                  wad10 =~ 1*tadhde10
                  wad12 =~ 1*tadhde12
                  ## Antisocial 
                  wasb5 =~ 1*asbe5
                  wasb7 =~ 1*asbe7
                  wasb10 =~ 1*asbe10
                  wasb12 =~ 1*asbe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## Anti social bahviour
                  wasb7 ~ wasb5
                  wasb10 ~ wasb7
                  wasb12 ~ wasb10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ wsi5
                  wad10 ~ wsi7
                  wad12 ~ wsi10
                  ## ADHD
                  wsi7 ~ wad5
                  wsi10 ~ wad7
                  wsi12 ~ wad10
                  ## asbsocial
                  wsi7 ~ wasb5
                  wad7 ~ wasb5
                  wasb12 ~ wsi10
                  wasb12 ~ wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb7 ~ a1*wad5 
                  wsi10 ~ b1*wasb7
                  wasb10 ~ a2*wad7 
                  wsi12 ~ b2*wasb10
                  ## Isolation to ADHD
                  wasb7 ~ wsi5
                  wad10 ~ wasb7
                  wasb10 ~ wsi7
                  wad12 ~ wasb10
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wasb7
                  wasb7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wasb10
                  wasb10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wasb7 ~~ wasb7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wasb10 ~~ wasb10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect1 := a1*b1
                  indirect2 := a2*b2
         '
```

```{r fit ri.med.long.asb.full}
ri.med.long.asb.full.fit <- lavaan(model = ri.med.long.asb.full, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long.asb.full.fit.summary <- summary(ri.med.long.asb.full.fit, standardized = TRUE, fit.measures = TRUE)
```

#### Step 4. Constrained full cross-lag RI-CLPM mediation model 

```{r ri.med.long.asb.full2}
ri.med.long.asb.full2 <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhde5 + 1*tadhde7 + 1*tadhde10 + 1*tadhde12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIasb =~ 1*asbe5 + 1*asbe7 + 1*asbe10  + 1*asbe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*tadhde5
                  wad7 =~ 1*tadhde7
                  wad10 =~ 1*tadhde10
                  wad12 =~ 1*tadhde12
                  ## antisocial 
                  wasb5 =~ 1*asbe5
                  wasb7 =~ 1*asbe7
                  wasb10 =~ 1*asbe10
                  wasb12 =~ 1*asbe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## asb social bahviour
                  wasb7 ~ wasb5
                  wasb10 ~ wasb7
                  wasb12 ~ wasb10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ e*wsi5
                  wad10 ~ e*wsi7
                  wad12 ~ e*wsi10
                  ## ADHD
                  wsi7 ~ f*wad5
                  wsi10 ~ f*wad7
                  wsi12 ~ f*wad10
                  ## asbsocial
                  wsi7 ~ b*wasb5
                  wad7 ~ d*wasb5
                  wasb12 ~ c*wsi10
                  wasb12 ~ a*wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb7 ~ a*wad5 
                  wsi10 ~ b*wasb7
                  wasb10 ~ a*wad7 
                  wsi12 ~ b*wasb10
                  ## Isolation to ADHD
                  wasb7 ~ c*wsi5
                  wad10 ~ d*wasb7
                  wasb10 ~ c*wsi7
                  wad12 ~ d*wasb10
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wasb7
                  wasb7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wasb10
                  wasb10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wasb7 ~~ wasb7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wasb10 ~~ wasb10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect1 := a*b
                  indirect2 := c*d
         '
```

```{r fit ri.med.long.asb.full2}
ri.med.long.asb.full2.fit <- lavaan(model = ri.med.long.asb.full2, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long.asb.full2.fit.summary <- summary(ri.med.long.asb.full2.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med.long.asb.fit and ri.med.long4a.asb.fit}
lavTestLRT(ri.med.long.asb.full.fit, ri.med.long.asb.full2.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.3114). 

```{r results table for random intercept mother report asbsocial and total adhd}
# Model fit 
ri.med.long.asb.full2.fit.summary.fit <- table.model.fit(ri.med.long.asb.full2.fit.summary)
# Coefficients -
ri.med.long.asb.full2.fit.summary.reg <- table.model.coef(model = ri.med.long.asb.full2.fit.summary, step = "S4") %>% mutate_if(is.numeric, round, 3)

ri.med.long.asb.full2.fit.summary.reg %>%
  select(lhs, op, rhs, label, std.all, pvalue) %>%
  filter(lhs == "indirect1" | lhs == "indirect2")
```

### Hyperactivity 

#### Step 1. The full CLPM mediation model

```{r med_hyp.long.asb}
med_hyp.long.asb <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoe7 ~ sisoe5
                  sisoe10 ~ sisoe7
                  sisoe12 ~ sisoe10
                  ## Anti social bahviour
                  asbe7 ~ asbe5
                  asbe10 ~ asbe7
                  asbe12 ~ asbe10
                  ## ADHD
                  hye7 ~ hye5
                  hye10 ~ hye7
                  hye12 ~ hye10

                  ###### Cross lag paths ######
                  ## Isolation
                  hye7 ~ sisoe5
                  hye10 ~ sisoe7
                  hye12 ~ sisoe10
                  ## ADHD
                  sisoe7 ~ hye5
                  sisoe10 ~ hye7
                  sisoe12 ~ hye10
                  ## Antisocial
                  sisoe7 ~ asbe5
                  hye7 ~ asbe5
                  asbe12 ~ sisoe10
                  asbe12 ~ hye10
                  
                  ###### mediation paths ######
                  ## ADHD to Isolation
                  asbe7 ~ a1*hye5 
                  sisoe10 ~ b1*asbe7
                  asbe10 ~ a2*hye7 
                  sisoe12 ~ b2*asbe10
                  ## Isolation to ADHD
                  asbe7 ~ c1*sisoe5
                  hye10 ~ d1*asbe7
                  asbe10 ~ c2*sisoe7
                  hye12 ~ d2*asbe10

                  ###### Covariances ######
                  sisoe5 ~~ asbe5
                  asbe5 ~~ hye5
                  sisoe5 ~~ hye5
                  sisoe7 ~~ asbe7
                  asbe7 ~~ hye7
                  sisoe7 ~~ hye7
                  sisoe10 ~~ asbe10
                  asbe10 ~~ hye10
                  sisoe10 ~~ hye10
                  sisoe12 ~~ asbe12
                  asbe12 ~~ hye12
                  sisoe12 ~~ hye12
                    
                  ###### Variances ######
                  ## Variances
                  hye5 ~~ hye5 
                  sisoe5 ~~ sisoe5 
                  asbe5 ~~ asbe5
                  ## Residual variances
                  hye7 ~~ hye7 
                  sisoe7 ~~ sisoe7 
                  asbe7 ~~ asbe7
                  hye10 ~~ hye10 
                  sisoe10 ~~ sisoe10 
                  asbe10 ~~ asbe10
                  hye12 ~~ hye12 
                  sisoe12 ~~ sisoe12
                  asbe12 ~~ asbe12

                  ###### Indirect effects (a*b) ######
                  indirect1a := a1*b1
                  indirect1b := a2*b2
                  indirect2a := c1*d1
                  indirect2b := c2*d2
         '
```

```{r  fit med_hyp.long.asb}
med_hyp.long.asb.fit <- lavaan(model = med_hyp.long.asb, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long.asb.fit.summary <- summary(med_hyp.long.asb.fit, standardized = TRUE, fit.measures = TRUE)
```

#### Step 2. Constrained full CLPM mediation model

```{r med_hyp.long2.asb}
med_hyp.long2.asb <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoe7 ~ sisoe5
                  sisoe10 ~ sisoe7
                  sisoe12 ~ sisoe10
                  ## Anti social bahviour
                  asbe7 ~ asbe5
                  asbe10 ~ asbe7
                  asbe12 ~ asbe10
                  ## ADHD
                  hye7 ~ hye5
                  hye10 ~ hye7
                  hye12 ~ hye10

                  ###### Cross lag paths ######
                  ## Isolation
                  hye7 ~ e*sisoe5
                  hye10 ~ e*sisoe7
                  hye12 ~ e*sisoe10
                  ## ADHD
                  sisoe7 ~ f*hye5
                  sisoe10 ~ f*hye7
                  sisoe12 ~ f*hye10
                  ## Antisocial
                  sisoe7 ~ b*asbe5
                  hye7 ~ d*asbe5
                  asbe12 ~ c*sisoe10
                  asbe12 ~ a*hye10
                  
                  ###### mediation paths ######
                  ## ADHD to Isolation
                  asbe7 ~ a*hye5 
                  sisoe10 ~ b*asbe7
                  asbe10 ~ a*hye7 
                  sisoe12 ~ b*asbe10
                  ## Isolation to ADHD
                  asbe7 ~ c*sisoe5
                  hye10 ~ d*asbe7
                  asbe10 ~ c*sisoe7
                  hye12 ~ d*asbe10

                  ###### Covariances ######
                  sisoe5 ~~ asbe5
                  asbe5 ~~ hye5
                  sisoe5 ~~ hye5
                  sisoe7 ~~ asbe7
                  asbe7 ~~ hye7
                  sisoe7 ~~ hye7
                  sisoe10 ~~ asbe10
                  asbe10 ~~ hye10
                  sisoe10 ~~ hye10
                  sisoe12 ~~ asbe12
                  asbe12 ~~ hye12
                  sisoe12 ~~ hye12
                    
                  ###### Variances ######
                  ## Variances
                  hye5 ~~ hye5 
                  sisoe5 ~~ sisoe5 
                  asbe5 ~~ asbe5
                  ## Residual variances
                  hye7 ~~ hye7 
                  sisoe7 ~~ sisoe7 
                  asbe7 ~~ asbe7
                  hye10 ~~ hye10 
                  sisoe10 ~~ sisoe10 
                  asbe10 ~~ asbe10
                  hye12 ~~ hye12 
                  sisoe12 ~~ sisoe12
                  asbe12 ~~ asbe12

                  ###### Indirect effects (a*b) ######
                  indirect1 := a*b
                  indirect2 := c*d
         '
```

```{r  fit med_hyp.long.asb}
med_hyp.long2.asb.fit <- lavaan(model = med_hyp.long2.asb, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long2.asb.fit.summary <- summary(med_hyp.long2.asb.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_hyp.long.asb.fit and med_hyp.long2.asb.fit}
lavTestLRT(med_hyp.long.asb.fit, med_hyp.long2.asb.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.5619). Therefore this model 2 will be carried forward.

```{r results table for mother report asbsocial and total adhd}
# Model fit 
med_hyp.long2.asb.fit.summary.fit <- table.model.fit(med_hyp.long2.asb.fit.summary)
# Coefficients
med_hyp.long2.asb.fit.summary.reg <- table.model.coef(model = med_hyp.long2.asb.fit.summary, step = "S2") %>% mutate_if(is.numeric, round, 3)

med_hyp.long2.asb.fit.summary.reg %>%
  select(lhs, op, rhs, label, std.all, pvalue)
```

#### Step 3. The full RI-CLPM mediation model 

```{r ri.med_hyp.long.asb.full}
ri.med_hyp.long.asb.full <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hye5 + 1*hye7 + 1*hye10 + 1*hye12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIasb =~ 1*asbe5 + 1*asbe7 + 1*asbe10  + 1*asbe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*hye5
                  wad7 =~ 1*hye7
                  wad10 =~ 1*hye10
                  wad12 =~ 1*hye12
                  ## asbsocial 
                  wasb5 =~ 1*asbe5
                  wasb7 =~ 1*asbe7
                  wasb10 =~ 1*asbe10
                  wasb12 =~ 1*asbe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## asb social bahviour
                  wasb7 ~ wasb5
                  wasb10 ~ wasb7
                  wasb12 ~ wasb10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ wsi5
                  wad10 ~ wsi7
                  wad12 ~ wsi10
                  ## ADHD
                  wsi7 ~ wad5
                  wsi10 ~ wad7
                  wsi12 ~ wad10
                  ## asbsocial
                  wsi7 ~ wasb5
                  wad7 ~ wasb5
                  wasb12 ~ wsi10
                  wasb12 ~ wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb7 ~ a1*wad5 
                  wsi10 ~ b1*wasb7
                  wasb10 ~ a2*wad7 
                  wsi12 ~ b2*wasb10
                  ## Isolation to ADHD
                  wasb7 ~ wsi5
                  wad10 ~ wasb7
                  wasb10 ~ wsi7
                  wad12 ~ wasb10
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wasb7
                  wasb7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wasb10
                  wasb10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wasb7 ~~ wasb7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wasb10 ~~ wasb10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect1 := a1*b1
                  indirect2 := a2*b2
         '
```

```{r fit ri.med_hyp.long.asb.full}
ri.med_hyp.long.asb.full.fit <- lavaan(model = ri.med_hyp.long.asb.full, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long.asb.full.fit.summary <- summary(ri.med_hyp.long.asb.full.fit, standardized = TRUE, fit.measures = TRUE)
```

#### Step 4. Constrained full cross-lag RI-CLPM mediation model 

```{r ri.med_hyp.long4.asb}
ri.med_hyp.long.asb.full2 <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hye5 + 1*hye7 + 1*hye10 + 1*hye12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIasb =~ 1*asbe5 + 1*asbe7 + 1*asbe10  + 1*asbe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*hye5
                  wad7 =~ 1*hye7
                  wad10 =~ 1*hye10
                  wad12 =~ 1*hye12
                  ## asbsocial 
                  wasb5 =~ 1*asbe5
                  wasb7 =~ 1*asbe7
                  wasb10 =~ 1*asbe10
                  wasb12 =~ 1*asbe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## asb social bahviour
                  wasb7 ~ wasb5
                  wasb10 ~ wasb7
                  wasb12 ~ wasb10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ e*wsi5
                  wad10 ~ e*wsi7
                  wad12 ~ e*wsi10
                  ## ADHD
                  wsi7 ~ f*wad5
                  wsi10 ~ f*wad7
                  wsi12 ~ f*wad10
                  ## asbsocial
                  wsi7 ~ b*wasb5
                  wad7 ~ d*wasb5
                  wasb12 ~ c*wsi10
                  wasb12 ~ a*wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb7 ~ a*wad5 
                  wsi10 ~ b*wasb7
                  wasb10 ~ a*wad7 
                  wsi12 ~ b*wasb10
                  ## Isolation to ADHD
                  wasb7 ~ c*wsi5
                  wad10 ~ d*wasb7
                  wasb10 ~ c*wsi7
                  wad12 ~ d*wasb10
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wasb7
                  wasb7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wasb10
                  wasb10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wasb7 ~~ wasb7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wasb10 ~~ wasb10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect1 := a*b
                  indirect2 := c*d
         '
```

```{r fit ri.med_hyp.long.asb.full2}
ri.med_hyp.long.asb.full2.fit <- lavaan(model = ri.med_hyp.long.asb.full2, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long.asb.full2.fit.summary <- summary(ri.med_hyp.long.asb.full2.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_hyp.long.asb.fit and ri.med_hyp.long4a.asb.fit}
lavTestLRT(ri.med_hyp.long.asb.full.fit, ri.med_hyp.long.asb.full2.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.4799). 

```{r results table for random intercept mother report asbsocial and total adhd}
# Model fit 
ri.med_hyp.long.asb.full2.fit.summary.fit <- table.model.fit(ri.med_hyp.long.asb.full2.fit.summary)
# Coefficients -
ri.med_hyp.long.asb.full2.fit.summary.reg <- table.model.coef(model = ri.med_hyp.long.asb.full2.fit.summary, step = "S4") %>% mutate_if(is.numeric, round, 3)

ri.med_hyp.long.asb.full2.fit.summary.reg %>%
  select(lhs, op, rhs, std.all, pvalue) %>%
  filter(lhs == "indirect1" | lhs == "indirect2")

ri.med_hyp.long.asb.full2.fit.summary.reg %>%
  select(lhs, op, rhs, label, std.all, pvalue) 
```

### Inattention 

#### Step 1. The full CLPM mediation model

```{r med_inat.long.asb}
med_inat.long.asb <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoe7 ~ sisoe5
                  sisoe10 ~ sisoe7
                  sisoe12 ~ sisoe10
                  ## Anti social bahviour
                  asbe7 ~ asbe5
                  asbe10 ~ asbe7
                  asbe12 ~ asbe10
                  ## ADHD
                  ine7 ~ ine5
                  ine10 ~ ine7
                  ine12 ~ ine10

                  ###### Cross lag paths ######
                  ## Isolation
                  ine7 ~ sisoe5
                  ine10 ~ sisoe7
                  ine12 ~ sisoe10
                  ## ADHD
                  sisoe7 ~ ine5
                  sisoe10 ~ ine7
                  sisoe12 ~ ine10
                  ## Antisocial
                  sisoe7 ~ asbe5
                  ine7 ~ asbe5
                  asbe12 ~ sisoe10
                  asbe12 ~ ine10
                  
                  ###### mediation paths ######
                  ## ADHD to Isolation
                  asbe7 ~ a1*ine5 
                  sisoe10 ~ b1*asbe7
                  asbe10 ~ a2*ine7 
                  sisoe12 ~ b2*asbe10
                  ## Isolation to ADHD
                  asbe7 ~ c1*sisoe5
                  ine10 ~ d1*asbe7
                  asbe10 ~ c2*sisoe7
                  ine12 ~ d2*asbe10

                  ###### Covariances ######
                  sisoe5 ~~ asbe5
                  asbe5 ~~ ine5
                  sisoe5 ~~ ine5
                  sisoe7 ~~ asbe7
                  asbe7 ~~ ine7
                  sisoe7 ~~ ine7
                  sisoe10 ~~ asbe10
                  asbe10 ~~ ine10
                  sisoe10 ~~ ine10
                  sisoe12 ~~ asbe12
                  asbe12 ~~ ine12
                  sisoe12 ~~ ine12
                    
                  ###### Variances ######
                  ## Variances
                  ine5 ~~ ine5 
                  sisoe5 ~~ sisoe5 
                  asbe5 ~~ asbe5
                  ## Residual variances
                  ine7 ~~ ine7 
                  sisoe7 ~~ sisoe7 
                  asbe7 ~~ asbe7
                  ine10 ~~ ine10 
                  sisoe10 ~~ sisoe10 
                  asbe10 ~~ asbe10
                  ine12 ~~ ine12 
                  sisoe12 ~~ sisoe12
                  asbe12 ~~ asbe12

                  ###### Indirect effects (a*b) ######
                  indirect1a := a1*b1
                  indirect1b := a2*b2
                  indirect2a := c1*d1
                  indirect2b := c2*d2
         '
```

```{r  fit med_inat.long.asb}
med_inat.long.asb.fit <- lavaan(model = med_inat.long.asb, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long.asb.fit.summary <- summary(med_inat.long.asb.fit, standardized = TRUE, fit.measures = TRUE)
```

#### Step 2. Constrained full CLPM mediation model

```{r med_inat.long2.asb}
med_inat.long2.asb <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoe7 ~ sisoe5
                  sisoe10 ~ sisoe7
                  sisoe12 ~ sisoe10
                  ## Anti social bahviour
                  asbe7 ~ asbe5
                  asbe10 ~ asbe7
                  asbe12 ~ asbe10
                  ## ADHD
                  ine7 ~ ine5
                  ine10 ~ ine7
                  ine12 ~ ine10

                  ###### Cross lag paths ######
                  ## Isolation
                  ine7 ~ e*sisoe5
                  ine10 ~ e*sisoe7
                  ine12 ~ e*sisoe10
                  ## ADHD
                  sisoe7 ~ f*ine5
                  sisoe10 ~ f*ine7
                  sisoe12 ~ f*ine10
                  ## Antisocial
                  sisoe7 ~ b*asbe5
                  ine7 ~ d*asbe5
                  asbe12 ~ c*sisoe10
                  asbe12 ~ a*ine10
                  
                  ###### mediation paths ######
                  ## ADHD to Isolation
                  asbe7 ~ a*ine5 
                  sisoe10 ~ b*asbe7
                  asbe10 ~ a*ine7 
                  sisoe12 ~ b*asbe10
                  ## Isolation to ADHD
                  asbe7 ~ c*sisoe5
                  ine10 ~ d*asbe7
                  asbe10 ~ c*sisoe7
                  ine12 ~ d*asbe10

                  ###### Covariances ######
                  sisoe5 ~~ asbe5
                  asbe5 ~~ ine5
                  sisoe5 ~~ ine5
                  sisoe7 ~~ asbe7
                  asbe7 ~~ ine7
                  sisoe7 ~~ ine7
                  sisoe10 ~~ asbe10
                  asbe10 ~~ ine10
                  sisoe10 ~~ ine10
                  sisoe12 ~~ asbe12
                  asbe12 ~~ ine12
                  sisoe12 ~~ ine12
                    
                  ###### Variances ######
                  ## Variances
                  ine5 ~~ ine5 
                  sisoe5 ~~ sisoe5 
                  asbe5 ~~ asbe5
                  ## Residual variances
                  ine7 ~~ ine7 
                  sisoe7 ~~ sisoe7 
                  asbe7 ~~ asbe7
                  ine10 ~~ ine10 
                  sisoe10 ~~ sisoe10 
                  asbe10 ~~ asbe10
                  ine12 ~~ ine12 
                  sisoe12 ~~ sisoe12
                  asbe12 ~~ asbe12

                  ###### Indirect effects (a*b) ######
                  indirect1 := a*b
                  indirect2 := c*d
         '
```

```{r  fit med_inat.long.asb}
med_inat.long2.asb.fit <- lavaan(model = med_inat.long2.asb, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long2.asb.fit.summary <- summary(med_inat.long2.asb.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_inat.long.asb.fit and med_inat.long2.asb.fit}
lavTestLRT(med_inat.long.asb.fit, med_inat.long2.asb.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.2127). Therefore this model 2 will be carried forward.

```{r results table for mother report asbsocial and total adhd}
# Model fit 
med_inat.long2.asb.fit.summary.fit <- table.model.fit(med_inat.long2.asb.fit.summary)
# Coefficients
med_inat.long2.asb.fit.summary.reg <- table.model.coef(model = med_inat.long2.asb.fit.summary, step = "S2") %>% mutate_if(is.numeric, round, 3)

med_inat.long2.asb.fit.summary.reg %>%
  select(lhs, op, rhs, label, std.all, pvalue) 
```

#### Step 3. The full RI-CLPM mediation model 

```{r ri.med_inat.long.asb.full}
ri.med_inat.long.asb.full <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*ine5 + 1*ine7 + 1*ine10 + 1*ine12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIasb =~ 1*asbe5 + 1*asbe7 + 1*asbe10  + 1*asbe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*ine5
                  wad7 =~ 1*ine7
                  wad10 =~ 1*ine10
                  wad12 =~ 1*ine12
                  ## antisocial 
                  wasb5 =~ 1*asbe5
                  wasb7 =~ 1*asbe7
                  wasb10 =~ 1*asbe10
                  wasb12 =~ 1*asbe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## antisocial bahviour
                  wasb7 ~ wasb5
                  wasb10 ~ wasb7
                  wasb12 ~ wasb10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ wsi5
                  wad10 ~ wsi7
                  wad12 ~ wsi10
                  ## ADHD
                  wsi7 ~ wad5
                  wsi10 ~ wad7
                  wsi12 ~ wad10
                  ## antisocial
                  wsi7 ~ wasb5
                  wad7 ~ wasb5
                  wasb12 ~ wsi10
                  wasb12 ~ wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb7 ~ a1*wad5 
                  wsi10 ~ b1*wasb7
                  wasb10 ~ a2*wad7 
                  wsi12 ~ b2*wasb10
                  ## Isolation to ADHD
                  wasb7 ~ c1*wsi5
                  wad10 ~ d1*wasb7
                  wasb10 ~ c2*wsi7
                  wad12 ~ d2*wasb10
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wasb7
                  wasb7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wasb10
                  wasb10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wasb7 ~~ wasb7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wasb10 ~~ wasb10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effects (a*b) ######
                  indirect1a := a1*b1
                  indirect1b := a2*b2
                  indirect2a := c1*d1
                  indirect2b := c2*d2
         '
```

```{r fit ri.med_inat.long.asb.full}
ri.med_inat.long.asb.full.fit <- lavaan(model = ri.med_inat.long.asb.full, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long.asb.full.fit.summary <- summary(ri.med_inat.long.asb.full.fit, standardized = TRUE, fit.measures = TRUE)
```

#### Step 4. Constrained full cross-lag RI-CLPM mediation model 

```{r ri.med_inat.long4.asb}
ri.med_inat.long.asb.full2 <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*ine5 + 1*ine7 + 1*ine10 + 1*ine12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIasb =~ 1*asbe5 + 1*asbe7 + 1*asbe10  + 1*asbe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*ine5
                  wad7 =~ 1*ine7
                  wad10 =~ 1*ine10
                  wad12 =~ 1*ine12
                  ## asbsocial 
                  wasb5 =~ 1*asbe5
                  wasb7 =~ 1*asbe7
                  wasb10 =~ 1*asbe10
                  wasb12 =~ 1*asbe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## asb social bahviour
                  wasb7 ~ wasb5
                  wasb10 ~ wasb7
                  wasb12 ~ wasb10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ e*wsi5
                  wad10 ~ e*wsi7
                  wad12 ~ e*wsi10
                  ## ADHD
                  wsi7 ~ f*wad5
                  wsi10 ~ f*wad7
                  wsi12 ~ f*wad10
                  ## asbsocial
                  wsi7 ~ b*wasb5
                  wad7 ~ d*wasb5
                  wasb12 ~ c*wsi10
                  wasb12 ~ a*wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb7 ~ a*wad5 
                  wsi10 ~ b*wasb7
                  wasb10 ~ a*wad7 
                  wsi12 ~ b*wasb10
                  ## Isolation to ADHD
                  wasb7 ~ c*wsi5
                  wad10 ~ d*wasb7
                  wasb10 ~ c*wsi7
                  wad12 ~ d*wasb10
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wasb7
                  wasb7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wasb10
                  wasb10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wasb7 ~~ wasb7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wasb10 ~~ wasb10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect1 := a*b
                  indirect2 := c*d
         '
```

```{r fit ri.med_inat.long.asb.full2}
ri.med_inat.long.asb.full2.fit <- lavaan(model = ri.med_inat.long.asb.full2, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long.asb.full2.fit.summary <- summary(ri.med_inat.long.asb.full2.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_inat.long.asb.fit and ri.med_inat.long4a.asb.fit}
lavTestLRT(ri.med_inat.long.asb.full.fit, ri.med_inat.long.asb.full2.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.04084). **THIS MODEL SHOULD USE THE UNCONSTRAINED MODEL**

```{r results table for random intercept mother report asbsocial and total adhd}
# Model fit 
ri.med_inat.long.asb.full.fit.summary.fit <- table.model.fit(ri.med_inat.long.asb.full.fit.summary)
# Coefficients -
ri.med_inat.long.asb.full.fit.summary.reg <- table.model.coef(model = ri.med_inat.long.asb.full.fit.summary, step = "S3") %>% mutate_if(is.numeric, round, 3)

ri.med_inat.long.asb.full.fit.summary.reg %>%
  select(lhs, op, rhs, std.all, pvalue) %>%
  filter(lhs == "indirect1" | lhs == "indirect2")

ri.med_inat.long.asb.full.fit.summary.reg %>%
  select(lhs, op, rhs, label, std.all, pvalue)
```


