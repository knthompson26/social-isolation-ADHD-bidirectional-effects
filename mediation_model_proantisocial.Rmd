---
title: "Mediation model for social isolation, pro/antisocial behaviours, and ADHD symptoms in childhood"
output:  
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: false
    number_sections: false
    highlight: monochrome
    theme: flatly
    code_folding: hide
    includes:
      after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment = NA,
                      prompt = FALSE,
                      cache = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      results = 'asis')

options(bitmapType = 'quartz') # to render fonts better
```

```{r Clear global environment, include=FALSE}
remove(list = ls())
```

```{r Load packages, include=FALSE}
library(knitr)
library(haven)
library(summarytools)
library(psych)
library(lavaan)
library(tidyverse)
library(dplyr) #conflicts with tidyverse for e.g. rename and row_number
```

```{r source the data file path, include=FALSE}
#source raw data directory: data_raw and data included
source("../isolation_ADHD_data_path.R")
```

```{r read in dta data file}
dat.raw <- read_dta(paste0(data.raw_path, "Katie_10Mar22.dta"))
colnames(dat.raw)

dat <- dat.raw %>%
  dplyr::select(id = atwinid,
         sampsex,
         seswq35,
         sisoem5,  # social isolation mother report
         sisoem7,
         sisoem10,
         sisoem12,
         sisoet5,    # social isolation teacher report
         sisoet7, 
         sisoet10,
         sisoet12,
         tadhdem5,   # total ADHD mother report
         tadhdem7,
         tadhdem10,
         tadhdem12,
         tadhdet5,   # total ADHD teacher report
         tadhdet7,
         tadhdet10,
         tadhdet12,
         hyem5,      # hyperactivity ADHD mother report
         hyem7,
         hyem10,
         hyem12, 
         hyet5,      # hyperactivity ADHD teacher report
         hyet7,
         hyet10,
         hyet12,
         inem5,     # inattention ADHD mother report
         inem7,
         inem10,
         inem12,
         inet5,     # inattention ADHD teacher report
         inet7,
         inet10,
         inet12,
         proem5,    # prosocial total scores mother report
         proem7,
         proem10,
         proem12, 
         proet5,    # prosocial total scores teacher report
         proet7,
         proet10,
         proet12, 
         asbem5,   # antisocial total scores mother report
         asbem7,
         asbem10,
         asbem12, 
         asbet5,   # antisocial total scores teacher report
         asbet7,
         asbet10,
         asbet12, 
         pe98m5,    # prosocial behaviours raw items (age 5)
         pe99m5,
         pe100m5,
         pe101m5,
         pe102m5,
         pe103m5,
         pe104m5,
         pe105m5,
         pe106m5,
         pe107m5,
         pe98m7,  # prosocial behaviours raw items (age 7)
         pe99m7,
         pe100m7,
         pe101m7,
         pe102m7,
         pe103m7,
         pe104m7,
         pe105m7,
         pe106m7,
         pe107m7,
         pe98m10,  # prosocial behaviours raw items (age 10)
         pe99m10,
         pe100m10,
         pe101m10,
         pe102m10,
         pe103m10,
         pe104m10,
         pe105m10,
         pe106m10,
         pe107m10,
         pe98m12,  # prosocial behaviours raw items (age 12)
         pe99m12,
         pe100m12,
         pe101m12,
         pe102m12,
         pe103m12,
         pe104m12,
         pe105m12,
         pe106m12,
         pe107m12,
         pe37m5,   # antisocial behaviours raw items (age 5) - aggression subscale 
         pe38m5, 
         pe41m5,  
         pe42m5, 
         pe43m5, 
         pe44m5, 
         pe45m5, 
         pe46m5, 
         pe50m5,
         pe53m5,
         pe56m5,
         pe58m5,
         pe61m5,
         pe62m5,
         pe64m5,
         pe65m5,
         pe66m5,
         pe69m5,
         pe47m5,  # antisocial behaviours raw items (age 5) - delinquency subscale  
         pe51m5,
         pe52m5,
         pe54m5,
         pe55m5,
         pe57m5,
         pe59m5,
         pe60m5,
         pe63m5,
         pe67m5,
         pe68m5,
         pe70m5,
         pe71m5,
         pe39m5,  # Additional Items from Rutter Questionnaire
         pe40m5,
         pe49m5,
         pe72m5,  # Conduct and Oppositional Defiant Items
         pe73m5,
         pe74m5,
         pe75m5,
         pe76m5,
         pe77m5,
         pe78m5,
         pe79m5,
         pe80m5,
         pe37m7,   # antisocial behaviours raw items (age 7)
         pe38m7, 
         pe41m7,  
         pe42m7, 
         pe43m7, 
         pe44m7, 
         pe45m7, 
         pe46m7, 
         pe50m7,
         pe53m7,
         pe56m7,
         pe58m7,
         pe61m7,
         pe62m7,
         pe64m7,
         pe65m7,
         pe66m7,
         pe69m7,
         pe47m7,
         pe51m7,
         pe52m7,
         pe54m7,
         pe55m7,
         pe57m7,
         pe59m7,
         pe60m7,
         pe63m7,
         pe67m7,
         pe68m7,
         pe70m7,
         pe71m7,
         pe39m7,
         pe40m7,
         pe49m7,
         pe72m7,
         pe73m7,
         pe74m7,
         pe75m7,
         pe76m7,
         pe77m7,
         pe78m7,
         pe79m7,
         pe80m7,
         pe37m10,   # antisocial behaviours raw items (age 10)
         pe38m10, 
         pe41m10,  
         pe42m10, 
         pe43m10, 
         pe44m10, 
         pe45m10, 
         pe46m10, 
         pe50m10,
         pe53m10,
         pe56m10,
         pe58m10,
         pe61m10,
         pe62m10,
         pe64m10,
         pe65m10,
         pe66m10,
         pe69m10,
         pe47m10,
         pe51m10,
         pe52m10,
         pe54m10,
         pe55m10,
         pe57m10,
         pe59m10,
         pe60m10,
         pe63m10,
         pe67m10,
         pe68m10,
         pe70m10,
         pe71m10,
         pe39m10,
         pe40m10,
         pe49m10,
         pe72m10,
         pe73m10,
         pe74m10,
         pe75m10,
         pe76m10,
         pe77m10,
         pe78m10,
         pe79m10,
         pe80m10,
         pe37m12,   # antisocial behaviours raw items (age 12)
         pe38m12, 
         pe41m12,  
         pe42m12, 
         pe43m12, 
         pe44m12, 
         pe45m12, 
         pe46m12, 
         pe50m12,
         pe53m12,
         pe56m12,
         pe58m12,
         pe61m12,
         pe62m12,
         pe64m12,
         pe65m12,
         pe66m12,
         pe69m12,
         pe47m12,
         pe51m12,
         pe52m12,
         pe54m12,
         pe55m12,
         pe57m12,
         pe59m12,
         pe60m12,
         pe63m12,
         pe67m12,
         pe68m12,
         pe70m12,
         pe71m12,
         pe39m12,
         pe40m12,
         pe49m12,
         pe72m12,
         pe73m12,
         pe74m12,
         pe75m12,
         pe76m12,
         pe77m12,
         pe78m12,
         pe79m12,
         pe80m12,
         trf8e5,  # Antisocial behaviour - Agression subscale age 5 teacher report
         trf9e5,  
         trf10e5, 
         trf13e5, 
         trf14e5, 
         trf15e5, 
         trf16e5, 
         trf17e5, 
         trf18e5, 
         trf21e5, 
         trf27e5, 
         trf38e5, 
         trf47e5, 
         trf50e5, 
         trf51e5, 
         trf54e5, 
         trf56e5, 
         trf57e5, 
         trf61e5, 
         trf62e5, 
         trf66e5, 
         trf67e5, 
         trf68e5, 
         trf69e5, 
         trf74e5, 
         trf20e5,  # Antisocial behaviour - Delinquent subscale age 5 teacher report
         trf29e5, 
         trf31e5, 
         trf48e5, 
         trf60e5, 
         trf65e5, 
         trf70e5, 
         trf71e5, 
         trf79e5, 
         trf80e5, # Antisocial behaviour - Conduct and Oppositional Defiant subscale age 5 teacher report 
         trf81e5,
         trf82e5,
         trf83e5,
         trf84e5,
         trf85e5,
         trf86e5,
         trf87e5,
         trf88e5,
         trf8e7,  # Antisocial behaviour - Agression subscale age 7 teacher report
         trf9e7,  
         trf10e7, 
         trf13e7, 
         trf14e7, 
         trf15e7, 
         trf16e7, 
         trf17e7, 
         trf18e7, 
         trf21e7, 
         trf27e7, 
         trf38e7, 
         trf47e7, 
         trf50e7, 
         trf51e7, 
         trf54e7, 
         trf56e7, 
         trf57e7, 
         trf61e7, 
         trf62e7, 
         trf66e7, 
         trf67e7, 
         trf68e7, 
         trf69e7, 
         trf74e7, 
         trf20e7,  # Antisocial behaviour - Delinquent subscale age 7 teacher report
         trf29e7, 
         trf31e7, 
         trf48e7, 
         trf60e7, 
         trf65e7, 
         trf70e7, 
         trf71e7, 
         trf79e7, 
         trf80e7, # Antisocial behaviour - Conduct and Oppositional Defiant subscale age 7 teacher report 
         trf81e7,
         trf82e7,
         trf83e7,
         trf84e7,
         trf85e7,
         trf86e7,
         trf87e7,
         trf88e7,
         trf8e10,  # Antisocial behaviour - Agression subscale age 10 teacher report
         trf9e10,  
         trf10e10, 
         trf13e10, 
         trf14e10, 
         trf15e10, 
         trf16e10, 
         trf17e10, 
         trf18e10, 
         trf21e10, 
         trf27e10, 
         trf38e10, 
         trf47e10, 
         trf50e10, 
         trf51e10, 
         trf54e10, 
         trf56e10, 
         trf57e10, 
         trf61e10, 
         trf62e10, 
         trf66e10, 
         trf67e10, 
         trf68e10, 
         trf69e10, 
         trf74e10, 
         trf20e10,  # Antisocial behaviour - Delinquent subscale age 10 teacher report
         trf29e10, 
         trf31e10, 
         trf48e10, 
         trf60e10, 
         trf65e10, 
         trf70e10, 
         trf71e10, 
         trf79e10, 
         trf80e10, # Antisocial behaviour - Conduct and Oppositional Defiant subscale age 10 teacher report 
         trf81e10,
         trf82e10,
         trf83e10,
         trf84e10,
         trf85e10,
         trf86e10,
         trf87e10,
         trf88e10,
         trf8e12,  # Antisocial behaviour - Agression subscale age 12 teacher report
         trf9e12,  
         trf10e12, 
         trf13e12, 
         trf14e12, 
         trf15e12, 
         trf16e12, 
         trf17e12, 
         trf18e12, 
         trf21e12, 
         trf27e12, 
         trf38e12, 
         trf47e12, 
         trf50e12, 
         trf51e12, 
         trf54e12, 
         trf56e12, 
         trf57e12, 
         trf61e12, 
         trf62e12, 
         trf66e12, 
         trf67e12, 
         trf68e12, 
         trf69e12, 
         trf74e12, 
         trf20e12,  # Antisocial behaviour - Delinquent subscale age 12 teacher report
         trf29e12, 
         trf31e12, 
         trf48e12, 
         trf60e12, 
         trf65e12, 
         trf70e12, 
         trf71e12, 
         trf79e12, 
         trf80e12, # Antisocial behaviour - Conduct and Oppositional Defiant subscale age 12 teacher report 
         trf81e12,
         trf82e12,
         trf83e12,
         trf84e12,
         trf85e12,
         trf86e12,
         trf87e12,
         trf88e12
  )

colnames(dat)
```

***

```{r functions}
# Table of model fit 
table.model.fit <- function(model){
  model.fit <- as.data.frame(t(as.data.frame(model$FIT))) %>%
    dplyr::select(chisq, df, chisq.scaled, cfi.robust, tli.robust, rmsea.robust, rmsea.ci.lower.robust, rmsea.ci.upper.robust, srmr) 
  return(model.fit)
}

# Table of regression and correlation (standardised covariance) coefficients
table.model.coef <- function(model, step){
  if (step == "S1"){
    model.coef <- as.tibble(model$PE[c(1:18,46),]) %>% dplyr::select(-exo, -std.lv, -std.nox)
    return(model.coef)
  } else if(step == "S2"){
    model.coef <- as.tibble(model$PE[c(1:18,46),]) %>% dplyr::select(-exo, -std.lv, -std.nox)
    return(model.coef)
  } else if(step == "S3"){
    model.coef <- as.tibble(model$PE[c(19:36,91),]) %>% dplyr::select(-exo, -std.lv, -std.nox)
    return(model.coef)
  } else if(step == "S4"){
    model.coef <- as.tibble(model$PE[c(19:36,91),]) %>% dplyr::select(-exo, -std.lv, -std.nox)
    return(model.coef)
  } else {model.coef <- NULL}
}
```

***

# Variable creation

We first create the joint age 7 and age 10 prosocial and antisocial behaviour.

## Mother report

```{r create the summed 7 and 10 prosocial mother}
# how many missing at age 7 and 10 
summary(dat$proem7)
summary(dat$proem10)

# number of participants missing age 7 and 10 data 
dat <- dat %>%
  mutate(proem710na = 
           if_else(
             is.na(proem7) & is.na(proem10), "Yes", "No")
  )
table(dat$proem710na)

# creating the 710 variable
dat <- dat %>%
  mutate(proem710 = 
           case_when(
             is.na(proem7) & is.na(proem10) ~ NA_real_,
             is.na(proem7) & !is.na(proem10) ~ as.numeric(proem10),
             is.na(proem10) & !is.na(proem7) ~ as.numeric(proem7),
             !is.na(proem7) & !is.na(proem10) ~ as.numeric(rowMeans(across(proem7:proem10))))
  )
summary(dat$proem710) # the NAs here should match the NAs from proem710na
```

```{r create the summed 7 and 10 prosocial mother}
# how many missing at age 7 and 10 
summary(dat$asbem7)
summary(dat$asbem10)

# number of participants missing age 7 and 10 data 
dat <- dat %>%
  mutate(asbem710na = 
           if_else(
             is.na(asbem7) & is.na(asbem10), "Yes", "No")
  )
table(dat$asbem710na)

# creating the 710 variable
dat <- dat %>%
  mutate(asbem710 = 
           case_when(
             is.na(asbem7) & is.na(asbem10) ~ NA_real_,
             is.na(asbem7) & !is.na(asbem10) ~ as.numeric(asbem10),
             is.na(asbem10) & !is.na(asbem7) ~ as.numeric(asbem7),
             !is.na(asbem7) & !is.na(asbem10) ~ as.numeric(rowMeans(across(asbem7:asbem10))))
  )
summary(dat$asbem710) # the NAs here should match the NAs from proem710na
```

## Teacher report

```{r create the summed 7 and 10 prosocial teacher}
# how many missing at age 7 and 10 
summary(dat$proet7)
summary(dat$proet10)

# number of participants missing age 7 and 10 data 
dat <- dat %>%
  mutate(proet710na = 
           if_else(
             is.na(proet7) & is.na(proet10), "Yes", "No")
  )
table(dat$proet710na)

# creating the 710 variable
dat <- dat %>%
  mutate(proet710 = 
           case_when(
             is.na(proet7) & is.na(proet10) ~ NA_real_,
             is.na(proet7) & !is.na(proet10) ~ as.numeric(proet10),
             is.na(proet10) & !is.na(proet7) ~ as.numeric(proet7),
             !is.na(proet7) & !is.na(proet10) ~ as.numeric(rowMeans(across(proet7:proet10))))
  )
summary(dat$proet710) # the NAs here should match the NAs from proem710na
```

```{r create the summed 7 and 10 prosocial}
# how many missing at age 7 and 10 
summary(dat$asbet7)
summary(dat$asbet10)

# number of participants missing age 7 and 10 data 
dat <- dat %>%
  mutate(asbet710na = 
           if_else(
             is.na(asbet7) & is.na(asbet10), "Yes", "No")
  )
table(dat$asbet710na)

# creating the 710 variable
dat <- dat %>%
  mutate(asbet710 = 
           case_when(
             is.na(asbet7) & is.na(asbet10) ~ NA_real_,
             is.na(asbet7) & !is.na(asbet10) ~ as.numeric(asbet10),
             is.na(asbet10) & !is.na(asbet7) ~ as.numeric(asbet7),
             !is.na(asbet7) & !is.na(asbet10) ~ as.numeric(rowMeans(across(asbet7:asbet10))))
  )
summary(dat$asbet710) # the NAs here should match the NAs from proem710na
```



```{r create the average 7 and 10 isolation mother}
# how many missing at age 7 and 10 
summary(dat$sisoem7)
summary(dat$sisoem10)

# number of participants missing age 7 and 10 data 
dat <- dat %>%
  mutate(sisoem710na = 
           if_else(
             is.na(sisoem7) & is.na(sisoem10), "Yes", "No")
  )
table(dat$sisoem710na)

# creating the 710 variable
dat <- dat %>%
  mutate(sisoem710 = 
           case_when(
             is.na(sisoem7) & is.na(sisoem10) ~ NA_real_,
             is.na(sisoem7) & !is.na(sisoem10) ~ as.numeric(sisoem10),
             is.na(sisoem10) & !is.na(sisoem7) ~ as.numeric(sisoem7),
             !is.na(sisoem7) & !is.na(sisoem10) ~ as.numeric(rowMeans(across(sisoem7:sisoem10))))
  )
summary(dat$sisoem710) # the NAs here should match the NAs above
```

```{r create the average 7 and 10 isolation teacher}
# how many missing at age 7 and 10 
summary(dat$sisoet7)
summary(dat$sisoet10)

# number of participants missing age 7 and 10 data 
dat <- dat %>%
  mutate(sisoet710na = 
           if_else(
             is.na(sisoet7) & is.na(sisoet10), "Yes", "No")
  )
table(dat$sisoet710na)

# creating the 710 variable
dat <- dat %>%
  mutate(sisoet710 = 
           case_when(
             is.na(sisoet7) & is.na(sisoet10) ~ NA_real_,
             is.na(sisoet7) & !is.na(sisoet10) ~ as.numeric(sisoet10),
             is.na(sisoet10) & !is.na(sisoet7) ~ as.numeric(sisoet7),
             !is.na(sisoet7) & !is.na(sisoet10) ~ as.numeric(rowMeans(across(sisoet7:sisoet10))))
  )
summary(dat$sisoet710) # the NAs here should match the NAs above
```

```{r create the average 7 and 10 ADHD mother}
# how many missing at age 7 and 10 
summary(dat$tadhdem7)
summary(dat$tadhdem10)

# number of participants missing age 7 and 10 data 
dat <- dat %>%
  mutate(tadhdem710na = 
           if_else(
             is.na(tadhdem7) & is.na(tadhdem10), "Yes", "No")
  )
table(dat$tadhdem710na)

# creating the 710 variable
dat <- dat %>%
  mutate(tadhdem710 = 
           case_when(
             is.na(tadhdem7) & is.na(tadhdem10) ~ NA_real_,
             is.na(tadhdem7) & !is.na(tadhdem10) ~ as.numeric(tadhdem10),
             is.na(tadhdem10) & !is.na(tadhdem7) ~ as.numeric(tadhdem7),
             !is.na(tadhdem7) & !is.na(tadhdem10) ~ as.numeric(rowMeans(across(tadhdem7:tadhdem10))))
  )
summary(dat$tadhdem710) # the NAs here should match the NAs above
```

```{r create the average 7 and 10 ADHD teacher}
# how many missing at age 7 and 10 
summary(dat$tadhdet7)
summary(dat$tadhdet10)

# number of participants missing age 7 and 10 data 
dat <- dat %>%
  mutate(tadhdet710na = 
           if_else(
             is.na(tadhdet7) & is.na(tadhdet10), "Yes", "No")
  )
table(dat$tadhdet710na)

# creating the 710 variable
dat <- dat %>%
  mutate(tadhdet710 = 
           case_when(
             is.na(tadhdet7) & is.na(tadhdet10) ~ NA_real_,
             is.na(tadhdet7) & !is.na(tadhdet10) ~ as.numeric(tadhdet10),
             is.na(tadhdet10) & !is.na(tadhdet7) ~ as.numeric(tadhdet7),
             !is.na(tadhdet7) & !is.na(tadhdet10) ~ as.numeric(rowMeans(across(tadhdet7:tadhdet10))))
  )
summary(dat$tadhdet710) # the NAs here should match the NAs above
```

```{r create the average 7 and 10 hyperactivity mother}
# how many missing at age 7 and 10 
summary(dat$hyem7)
summary(dat$hyem10)

# number of participants missing age 7 and 10 data 
dat <- dat %>%
  mutate(hyem710na = 
           if_else(
             is.na(hyem7) & is.na(hyem10), "Yes", "No")
  )
table(dat$hyem710na)

# creating the 710 variable
dat <- dat %>%
  mutate(hyem710 = 
           case_when(
             is.na(hyem7) & is.na(hyem10) ~ NA_real_,
             is.na(hyem7) & !is.na(hyem10) ~ as.numeric(hyem10),
             is.na(hyem10) & !is.na(hyem7) ~ as.numeric(hyem7),
             !is.na(hyem7) & !is.na(hyem10) ~ as.numeric(rowMeans(across(hyem7:hyem10))))
  )
summary(dat$hyem710) # the NAs here should match the NAs above
```

```{r create the average 7 and 10 hyperactivity teacher}
# how many missing at age 7 and 10 
summary(dat$hyet7)
summary(dat$hyet10)

# number of participants missing age 7 and 10 data 
dat <- dat %>%
  mutate(hyet710na = 
           if_else(
             is.na(hyet7) & is.na(hyet10), "Yes", "No")
  )
table(dat$hyet710na)

# creating the 710 variable
dat <- dat %>%
  mutate(hyet710 = 
           case_when(
             is.na(hyet7) & is.na(hyet10) ~ NA_real_,
             is.na(hyet7) & !is.na(hyet10) ~ as.numeric(hyet10),
             is.na(hyet10) & !is.na(hyet7) ~ as.numeric(hyet7),
             !is.na(hyet7) & !is.na(hyet10) ~ as.numeric(rowMeans(across(hyet7:hyet10))))
  )
summary(dat$hyet710) # the NAs here should match the NAs above
```

```{r create the average 7 and 10 inattention mother}
# how many missing at age 7 and 10 
summary(dat$inem7)
summary(dat$inem10)

# number of participants missing age 7 and 10 data 
dat <- dat %>%
  mutate(inem710na = 
           if_else(
             is.na(inem7) & is.na(inem10), "Yes", "No")
  )
table(dat$inem710na)

# creating the 710 variable
dat <- dat %>%
  mutate(inem710 = 
           case_when(
             is.na(inem7) & is.na(inem10) ~ NA_real_,
             is.na(inem7) & !is.na(inem10) ~ as.numeric(inem10),
             is.na(inem10) & !is.na(inem7) ~ as.numeric(inem7),
             !is.na(inem7) & !is.na(inem10) ~ as.numeric(rowMeans(across(inem7:inem10))))
  )
summary(dat$inem710) # the NAs here should match the NAs above
```

```{r create the average 7 and 10 inattention teacher}
# how many missing at age 7 and 10 
summary(dat$inet7)
summary(dat$inet10)

# number of participants missing age 7 and 10 data 
dat <- dat %>%
  mutate(inet710na = 
           if_else(
             is.na(inet7) & is.na(inet10), "Yes", "No")
  )
table(dat$inet710na)

# creating the 710 variable
dat <- dat %>%
  mutate(inet710 = 
           case_when(
             is.na(inet7) & is.na(inet10) ~ NA_real_,
             is.na(inet7) & !is.na(inet10) ~ as.numeric(inet10),
             is.na(inet10) & !is.na(inet7) ~ as.numeric(inet7),
             !is.na(inet7) & !is.na(inet10) ~ as.numeric(rowMeans(across(inet7:inet10))))
  )
summary(dat$inet710) # the NAs here should match the NAs above
```

# Simple mediation

The simple mediation that we will be testing is does pro/antisocial behaviour at age 7/10 mediate the association between social isolation at age 5 and ADHD at age 12. 

![Exmaple prosocial behaviour (PSB) mediation model](/Users/katiethompson/Documents/PhD/LISS-DTP_Louise_and_Tim/Social isolation heritability_Paper 2/data_analysis/scripts/scripts_github/mediation_PSB.jpg)

* How do we separate out with person and between person change in mediation models?
* Hwo do we account for the twin data here when it's suggested to use bootstrapepd standard errors rather than robust ones. 

## Mother report

### Prosocial behaviour 

```{r med.simp.pro.m}
med.simp.pro.m <- ' 
                  # direct effect
                   sisoem12 ~ c*tadhdem5
                  
                  # mediator
                   proem710 ~ a*tadhdem5
                   sisoem12 ~ b*proem710
                  
                  # indirect effect (a*b)
                   indirect := a*b
                  
                  # total effect
                   total := c + (a*b)
         '
```

```{r  fit med.simp.pro.m}
med.simp.pro.fit <- sem(model = med.simp.pro.m, 
                        data = dat,
                        se = "bootstrap",
                        estimator = "ML")

med.simp.pro.fit.summary <- summary(med.simp.pro.fit, standardized = TRUE)
```

### Antisocial behaviour 

```{r med.simp.asb.m}
med.simp.asb.m <- ' 
                  # direct effect
                   sisoem12 ~ c*tadhdem5
                  
                  # mediator
                   asbem710 ~ a*tadhdem5
                   sisoem12 ~ b*asbem710
                  
                  # indirect effect (a*b)
                   indirect := a*b
                  
                  # total effect
                   total := c + (a*b)
         '
```

```{r  fit med.simp.asb.m}
med.simp.asb.fit <- sem(model = med.simp.asb.m, 
                        data = dat,
                        se = "bootstrap",
                        estimator = "ML")

med.simp.asb.fit.summary <- summary(med.simp.asb.fit, standardized = TRUE)
```

## Teacher report

### Prosocial behaviour 

```{r med.simp.pro.t}
med.simp.pro.t <- ' 
                  # direct effect
                   sisoet12 ~ c*tadhdet5
                  
                  # mediator
                   proet710 ~ a*tadhdet5
                   sisoet12 ~ b*proet710
                  
                  # indirect effect (a*b)
                   indirect := a*b
                  
                  # total effect
                   total := c + (a*b)
         '
```

```{r  fit med.simp.pro.t}
med.simp.pro.fit <- sem(model = med.simp.pro.t, 
                        data = dat,
                        se = "bootstrap",
                        estimator = "ML")

med.simp.pro.fit.summary <- summary(med.simp.pro.fit, standardized = TRUE)
```

### Antisocial behaviour 

```{r med.simp.asb.t}
med.simp.asb.t <- ' 
                  # direct effect
                   sisoet12 ~ c*tadhdet5
                  
                  # mediator
                   asbet710 ~ a*tadhdet5
                   sisoet12 ~ b*asbet710
                  
                  # indirect effect (a*b)
                   indirect := a*b
                  
                  # total effect
                   total := c + (a*b)
         '
```

```{r fit med.simp.asb.t}
med.simp.asb.fit <- sem(model = med.simp.asb.t, 
                        data = dat,
                        se = "bootstrap",
                        estimator = "ML")

med.simp.asb.fit.summary <- summary(med.simp.asb.fit, standardized = TRUE)
```

***

# Longitudinal mediation models

**For each reporter and set of ADHD symptoms, we present four models:**
 * Step 1: the mediation model which is an extension of the CLPM - rather than two variables, we now have three and can calculate the mediation path. 
 * Step 2: the constrained CLPM mediation model - autoregressive (a) and crosslag (2b) parameters will be constrained over time. 
 * Step 3: Add in random intercepts to create a three variable RI-CLPM where the mediation path can be calculated whilst accounting for between person differences. 
 * Step 4: the constrained RI-CLPM mediation model - crosslags and autoregressive lags will be constrained over time. 

We already know the direction of the association - ADHD predicts later social isolation. Therefore the labeled mediator paths are (for example): `proem710 ~ a*tadhdem5` and `sisoem12 ~ b*proem710`. The indirect mediation effect is then calculated using `indirect := a*b`.
                              
                            
Our code could be synthesized further by combining regression paths, however aid clarity of which paths have been estimated all path coefficients are written out in full.

Model notation is as follows: 
* med = mediation model
* long = longitudinal
* sat = saturated
* pro = prosocial
* m = mother report
* t = teacher report
* hyp = hyperactivity 
* inat = inattention
* ri = random intercepts

The "direct c paths" have not been estimated here. Therefore, for all models, the effects from age 5 have to go through age 7/10 and are not directly associated with age 12. To estimate these effects, you can add this code:

          ###### Direct effects (age 5 to 12) ######
                  
                   sisoem12 ~ c*tadhdem5
                   proem12 ~ tadhdem5
                   tadhdem12 ~ tadhdem5
                   
                   sisoem12 ~ proem5
                   proem12 ~ proem5
                   tadhdem12 ~ proem5
                   
                   sisoem12 ~ sisoem5
                   proem12 ~ sisoem5
                   tadhdem12 ~ sisoem5
                   
         ###### total effect ######
                   total := c + (a*b)

### Mother report

#### Prosocial behaviour 

##### Total ADHD symptoms 

###### 1. The CLPM mediation model 

```{r med.long.pro.m}
med.long.pro.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ sisoem5
                  sisoem12 ~ sisoem710
                  ## Pro social bahviour
                  proem710 ~ proem5
                  proem12 ~ proem710
                  ## ADHD
                  tadhdem710 ~ tadhdem5
                  tadhdem12 ~ tadhdem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  tadhdem710 ~ sisoem5
                  tadhdem12 ~ sisoem710
                  ## ADHD
                  sisoem710 ~ tadhdem5
                  sisoem12 ~ tadhdem710
                  ## Prosocial
                  sisoem710 ~ proem5
                  tadhdem710 ~ proem5
                  proem12 ~ sisoem710
                  proem12 ~ tadhdem710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proem710 ~ a*tadhdem5 
                  sisoem12 ~ b*proem710
                  ## Isolation to ADHD
                  proem710 ~ sisoem5
                  tadhdem12 ~ proem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ proem5
                  proem5 ~~ tadhdem5
                  sisoem5 ~~ tadhdem5
                  sisoem710 ~~ proem710
                  proem710 ~~ tadhdem710
                  sisoem710 ~~ tadhdem710
                  sisoem12 ~~ proem12
                  proem12 ~~ tadhdem12
                  sisoem12 ~~ tadhdem12
                    
                  ###### Variances ######
                  ## Variances
                  tadhdem5 ~~ tadhdem5 
                  sisoem5 ~~ sisoem5 
                  proem5 ~~ proem5
                  ## Residual variances
                  tadhdem710 ~~ tadhdem710 
                  sisoem710 ~~ sisoem710 
                  proem710 ~~ proem710
                  tadhdem12 ~~ tadhdem12 
                  sisoem12 ~~ sisoem12
                  proem12 ~~ proem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med.long.pro.m}
med.long.pro.m.fit <- lavaan(model = med.long.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long.pro.m.fit.summary <- summary(med.long.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 2a. Constrained autoregressive paths CLPM mediation model 

```{r med.long2a.pro.m}
med.long2a.pro.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ c*sisoem5
                  sisoem12 ~ c*sisoem710
                  ## Pro social bahviour
                  proem710 ~ d*proem5
                  proem12 ~ d*proem710
                  ## ADHD
                  tadhdem710 ~ e*tadhdem5
                  tadhdem12 ~ e*tadhdem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  tadhdem710 ~ sisoem5
                  tadhdem12 ~ sisoem710
                  ## ADHD
                  sisoem710 ~ tadhdem5
                  sisoem12 ~ tadhdem710
                  ## Prosocial
                  sisoem710 ~ proem5
                  tadhdem710 ~ proem5
                  proem12 ~ sisoem710
                  proem12 ~ tadhdem710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proem710 ~ a*tadhdem5 
                  sisoem12 ~ b*proem710
                  ## Isolation to ADHD
                  proem710 ~ sisoem5
                  tadhdem12 ~ proem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ proem5
                  proem5 ~~ tadhdem5
                  sisoem5 ~~ tadhdem5
                  sisoem710 ~~ proem710
                  proem710 ~~ tadhdem710
                  sisoem710 ~~ tadhdem710
                  sisoem12 ~~ proem12
                  proem12 ~~ tadhdem12
                  sisoem12 ~~ tadhdem12
                    
                  ###### Variances ######
                  ## Variances
                  tadhdem5 ~~ tadhdem5 
                  sisoem5 ~~ sisoem5 
                  proem5 ~~ proem5
                  ## Residual variances
                  tadhdem710 ~~ tadhdem710 
                  sisoem710 ~~ sisoem710 
                  proem710 ~~ proem710
                  tadhdem12 ~~ tadhdem12 
                  sisoem12 ~~ sisoem12
                  proem12 ~~ proem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med.long2a.pro.m}
med.long2a.pro.m.fit <- lavaan(model = med.long2a.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long2a.pro.m.fit.summary <- summary(med.long2a.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med.long.pro.m.fit and med.long2a.pro.m.fit}
lavTestLRT(med.long.pro.m.fit, med.long2a.pro.m.fit, method = "satorra.bentler.2010")
```

Constrained autoregressive paths lead to significantly worse model fit. 

###### 2b. Constrained crosslag paths CLPM mediation model 

```{r med.long2b.pro.m}
med.long2b.pro.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ sisoem5
                  sisoem12 ~ sisoem710
                  ## Pro social bahviour
                  proem710 ~ proem5
                  proem12 ~ proem710
                  ## ADHD
                  tadhdem710 ~ tadhdem5
                  tadhdem12 ~ tadhdem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  tadhdem710 ~ e*sisoem5
                  tadhdem12 ~ e*sisoem710
                  proem12 ~ c*sisoem710
                  ## ADHD
                  sisoem710 ~ f*tadhdem5
                  sisoem12 ~ f*tadhdem710
                  proem12 ~ a*tadhdem710
                  ## Prosocial
                  sisoem710 ~ b*proem5
                  tadhdem710 ~ d*proem5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proem710 ~ a*tadhdem5 
                  sisoem12 ~ b*proem710
                  ## Isolation to ADHD
                  proem710 ~ c*sisoem5
                  tadhdem12 ~ d*proem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ proem5
                  proem5 ~~ tadhdem5
                  sisoem5 ~~ tadhdem5
                  sisoem710 ~~ proem710
                  proem710 ~~ tadhdem710
                  sisoem710 ~~ tadhdem710
                  sisoem12 ~~ proem12
                  proem12 ~~ tadhdem12
                  sisoem12 ~~ tadhdem12
                    
                  ###### Variances ######
                  ## Variances
                  tadhdem5 ~~ tadhdem5 
                  sisoem5 ~~ sisoem5 
                  proem5 ~~ proem5
                  ## Residual variances
                  tadhdem710 ~~ tadhdem710 
                  sisoem710 ~~ sisoem710 
                  proem710 ~~ proem710
                  tadhdem12 ~~ tadhdem12 
                  sisoem12 ~~ sisoem12
                  proem12 ~~ proem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med.long.pro.m}
med.long2b.pro.m.fit <- lavaan(model = med.long2b.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long2b.pro.m.fit.summary <- summary(med.long2b.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med.long.pro.m.fit and med.long2b.pro.m.fit}
lavTestLRT(med.long.pro.m.fit, med.long2b.pro.m.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.1009). Therefore this model 2b will be carried forward.

```{r results table for mother report prosocial and total adhd}
# Model fit 
med.long2b.pro.m.fit.summary.fit <- table.model.fit(med.long2b.pro.m.fit.summary)
# Coefficients
med.long2b.pro.m.fit.summary.reg <- table.model.coef(model = med.long2b.pro.m.fit.summary, step = "S2")
```

Results show that 
* All significant autoregressive lags 
* Isolation does *not* predict later ADHD (e)
* Isolation predicts later lower prosocial behaviours (c)
* ADHD predicts later isolation (f)
* Prosocial behaviours predict later lower ADHD (d)
* ADHD predicts later lower prosocial behaviours (a)
* Prosocial behaviours predict later lower isolation (b)
* Significant indirect mediation path (a*b, p=0.001). ADHD -> lower prosocial behaviours -> isolation

###### 3. The RI-CLPM mediation model 

```{r ri.med.long.pro.m}
ri.med.long.pro.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhdem5 + 1*tadhdem710 + 1*tadhdem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIpro =~ 1*proem5 + 1*proem710 + 1*proem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*tadhdem5
                  wad710 =~ 1*tadhdem710
                  wad12 =~ 1*tadhdem12
                  ## Prosocial 
                  wpro5 =~ 1*proem5
                  wpro710 =~ 1*proem710
                  wpro12 =~ 1*proem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## Pro social bahviour
                  wpro710 ~ wpro5
                  wpro12 ~ wpro710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  ## Prosocial
                  wsi710 ~ wpro5
                  wad710 ~ wpro5
                  wpro12 ~ wsi710
                  wpro12 ~ wad710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ wsi5
                  wad12 ~ wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med.long.pro.m}
ri.med.long.pro.m.fit <- lavaan(model = ri.med.long.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long.pro.m.fit.summary <- summary(ri.med.long.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 4a. Constrained autoregressive RI-CLPM mediation model 

```{r ri.med.long4a.pro.m}
ri.med.long4a.pro.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhdem5 + 1*tadhdem710 + 1*tadhdem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIpro =~ 1*proem5 + 1*proem710 + 1*proem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*tadhdem5
                  wad710 =~ 1*tadhdem710
                  wad12 =~ 1*tadhdem12
                  ## Prosocial 
                  wpro5 =~ 1*proem5
                  wpro710 =~ 1*proem710
                  wpro12 =~ 1*proem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ c*wsi5
                  wsi12 ~ c*wsi710
                  ## Pro social bahviour
                  wpro710 ~ d*wpro5
                  wpro12 ~ d*wpro710
                  ## ADHD
                  wad710 ~ e*wad5
                  wad12 ~ e*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  wpro12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  wpro12 ~ wad710
                  ## Prosocial
                  wsi710 ~ wpro5
                  wad710 ~ wpro5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ wsi5
                  wad12 ~ wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med.long4a.pro.m}
ri.med.long4a.pro.m.fit <- lavaan(model = ri.med.long4a.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long4a.pro.m.fit.summary <- summary(ri.med.long4a.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med.long.pro.m.fit and ri.med.long4a.pro.m.fit}
lavTestLRT(ri.med.long.pro.m.fit, ri.med.long4a.pro.m.fit, method = "satorra.bentler.2010")
```

**There is no p value for the chi square difference test here?????**

###### 4b. Constrained cross-lag RI-CLPM mediation model 

```{r ri.med.long4b.pro.m}
ri.med.long4b.pro.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhdem5 + 1*tadhdem710 + 1*tadhdem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIpro =~ 1*proem5 + 1*proem710 + 1*proem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*tadhdem5
                  wad710 =~ 1*tadhdem710
                  wad12 =~ 1*tadhdem12
                  ## Prosocial 
                  wpro5 =~ 1*proem5
                  wpro710 =~ 1*proem710
                  wpro12 =~ 1*proem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## Pro social bahviour
                  wpro710 ~ wpro5
                  wpro12 ~ wpro710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ e*wsi5
                  wad12 ~ e*wsi710
                  wpro12 ~ c*wsi710
                  ## ADHD
                  wsi710 ~ f*wad5
                  wsi12 ~ f*wad710
                  wpro12 ~ a*wad710
                  ## Prosocial
                  wsi710 ~ b*wpro5
                  wad710 ~ d*wpro5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ c*wsi5
                  wad12 ~ d*wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med.long4b.pro.m}
ri.med.long4b.pro.m.fit <- lavaan(model = ri.med.long4b.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long4b.pro.m.fit.summary <- summary(ri.med.long4b.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med.long.pro.m.fit and ri.med.long4a.pro.m.fit}
lavTestLRT(ri.med.long.pro.m.fit, ri.med.long4b.pro.m.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=1). Therefore this model 4b will be carried forward.

```{r results table for random intercept mother report prosocial and total adhd}
# Model fit 
ri.med.long4b.pro.m.fit.summary.fit <- table.model.fit(ri.med.long4b.pro.m.fit.summary)
# Coefficients
ri.med.long4b.pro.m.fit.summary.reg <- table.model.coef(model = ri.med.long4b.pro.m.fit.summary, step = "S4")
```

Results show that 
* All significant autoregressive lags 
* Isolation does *not* predict later ADHD (e)
* Isolation does *not* predict later lower prosocial behaviours (c)
* ADHD **does not** predict later isolation (f)
* Prosocial behaviours *do not* predict later lower ADHD (d)
* ADHD predicts later lower prosocial behaviours (a)
* Prosocial behaviours *do not* predict later lower isolation (b)
* **Nonsignificant** indirect mediation path (a*b, p=0.1). ADHD -> lower prosocial behaviours -> isolation


##### Hyperactivity symptoms 

###### 1. The CLPM mediation model 

```{r med_hyp.long.pro.m}
med_hyp.long.pro.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ sisoem5
                  sisoem12 ~ sisoem710
                  ## Pro social bahviour
                  proem710 ~ proem5
                  proem12 ~ proem710
                  ## ADHD
                  hyem710 ~ hyem5
                  hyem12 ~ hyem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  hyem710 ~ sisoem5
                  hyem12 ~ sisoem710
                  ## ADHD
                  sisoem710 ~ hyem5
                  sisoem12 ~ hyem710
                  ## Prosocial
                  sisoem710 ~ proem5
                  hyem710 ~ proem5
                  proem12 ~ sisoem710
                  proem12 ~ hyem710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proem710 ~ a*hyem5 
                  sisoem12 ~ b*proem710
                  ## Isolation to ADHD
                  proem710 ~ sisoem5
                  hyem12 ~ proem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ proem5
                  proem5 ~~ hyem5
                  sisoem5 ~~ hyem5
                  sisoem710 ~~ proem710
                  proem710 ~~ hyem710
                  sisoem710 ~~ hyem710
                  sisoem12 ~~ proem12
                  proem12 ~~ hyem12
                  sisoem12 ~~ hyem12
                    
                  ###### Variances ######
                  ## Variances
                  hyem5 ~~ hyem5 
                  sisoem5 ~~ sisoem5 
                  proem5 ~~ proem5
                  ## Residual variances
                  hyem710 ~~ hyem710 
                  sisoem710 ~~ sisoem710 
                  proem710 ~~ proem710
                  hyem12 ~~ hyem12 
                  sisoem12 ~~ sisoem12
                  proem12 ~~ proem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_hyp.long.pro.m}
med_hyp.long.pro.m.fit <- lavaan(model = med_hyp.long.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long.pro.m.fit.summary <- summary(med_hyp.long.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 2a. Constrained autoregressive paths CLPM mediation model 

```{r med_hyp.long2a.pro.m}
med_hyp.long2a.pro.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ c*sisoem5
                  sisoem12 ~ c*sisoem710
                  ## Pro social bahviour
                  proem710 ~ d*proem5
                  proem12 ~ d*proem710
                  ## ADHD
                  hyem710 ~ e*hyem5
                  hyem12 ~ e*hyem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  hyem710 ~ sisoem5
                  hyem12 ~ sisoem710
                  ## ADHD
                  sisoem710 ~ hyem5
                  sisoem12 ~ hyem710
                  ## Prosocial
                  sisoem710 ~ proem5
                  hyem710 ~ proem5
                  proem12 ~ sisoem710
                  proem12 ~ hyem710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proem710 ~ a*hyem5 
                  sisoem12 ~ b*proem710
                  ## Isolation to ADHD
                  proem710 ~ sisoem5
                  hyem12 ~ proem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ proem5
                  proem5 ~~ hyem5
                  sisoem5 ~~ hyem5
                  sisoem710 ~~ proem710
                  proem710 ~~ hyem710
                  sisoem710 ~~ hyem710
                  sisoem12 ~~ proem12
                  proem12 ~~ hyem12
                  sisoem12 ~~ hyem12
                    
                  ###### Variances ######
                  ## Variances
                  hyem5 ~~ hyem5 
                  sisoem5 ~~ sisoem5 
                  proem5 ~~ proem5
                  ## Residual variances
                  hyem710 ~~ hyem710 
                  sisoem710 ~~ sisoem710 
                  proem710 ~~ proem710
                  hyem12 ~~ hyem12 
                  sisoem12 ~~ sisoem12
                  proem12 ~~ proem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_hyp.long2a.pro.m}
med_hyp.long2a.pro.m.fit <- lavaan(model = med_hyp.long2a.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long2a.pro.m.fit.summary <- summary(med_hyp.long2a.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_hyp.long.pro.m.fit and med_hyp.long2a.pro.m.fit}
lavTestLRT(med_hyp.long.pro.m.fit, med_hyp.long2a.pro.m.fit, method = "satorra.bentler.2010")
```

Constrained autoregressive paths lead to significantly worse model fit. 

###### 2b. Constrained crosslag paths CLPM mediation model 

```{r med_hyp.long2b.pro.m}
med_hyp.long2b.pro.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ sisoem5
                  sisoem12 ~ sisoem710
                  ## Pro social bahviour
                  proem710 ~ proem5
                  proem12 ~ proem710
                  ## ADHD
                  hyem710 ~ hyem5
                  hyem12 ~ hyem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  hyem710 ~ e*sisoem5
                  hyem12 ~ e*sisoem710
                  proem12 ~ c*sisoem710
                  ## ADHD
                  sisoem710 ~ f*hyem5
                  sisoem12 ~ f*hyem710
                  proem12 ~ a*hyem710
                  ## Prosocial
                  sisoem710 ~ b*proem5
                  hyem710 ~ d*proem5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proem710 ~ a*hyem5 
                  sisoem12 ~ b*proem710
                  ## Isolation to ADHD
                  proem710 ~ c*sisoem5
                  hyem12 ~ d*proem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ proem5
                  proem5 ~~ hyem5
                  sisoem5 ~~ hyem5
                  sisoem710 ~~ proem710
                  proem710 ~~ hyem710
                  sisoem710 ~~ hyem710
                  sisoem12 ~~ proem12
                  proem12 ~~ hyem12
                  sisoem12 ~~ hyem12
                    
                  ###### Variances ######
                  ## Variances
                  hyem5 ~~ hyem5 
                  sisoem5 ~~ sisoem5 
                  proem5 ~~ proem5
                  ## Residual variances
                  hyem710 ~~ hyem710 
                  sisoem710 ~~ sisoem710 
                  proem710 ~~ proem710
                  hyem12 ~~ hyem12 
                  sisoem12 ~~ sisoem12
                  proem12 ~~ proem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_hyp.long.pro.m}
med_hyp.long2b.pro.m.fit <- lavaan(model = med_hyp.long2b.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long2b.pro.m.fit.summary <- summary(med_hyp.long2b.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_hyp.long.pro.m.fit and med_hyp.long2b.pro.m.fit}
lavTestLRT(med_hyp.long.pro.m.fit, med_hyp.long2b.pro.m.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.3019). Therefore this model 2b will be carried forward.

```{r results table for mother report prosocial and total adhd}
# Model fit 
med_hyp.long2b.pro.m.fit.summary.fit <- table.model.fit(med_hyp.long2b.pro.m.fit.summary)
# Coefficients
med_hyp.long2b.pro.m.fit.summary.reg <- table.model.coef(model = med_hyp.long2b.pro.m.fit.summary, step = "S2")
```

Results show that 
* All significant autoregressive lags
* Isolation predicts later ADHD (e)
* Isolation predicts later lower prosocial behaviours (c)
* ADHD predicts later isolation (f)
* Prosocial behaviours predict later lower ADHD (d)
* ADHD predicts later lower prosocial behaviours (a)
* Prosocial behaviours predict later lower isolation (b)
* Significant indirect mediation path (a*b, p=0.0007). ADHD -> lower prosocial behaviours -> isolation

###### 3. The RI-CLPM mediation model 

```{r ri.med_hyp.long.pro.m}
ri.med_hyp.long.pro.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hyem5 + 1*hyem710 + 1*hyem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIpro =~ 1*proem5 + 1*proem710 + 1*proem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*hyem5
                  wad710 =~ 1*hyem710
                  wad12 =~ 1*hyem12
                  ## Prosocial 
                  wpro5 =~ 1*proem5
                  wpro710 =~ 1*proem710
                  wpro12 =~ 1*proem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## Pro social bahviour
                  wpro710 ~ wpro5
                  wpro12 ~ wpro710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  ## Prosocial
                  wsi710 ~ wpro5
                  wad710 ~ wpro5
                  wpro12 ~ wsi710
                  wpro12 ~ wad710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ wsi5
                  wad12 ~ wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_hyp.long.pro.m}
ri.med_hyp.long.pro.m.fit <- lavaan(model = ri.med_hyp.long.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long.pro.m.fit.summary <- summary(ri.med_hyp.long.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 4a. Constrained autoregressive RI-CLPM mediation model 

```{r ri.med_hyp.long4a.pro.m}
ri.med_hyp.long4a.pro.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hyem5 + 1*hyem710 + 1*hyem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIpro =~ 1*proem5 + 1*proem710 + 1*proem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*hyem5
                  wad710 =~ 1*hyem710
                  wad12 =~ 1*hyem12
                  ## Prosocial 
                  wpro5 =~ 1*proem5
                  wpro710 =~ 1*proem710
                  wpro12 =~ 1*proem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ c*wsi5
                  wsi12 ~ c*wsi710
                  ## Pro social bahviour
                  wpro710 ~ d*wpro5
                  wpro12 ~ d*wpro710
                  ## ADHD
                  wad710 ~ e*wad5
                  wad12 ~ e*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  wpro12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  wpro12 ~ wad710
                  ## Prosocial
                  wsi710 ~ wpro5
                  wad710 ~ wpro5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ wsi5
                  wad12 ~ wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_hyp.long4a.pro.m}
ri.med_hyp.long4a.pro.m.fit <- lavaan(model = ri.med_hyp.long4a.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

# ri.med_hyp.long4a.pro.m.fit.summary <- summary(ri.med_hyp.long4a.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

**This model did not converge - is there something wrong with the 4a models??**
```{r LRT for ri.med_hyp.long.pro.m.fit and ri.med_hyp.long4a.pro.m.fit}
# lavTestLRT(ri.med_hyp.long.pro.m.fit, ri.med_hyp.long4a.pro.m.fit, method = "satorra.bentler.2010")
```

###### 4b. Constrained cross-lag RI-CLPM mediation model 

```{r ri.med_hyp.long4b.pro.m}
ri.med_hyp.long4b.pro.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hyem5 + 1*hyem710 + 1*hyem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIpro =~ 1*proem5 + 1*proem710 + 1*proem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*hyem5
                  wad710 =~ 1*hyem710
                  wad12 =~ 1*hyem12
                  ## Prosocial 
                  wpro5 =~ 1*proem5
                  wpro710 =~ 1*proem710
                  wpro12 =~ 1*proem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## Pro social bahviour
                  wpro710 ~ wpro5
                  wpro12 ~ wpro710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ e*wsi5
                  wad12 ~ e*wsi710
                  wpro12 ~ c*wsi710
                  ## ADHD
                  wsi710 ~ f*wad5
                  wsi12 ~ f*wad710
                  wpro12 ~ a*wad710
                  ## Prosocial
                  wsi710 ~ b*wpro5
                  wad710 ~ d*wpro5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ c*wsi5
                  wad12 ~ d*wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_hyp.long4b.pro.m}
ri.med_hyp.long4b.pro.m.fit <- lavaan(model = ri.med_hyp.long4b.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long4b.pro.m.fit.summary <- summary(ri.med_hyp.long4b.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_hyp.long.pro.m.fit and ri.med_hyp.long4a.pro.m.fit}
lavTestLRT(ri.med_hyp.long.pro.m.fit, ri.med_hyp.long4b.pro.m.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.4466). Therefore this model 4b will be carried forward.

```{r results table for random intercept mother report prosocial and total adhd}
# Model fit 
ri.med_hyp.long4b.pro.m.fit.summary.fit <- table.model.fit(ri.med_hyp.long4b.pro.m.fit.summary)
# Coefficients
ri.med_hyp.long4b.pro.m.fit.summary.reg <- table.model.coef(model = ri.med_hyp.long4b.pro.m.fit.summary, step = "S4")
```

Results show that 
* All significant autoregressive lags 
* Isolation does *not* predict later ADHD (e)
* Isolation does *not* predict later lower prosocial behaviours (c)
* ADHD **does** predict later isolation (p=0.019) (f)
* Prosocial behaviours *do not* predict later lower ADHD (d)
* ADHD **does** predict later lower prosocial behaviours (a)
* Prosocial behaviours *do not* predict later lower isolation (b)
* **Nonsignificant** indirect mediation path (a*b, p=0.141). ADHD -> lower prosocial behaviours -> isolation



##### Inattention symptoms 

###### 1. The CLPM mediation model 

```{r med_inat.long.pro.m}
med_inat.long.pro.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ sisoem5
                  sisoem12 ~ sisoem710
                  ## Pro social bahviour
                  proem710 ~ proem5
                  proem12 ~ proem710
                  ## ADHD
                  inem710 ~ inem5
                  inem12 ~ inem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  inem710 ~ sisoem5
                  inem12 ~ sisoem710
                  ## ADHD
                  sisoem710 ~ inem5
                  sisoem12 ~ inem710
                  ## Prosocial
                  sisoem710 ~ proem5
                  inem710 ~ proem5
                  proem12 ~ sisoem710
                  proem12 ~ inem710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proem710 ~ a*inem5 
                  sisoem12 ~ b*proem710
                  ## Isolation to ADHD
                  proem710 ~ sisoem5
                  inem12 ~ proem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ proem5
                  proem5 ~~ inem5
                  sisoem5 ~~ inem5
                  sisoem710 ~~ proem710
                  proem710 ~~ inem710
                  sisoem710 ~~ inem710
                  sisoem12 ~~ proem12
                  proem12 ~~ inem12
                  sisoem12 ~~ inem12
                    
                  ###### Variances ######
                  ## Variances
                  inem5 ~~ inem5 
                  sisoem5 ~~ sisoem5 
                  proem5 ~~ proem5
                  ## Residual variances
                  inem710 ~~ inem710 
                  sisoem710 ~~ sisoem710 
                  proem710 ~~ proem710
                  inem12 ~~ inem12 
                  sisoem12 ~~ sisoem12
                  proem12 ~~ proem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_inat.long.pro.m}
med_inat.long.pro.m.fit <- lavaan(model = med_inat.long.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long.pro.m.fit.summary <- summary(med_inat.long.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 2a. Constrained autoregressive paths CLPM mediation model 

```{r med_inat.long2a.pro.m}
med_inat.long2a.pro.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ c*sisoem5
                  sisoem12 ~ c*sisoem710
                  ## Pro social bahviour
                  proem710 ~ d*proem5
                  proem12 ~ d*proem710
                  ## ADHD
                  inem710 ~ e*inem5
                  inem12 ~ e*inem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  inem710 ~ sisoem5
                  inem12 ~ sisoem710
                  ## ADHD
                  sisoem710 ~ inem5
                  sisoem12 ~ inem710
                  ## Prosocial
                  sisoem710 ~ proem5
                  inem710 ~ proem5
                  proem12 ~ sisoem710
                  proem12 ~ inem710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proem710 ~ a*inem5 
                  sisoem12 ~ b*proem710
                  ## Isolation to ADHD
                  proem710 ~ sisoem5
                  inem12 ~ proem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ proem5
                  proem5 ~~ inem5
                  sisoem5 ~~ inem5
                  sisoem710 ~~ proem710
                  proem710 ~~ inem710
                  sisoem710 ~~ inem710
                  sisoem12 ~~ proem12
                  proem12 ~~ inem12
                  sisoem12 ~~ inem12
                    
                  ###### Variances ######
                  ## Variances
                  inem5 ~~ inem5 
                  sisoem5 ~~ sisoem5 
                  proem5 ~~ proem5
                  ## Residual variances
                  inem710 ~~ inem710 
                  sisoem710 ~~ sisoem710 
                  proem710 ~~ proem710
                  inem12 ~~ inem12 
                  sisoem12 ~~ sisoem12
                  proem12 ~~ proem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_inat.long2a.pro.m}
med_inat.long2a.pro.m.fit <- lavaan(model = med_inat.long2a.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long2a.pro.m.fit.summary <- summary(med_inat.long2a.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_inat.long.pro.m.fit and med_inat.long2a.pro.m.fit}
lavTestLRT(med_inat.long.pro.m.fit, med_inat.long2a.pro.m.fit, method = "satorra.bentler.2010")
```

Constrained autoregressive paths lead to significantly worse model fit. 

###### 2b. Constrained crosslag paths CLPM mediation model 

```{r med_inat.long2b.pro.m}
med_inat.long2b.pro.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ sisoem5
                  sisoem12 ~ sisoem710
                  ## Pro social bahviour
                  proem710 ~ proem5
                  proem12 ~ proem710
                  ## ADHD
                  inem710 ~ inem5
                  inem12 ~ inem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  inem710 ~ e*sisoem5
                  inem12 ~ e*sisoem710
                  proem12 ~ c*sisoem710
                  ## ADHD
                  sisoem710 ~ f*inem5
                  sisoem12 ~ f*inem710
                  proem12 ~ a*inem710
                  ## Prosocial
                  sisoem710 ~ b*proem5
                  inem710 ~ d*proem5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proem710 ~ a*inem5 
                  sisoem12 ~ b*proem710
                  ## Isolation to ADHD
                  proem710 ~ c*sisoem5
                  inem12 ~ d*proem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ proem5
                  proem5 ~~ inem5
                  sisoem5 ~~ inem5
                  sisoem710 ~~ proem710
                  proem710 ~~ inem710
                  sisoem710 ~~ inem710
                  sisoem12 ~~ proem12
                  proem12 ~~ inem12
                  sisoem12 ~~ inem12
                    
                  ###### Variances ######
                  ## Variances
                  inem5 ~~ inem5 
                  sisoem5 ~~ sisoem5 
                  proem5 ~~ proem5
                  ## Residual variances
                  inem710 ~~ inem710 
                  sisoem710 ~~ sisoem710 
                  proem710 ~~ proem710
                  inem12 ~~ inem12 
                  sisoem12 ~~ sisoem12
                  proem12 ~~ proem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_inat.long.pro.m}
med_inat.long2b.pro.m.fit <- lavaan(model = med_inat.long2b.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long2b.pro.m.fit.summary <- summary(med_inat.long2b.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_inat.long.pro.m.fit and med_inat.long2b.pro.m.fit}
lavTestLRT(med_inat.long.pro.m.fit, med_inat.long2b.pro.m.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.1303). Therefore this model 2b will be carried forward.

```{r results table for mother report prosocial and total adhd}
# Model fit 
med_inat.long2b.pro.m.fit.summary.fit <- table.model.fit(med_inat.long2b.pro.m.fit.summary)
# Coefficients
med_inat.long2b.pro.m.fit.summary.reg <- table.model.coef(model = med_inat.long2b.pro.m.fit.summary, step = "S2")
```

Results show that 
* All significant autoregressive lags
* Isolation *does not* predicts later ADHD (e)
* Isolation predicts later lower prosocial behaviours (c)
* ADHD predicts later isolation (f)
* Prosocial behaviours predict later lower ADHD (d)
* ADHD predicts later lower prosocial behaviours (a)
* Prosocial behaviours predict later lower isolation (b)
* Significant indirect mediation path (a*b, p=0.0007). ADHD -> lower prosocial behaviours -> isolation

###### 3. The RI-CLPM mediation model 

```{r ri.med_inat.long.pro.m}
ri.med_inat.long.pro.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*inem5 + 1*inem710 + 1*inem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIpro =~ 1*proem5 + 1*proem710 + 1*proem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*inem5
                  wad710 =~ 1*inem710
                  wad12 =~ 1*inem12
                  ## Prosocial 
                  wpro5 =~ 1*proem5
                  wpro710 =~ 1*proem710
                  wpro12 =~ 1*proem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## Pro social bahviour
                  wpro710 ~ wpro5
                  wpro12 ~ wpro710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  ## Prosocial
                  wsi710 ~ wpro5
                  wad710 ~ wpro5
                  wpro12 ~ wsi710
                  wpro12 ~ wad710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ wsi5
                  wad12 ~ wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_inat.long.pro.m}
ri.med_inat.long.pro.m.fit <- lavaan(model = ri.med_inat.long.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long.pro.m.fit.summary <- summary(ri.med_inat.long.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 4a. Constrained autoregressive RI-CLPM mediation model 

```{r ri.med_inat.long4a.pro.m}
ri.med_inat.long4a.pro.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*inem5 + 1*inem710 + 1*inem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIpro =~ 1*proem5 + 1*proem710 + 1*proem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*inem5
                  wad710 =~ 1*inem710
                  wad12 =~ 1*inem12
                  ## Prosocial 
                  wpro5 =~ 1*proem5
                  wpro710 =~ 1*proem710
                  wpro12 =~ 1*proem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ c*wsi5
                  wsi12 ~ c*wsi710
                  ## Pro social bahviour
                  wpro710 ~ d*wpro5
                  wpro12 ~ d*wpro710
                  ## ADHD
                  wad710 ~ e*wad5
                  wad12 ~ e*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  wpro12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  wpro12 ~ wad710
                  ## Prosocial
                  wsi710 ~ wpro5
                  wad710 ~ wpro5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ wsi5
                  wad12 ~ wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_inat.long4a.pro.m}
ri.med_inat.long4a.pro.m.fit <- lavaan(model = ri.med_inat.long4a.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long4a.pro.m.fit.summary <- summary(ri.med_inat.long4a.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

**Saying non-significant loss of fit but the fit statistics have reduced a lot.**

```{r LRT for ri.med_inat.long.pro.m.fit and ri.med_inat.long4a.pro.m.fit}
lavTestLRT(ri.med_inat.long.pro.m.fit, ri.med_inat.long4a.pro.m.fit, method = "satorra.bentler.2010")
```

###### 4b. Constrained cross-lag RI-CLPM mediation model 

```{r ri.med_inat.long4b.pro.m}
ri.med_inat.long4b.pro.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*inem5 + 1*inem710 + 1*inem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIpro =~ 1*proem5 + 1*proem710 + 1*proem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*inem5
                  wad710 =~ 1*inem710
                  wad12 =~ 1*inem12
                  ## Prosocial 
                  wpro5 =~ 1*proem5
                  wpro710 =~ 1*proem710
                  wpro12 =~ 1*proem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## Pro social bahviour
                  wpro710 ~ wpro5
                  wpro12 ~ wpro710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ e*wsi5
                  wad12 ~ e*wsi710
                  wpro12 ~ c*wsi710
                  ## ADHD
                  wsi710 ~ f*wad5
                  wsi12 ~ f*wad710
                  wpro12 ~ a*wad710
                  ## Prosocial
                  wsi710 ~ b*wpro5
                  wad710 ~ d*wpro5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ c*wsi5
                  wad12 ~ d*wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_inat.long4b.pro.m}
ri.med_inat.long4b.pro.m.fit <- lavaan(model = ri.med_inat.long4b.pro.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long4b.pro.m.fit.summary <- summary(ri.med_inat.long4b.pro.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_inat.long.pro.m.fit and ri.med_inat.long4a.pro.m.fit}
lavTestLRT(ri.med_inat.long.pro.m.fit, ri.med_inat.long4b.pro.m.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.4466). Therefore this model 4b will be carried forward.

```{r results table for random intercept mother report prosocial and total adhd}
# Model fit 
ri.med_inat.long4b.pro.m.fit.summary.fit <- table.model.fit(ri.med_inat.long4b.pro.m.fit.summary)
# Coefficients
ri.med_inat.long4b.pro.m.fit.summary.reg <- table.model.coef(model = ri.med_inat.long4b.pro.m.fit.summary, step = "S4")
```

Results show that 
* All significant autoregressive lags 
* Isolation does *not* predict later ADHD (e)
* Isolation does *not* predict later lower prosocial behaviours (c)
* ADHD **does (ish)** predict later isolation (p=0.047) (f)
* Prosocial behaviours *do not* predict later lower ADHD (d)
* ADHD **does** predict later lower prosocial behaviours (a)
* Prosocial behaviours *do not* predict later lower isolation (b)
* **Nonsignificant** indirect mediation path (a*b, p=0.165). ADHD -> lower prosocial behaviours -> isolation

***


#### Antisocial behaviour 

##### Total ADHD symptoms 

###### 1. The CLPM mediation model 

```{r med.long.asb.m}
med.long.asb.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ sisoem5
                  sisoem12 ~ sisoem710
                  ## asb social bahviour
                  asbem710 ~ asbem5
                  asbem12 ~ asbem710
                  ## ADHD
                  tadhdem710 ~ tadhdem5
                  tadhdem12 ~ tadhdem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  tadhdem710 ~ sisoem5
                  tadhdem12 ~ sisoem710
                  ## ADHD
                  sisoem710 ~ tadhdem5
                  sisoem12 ~ tadhdem710
                  ## antisocial
                  sisoem710 ~ asbem5
                  tadhdem710 ~ asbem5
                  asbem12 ~ sisoem710
                  asbem12 ~ tadhdem710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbem710 ~ a*tadhdem5 
                  sisoem12 ~ b*asbem710
                  ## Isolation to ADHD
                  asbem710 ~ sisoem5
                  tadhdem12 ~ asbem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ asbem5
                  asbem5 ~~ tadhdem5
                  sisoem5 ~~ tadhdem5
                  sisoem710 ~~ asbem710
                  asbem710 ~~ tadhdem710
                  sisoem710 ~~ tadhdem710
                  sisoem12 ~~ asbem12
                  asbem12 ~~ tadhdem12
                  sisoem12 ~~ tadhdem12
                    
                  ###### Variances ######
                  ## Variances
                  tadhdem5 ~~ tadhdem5 
                  sisoem5 ~~ sisoem5 
                  asbem5 ~~ asbem5
                  ## Residual variances
                  tadhdem710 ~~ tadhdem710 
                  sisoem710 ~~ sisoem710 
                  asbem710 ~~ asbem710
                  tadhdem12 ~~ tadhdem12 
                  sisoem12 ~~ sisoem12
                  asbem12 ~~ asbem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med.long.asb.m}
med.long.asb.m.fit <- lavaan(model = med.long.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long.asb.m.fit.summary <- summary(med.long.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 2a. Constrained autoregressive paths CLPM mediation model 

```{r med.long2a.asb.m}
med.long2a.asb.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ c*sisoem5
                  sisoem12 ~ c*sisoem710
                  ## asb social bahviour
                  asbem710 ~ d*asbem5
                  asbem12 ~ d*asbem710
                  ## ADHD
                  tadhdem710 ~ e*tadhdem5
                  tadhdem12 ~ e*tadhdem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  tadhdem710 ~ sisoem5
                  tadhdem12 ~ sisoem710
                  ## ADHD
                  sisoem710 ~ tadhdem5
                  sisoem12 ~ tadhdem710
                  ## antisocial
                  sisoem710 ~ asbem5
                  tadhdem710 ~ asbem5
                  asbem12 ~ sisoem710
                  asbem12 ~ tadhdem710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbem710 ~ a*tadhdem5 
                  sisoem12 ~ b*asbem710
                  ## Isolation to ADHD
                  asbem710 ~ sisoem5
                  tadhdem12 ~ asbem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ asbem5
                  asbem5 ~~ tadhdem5
                  sisoem5 ~~ tadhdem5
                  sisoem710 ~~ asbem710
                  asbem710 ~~ tadhdem710
                  sisoem710 ~~ tadhdem710
                  sisoem12 ~~ asbem12
                  asbem12 ~~ tadhdem12
                  sisoem12 ~~ tadhdem12
                    
                  ###### Variances ######
                  ## Variances
                  tadhdem5 ~~ tadhdem5 
                  sisoem5 ~~ sisoem5 
                  asbem5 ~~ asbem5
                  ## Residual variances
                  tadhdem710 ~~ tadhdem710 
                  sisoem710 ~~ sisoem710 
                  asbem710 ~~ asbem710
                  tadhdem12 ~~ tadhdem12 
                  sisoem12 ~~ sisoem12
                  asbem12 ~~ asbem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med.long2a.asb.m}
med.long2a.asb.m.fit <- lavaan(model = med.long2a.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long2a.asb.m.fit.summary <- summary(med.long2a.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med.long.asb.m.fit and med.long2a.asb.m.fit}
lavTestLRT(med.long.asb.m.fit, med.long2a.asb.m.fit, method = "satorra.bentler.2010")
```

Constrained autoregressive paths lead to significantly worse model fit. 

###### 2b. Constrained crosslag paths CLPM mediation model 

```{r med.long2b.asb.m}
med.long2b.asb.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ sisoem5
                  sisoem12 ~ sisoem710
                  ## asb social bahviour
                  asbem710 ~ asbem5
                  asbem12 ~ asbem710
                  ## ADHD
                  tadhdem710 ~ tadhdem5
                  tadhdem12 ~ tadhdem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  tadhdem710 ~ e*sisoem5
                  tadhdem12 ~ e*sisoem710
                  asbem12 ~ c*sisoem710
                  ## ADHD
                  sisoem710 ~ f*tadhdem5
                  sisoem12 ~ f*tadhdem710
                  asbem12 ~ a*tadhdem710
                  ## antisocial
                  sisoem710 ~ b*asbem5
                  tadhdem710 ~ d*asbem5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbem710 ~ a*tadhdem5 
                  sisoem12 ~ b*asbem710
                  ## Isolation to ADHD
                  asbem710 ~ c*sisoem5
                  tadhdem12 ~ d*asbem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ asbem5
                  asbem5 ~~ tadhdem5
                  sisoem5 ~~ tadhdem5
                  sisoem710 ~~ asbem710
                  asbem710 ~~ tadhdem710
                  sisoem710 ~~ tadhdem710
                  sisoem12 ~~ asbem12
                  asbem12 ~~ tadhdem12
                  sisoem12 ~~ tadhdem12
                    
                  ###### Variances ######
                  ## Variances
                  tadhdem5 ~~ tadhdem5 
                  sisoem5 ~~ sisoem5 
                  asbem5 ~~ asbem5
                  ## Residual variances
                  tadhdem710 ~~ tadhdem710 
                  sisoem710 ~~ sisoem710 
                  asbem710 ~~ asbem710
                  tadhdem12 ~~ tadhdem12 
                  sisoem12 ~~ sisoem12
                  asbem12 ~~ asbem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med.long.asb.m}
med.long2b.asb.m.fit <- lavaan(model = med.long2b.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long2b.asb.m.fit.summary <- summary(med.long2b.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med.long.asb.m.fit and med.long2b.asb.m.fit}
lavTestLRT(med.long.asb.m.fit, med.long2b.asb.m.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.1086). Therefore this model 2b will be carried forward.

```{r results table for mother report antisocial and total adhd}
# Model fit 
med.long2b.asb.m.fit.summary.fit <- table.model.fit(med.long2b.asb.m.fit.summary)
# Coefficients
med.long2b.asb.m.fit.summary.reg <- table.model.coef(model = med.long2b.asb.m.fit.summary, step = "S2")
```

Results show that 
* All significant autoregressive lags 
* Isolation does *not* predict later ADHD (e)
* Isolation does *not* predict later lower antisocial behaviours (c)
* ADHD predicts later isolation (f)
* antisocial behaviours predict later lower ADHD (d)
* ADHD predicts later lower antisocial behaviours (a)
* antisocial behaviours predict later lower isolation (b)
* Significant indirect mediation path (a*b, p=0.003). ADHD -> lower antisocial behaviours -> isolation

###### 3. The RI-CLPM mediation model 

```{r ri.med.long.asb.m}
ri.med.long.asb.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhdem5 + 1*tadhdem710 + 1*tadhdem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIasb =~ 1*asbem5 + 1*asbem710 + 1*asbem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*tadhdem5
                  wad710 =~ 1*tadhdem710
                  wad12 =~ 1*tadhdem12
                  ## antisocial 
                  wasb5 =~ 1*asbem5
                  wasb710 =~ 1*asbem710
                  wasb12 =~ 1*asbem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## asb social bahviour
                  wasb710 ~ wasb5
                  wasb12 ~ wasb710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  ## antisocial
                  wsi710 ~ wasb5
                  wad710 ~ wasb5
                  wasb12 ~ wsi710
                  wasb12 ~ wad710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ wsi5
                  wad12 ~ wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med.long.asb.m}
ri.med.long.asb.m.fit <- lavaan(model = ri.med.long.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long.asb.m.fit.summary <- summary(ri.med.long.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

**This parameter freed model produced negative variances and none of the paramter standard errors could be estimated?????**


###### 4a. Constrained autoregressive RI-CLPM mediation model 

```{r ri.med.long4a.asb.m}
ri.med.long4a.asb.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhdem5 + 1*tadhdem710 + 1*tadhdem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIasb =~ 1*asbem5 + 1*asbem710 + 1*asbem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*tadhdem5
                  wad710 =~ 1*tadhdem710
                  wad12 =~ 1*tadhdem12
                  ## antisocial 
                  wasb5 =~ 1*asbem5
                  wasb710 =~ 1*asbem710
                  wasb12 =~ 1*asbem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ c*wsi5
                  wsi12 ~ c*wsi710
                  ## asb social bahviour
                  wasb710 ~ d*wasb5
                  wasb12 ~ d*wasb710
                  ## ADHD
                  wad710 ~ e*wad5
                  wad12 ~ e*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  wasb12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  wasb12 ~ wad710
                  ## antisocial
                  wsi710 ~ wasb5
                  wad710 ~ wasb5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ wsi5
                  wad12 ~ wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med.long4a.asb.m}
ri.med.long4a.asb.m.fit <- lavaan(model = ri.med.long4a.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long4a.asb.m.fit.summary <- summary(ri.med.long4a.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med.long.asb.m.fit and ri.med.long4a.asb.m.fit}
#lavTestLRT(ri.med.long.asb.m.fit, ri.med.long4a.asb.m.fit, method = "satorra.bentler.2010")
```

**Can't compare as the freed parameter model did not converge properly**

###### 4b. Constrained cross-lag RI-CLPM mediation model 

```{r ri.med.long4b.asb.m}
ri.med.long4b.asb.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhdem5 + 1*tadhdem710 + 1*tadhdem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIasb =~ 1*asbem5 + 1*asbem710 + 1*asbem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*tadhdem5
                  wad710 =~ 1*tadhdem710
                  wad12 =~ 1*tadhdem12
                  ## antisocial 
                  wasb5 =~ 1*asbem5
                  wasb710 =~ 1*asbem710
                  wasb12 =~ 1*asbem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## asb social bahviour
                  wasb710 ~ wasb5
                  wasb12 ~ wasb710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ e*wsi5
                  wad12 ~ e*wsi710
                  wasb12 ~ c*wsi710
                  ## ADHD
                  wsi710 ~ f*wad5
                  wsi12 ~ f*wad710
                  wasb12 ~ a*wad710
                  ## antisocial
                  wsi710 ~ b*wasb5
                  wad710 ~ d*wasb5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ c*wsi5
                  wad12 ~ d*wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med.long4b.asb.m}
ri.med.long4b.asb.m.fit <- lavaan(model = ri.med.long4b.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long4b.asb.m.fit.summary <- summary(ri.med.long4b.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med.long.asb.m.fit and ri.med.long4a.asb.m.fit}
#lavTestLRT(ri.med.long.asb.m.fit, ri.med.long4b.asb.m.fit, method = "satorra.bentler.2010")
```

We cannot compare to the freed model as this did not converge. As all other mother report have fvaoured the 4b model, we will continue with the 4b model. 

```{r results table for random intercept mother report antisocial and total adhd}
# Model fit 
ri.med.long4b.asb.m.fit.summary.fit <- table.model.fit(ri.med.long4b.asb.m.fit.summary)
# Coefficients
ri.med.long4b.asb.m.fit.summary.reg <- table.model.coef(model = ri.med.long4b.asb.m.fit.summary, step = "S4")
```

Results show that 
* All significant autoregressive lags 
* Isolation does *not* predict later ADHD (e)
* Isolation does *not* predict later lower antisocial behaviours (c)
* ADHD does *not* predict later isolation (f)
* Antisocial behaviours *do not* predict later lower ADHD (d)
* ADHD predicts later lower antisocial behaviours (a)
* Antisocial behaviours predict later lower isolation (b)
* **Nonsignificant** indirect mediation path (a*b, p=0.074). ADHD -> lower antisocial behaviours -> isolation


##### Hyperactivity symptoms 

###### 1. The CLPM mediation model 

```{r med_hyp.long.asb.m}
med_hyp.long.asb.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ sisoem5
                  sisoem12 ~ sisoem710
                  ## asb social bahviour
                  asbem710 ~ asbem5
                  asbem12 ~ asbem710
                  ## ADHD
                  hyem710 ~ hyem5
                  hyem12 ~ hyem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  hyem710 ~ sisoem5
                  hyem12 ~ sisoem710
                  ## ADHD
                  sisoem710 ~ hyem5
                  sisoem12 ~ hyem710
                  ## antisocial
                  sisoem710 ~ asbem5
                  hyem710 ~ asbem5
                  asbem12 ~ sisoem710
                  asbem12 ~ hyem710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbem710 ~ a*hyem5 
                  sisoem12 ~ b*asbem710
                  ## Isolation to ADHD
                  asbem710 ~ sisoem5
                  hyem12 ~ asbem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ asbem5
                  asbem5 ~~ hyem5
                  sisoem5 ~~ hyem5
                  sisoem710 ~~ asbem710
                  asbem710 ~~ hyem710
                  sisoem710 ~~ hyem710
                  sisoem12 ~~ asbem12
                  asbem12 ~~ hyem12
                  sisoem12 ~~ hyem12
                    
                  ###### Variances ######
                  ## Variances
                  hyem5 ~~ hyem5 
                  sisoem5 ~~ sisoem5 
                  asbem5 ~~ asbem5
                  ## Residual variances
                  hyem710 ~~ hyem710 
                  sisoem710 ~~ sisoem710 
                  asbem710 ~~ asbem710
                  hyem12 ~~ hyem12 
                  sisoem12 ~~ sisoem12
                  asbem12 ~~ asbem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_hyp.long.asb.m}
med_hyp.long.asb.m.fit <- lavaan(model = med_hyp.long.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long.asb.m.fit.summary <- summary(med_hyp.long.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 2a. Constrained autoregressive paths CLPM mediation model 

```{r med_hyp.long2a.asb.m}
med_hyp.long2a.asb.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ c*sisoem5
                  sisoem12 ~ c*sisoem710
                  ## asb social bahviour
                  asbem710 ~ d*asbem5
                  asbem12 ~ d*asbem710
                  ## ADHD
                  hyem710 ~ e*hyem5
                  hyem12 ~ e*hyem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  hyem710 ~ sisoem5
                  hyem12 ~ sisoem710
                  ## ADHD
                  sisoem710 ~ hyem5
                  sisoem12 ~ hyem710
                  ## antisocial
                  sisoem710 ~ asbem5
                  hyem710 ~ asbem5
                  asbem12 ~ sisoem710
                  asbem12 ~ hyem710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbem710 ~ a*hyem5 
                  sisoem12 ~ b*asbem710
                  ## Isolation to ADHD
                  asbem710 ~ sisoem5
                  hyem12 ~ asbem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ asbem5
                  asbem5 ~~ hyem5
                  sisoem5 ~~ hyem5
                  sisoem710 ~~ asbem710
                  asbem710 ~~ hyem710
                  sisoem710 ~~ hyem710
                  sisoem12 ~~ asbem12
                  asbem12 ~~ hyem12
                  sisoem12 ~~ hyem12
                    
                  ###### Variances ######
                  ## Variances
                  hyem5 ~~ hyem5 
                  sisoem5 ~~ sisoem5 
                  asbem5 ~~ asbem5
                  ## Residual variances
                  hyem710 ~~ hyem710 
                  sisoem710 ~~ sisoem710 
                  asbem710 ~~ asbem710
                  hyem12 ~~ hyem12 
                  sisoem12 ~~ sisoem12
                  asbem12 ~~ asbem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_hyp.long2a.asb.m}
med_hyp.long2a.asb.m.fit <- lavaan(model = med_hyp.long2a.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long2a.asb.m.fit.summary <- summary(med_hyp.long2a.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_hyp.long.asb.m.fit and med_hyp.long2a.asb.m.fit}
lavTestLRT(med_hyp.long.asb.m.fit, med_hyp.long2a.asb.m.fit, method = "satorra.bentler.2010")
```

Constrained autoregressive paths lead to significantly worse model fit. 

###### 2b. Constrained crosslag paths CLPM mediation model 

```{r med_hyp.long2b.asb.m}
med_hyp.long2b.asb.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ sisoem5
                  sisoem12 ~ sisoem710
                  ## asb social bahviour
                  asbem710 ~ asbem5
                  asbem12 ~ asbem710
                  ## ADHD
                  hyem710 ~ hyem5
                  hyem12 ~ hyem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  hyem710 ~ e*sisoem5
                  hyem12 ~ e*sisoem710
                  asbem12 ~ c*sisoem710
                  ## ADHD
                  sisoem710 ~ f*hyem5
                  sisoem12 ~ f*hyem710
                  asbem12 ~ a*hyem710
                  ## antisocial
                  sisoem710 ~ b*asbem5
                  hyem710 ~ d*asbem5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbem710 ~ a*hyem5 
                  sisoem12 ~ b*asbem710
                  ## Isolation to ADHD
                  asbem710 ~ c*sisoem5
                  hyem12 ~ d*asbem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ asbem5
                  asbem5 ~~ hyem5
                  sisoem5 ~~ hyem5
                  sisoem710 ~~ asbem710
                  asbem710 ~~ hyem710
                  sisoem710 ~~ hyem710
                  sisoem12 ~~ asbem12
                  asbem12 ~~ hyem12
                  sisoem12 ~~ hyem12
                    
                  ###### Variances ######
                  ## Variances
                  hyem5 ~~ hyem5 
                  sisoem5 ~~ sisoem5 
                  asbem5 ~~ asbem5
                  ## Residual variances
                  hyem710 ~~ hyem710 
                  sisoem710 ~~ sisoem710 
                  asbem710 ~~ asbem710
                  hyem12 ~~ hyem12 
                  sisoem12 ~~ sisoem12
                  asbem12 ~~ asbem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_hyp.long.asb.m}
med_hyp.long2b.asb.m.fit <- lavaan(model = med_hyp.long2b.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long2b.asb.m.fit.summary <- summary(med_hyp.long2b.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_hyp.long.asb.m.fit and med_hyp.long2b.asb.m.fit}
lavTestLRT(med_hyp.long.asb.m.fit, med_hyp.long2b.asb.m.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.1609). Therefore this model 2b will be carried forward.

```{r results table for mother report antisocial and total adhd}
# Model fit 
med_hyp.long2b.asb.m.fit.summary.fit <- table.model.fit(med_hyp.long2b.asb.m.fit.summary)
# Coefficients
med_hyp.long2b.asb.m.fit.summary.reg <- table.model.coef(model = med_hyp.long2b.asb.m.fit.summary, step = "S2")
```

Results show that 
* All significant autoregressive lags
* Isolation *does not* predict later ADHD (e)
* Isolation *does not* predict later lower antisocial behaviours (c)
* ADHD *does not* predict later isolation (f)
* antisocial behaviours predict later lower ADHD (d)
* ADHD predicts later lower antisocial behaviours (a)
* antisocial behaviours predict later lower isolation (b)
* Significant indirect mediation path (a*b, p=0.007). ADHD -> lower antisocial behaviours -> isolation

###### 3. The RI-CLPM mediation model 

```{r ri.med_hyp.long.asb.m}
ri.med_hyp.long.asb.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hyem5 + 1*hyem710 + 1*hyem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIasb =~ 1*asbem5 + 1*asbem710 + 1*asbem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*hyem5
                  wad710 =~ 1*hyem710
                  wad12 =~ 1*hyem12
                  ## antisocial 
                  wasb5 =~ 1*asbem5
                  wasb710 =~ 1*asbem710
                  wasb12 =~ 1*asbem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## asb social bahviour
                  wasb710 ~ wasb5
                  wasb12 ~ wasb710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  ## antisocial
                  wsi710 ~ wasb5
                  wad710 ~ wasb5
                  wasb12 ~ wsi710
                  wasb12 ~ wad710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ wsi5
                  wad12 ~ wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_hyp.long.asb.m}
ri.med_hyp.long.asb.m.fit <- lavaan(model = ri.med_hyp.long.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long.asb.m.fit.summary <- summary(ri.med_hyp.long.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 4a. Constrained autoregressive RI-CLPM mediation model 

```{r ri.med_hyp.long4a.asb.m}
ri.med_hyp.long4a.asb.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hyem5 + 1*hyem710 + 1*hyem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIasb =~ 1*asbem5 + 1*asbem710 + 1*asbem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*hyem5
                  wad710 =~ 1*hyem710
                  wad12 =~ 1*hyem12
                  ## antisocial 
                  wasb5 =~ 1*asbem5
                  wasb710 =~ 1*asbem710
                  wasb12 =~ 1*asbem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ c*wsi5
                  wsi12 ~ c*wsi710
                  ## asb social bahviour
                  wasb710 ~ d*wasb5
                  wasb12 ~ d*wasb710
                  ## ADHD
                  wad710 ~ e*wad5
                  wad12 ~ e*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  wasb12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  wasb12 ~ wad710
                  ## antisocial
                  wsi710 ~ wasb5
                  wad710 ~ wasb5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ wsi5
                  wad12 ~ wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_hyp.long4a.asb.m}
ri.med_hyp.long4a.asb.m.fit <- lavaan(model = ri.med_hyp.long4a.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long4a.asb.m.fit.summary <- summary(ri.med_hyp.long4a.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_hyp.long.asb.m.fit and ri.med_hyp.long4a.asb.m.fit}
lavTestLRT(ri.med_hyp.long.asb.m.fit, ri.med_hyp.long4a.asb.m.fit, method = "satorra.bentler.2010")
```

This model did not show significantly worse fit. 

###### 4b. Constrained cross-lag RI-CLPM mediation model 

```{r ri.med_hyp.long4b.asb.m}
ri.med_hyp.long4b.asb.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hyem5 + 1*hyem710 + 1*hyem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIasb =~ 1*asbem5 + 1*asbem710 + 1*asbem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*hyem5
                  wad710 =~ 1*hyem710
                  wad12 =~ 1*hyem12
                  ## antisocial 
                  wasb5 =~ 1*asbem5
                  wasb710 =~ 1*asbem710
                  wasb12 =~ 1*asbem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## asb social bahviour
                  wasb710 ~ wasb5
                  wasb12 ~ wasb710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ e*wsi5
                  wad12 ~ e*wsi710
                  wasb12 ~ c*wsi710
                  ## ADHD
                  wsi710 ~ f*wad5
                  wsi12 ~ f*wad710
                  wasb12 ~ a*wad710
                  ## antisocial
                  wsi710 ~ b*wasb5
                  wad710 ~ d*wasb5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ c*wsi5
                  wad12 ~ d*wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_hyp.long4b.asb.m}
ri.med_hyp.long4b.asb.m.fit <- lavaan(model = ri.med_hyp.long4b.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long4b.asb.m.fit.summary <- summary(ri.med_hyp.long4b.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_hyp.long.asb.m.fit and ri.med_hyp.long4a.asb.m.fit}
lavTestLRT(ri.med_hyp.long.asb.m.fit, ri.med_hyp.long4b.asb.m.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.9763). Therefore this model 4b will be carried forward.

```{r results table for random intercept mother report antisocial and total adhd}
# Model fit 
ri.med_hyp.long4b.asb.m.fit.summary.fit <- table.model.fit(ri.med_hyp.long4b.asb.m.fit.summary)
# Coefficients
ri.med_hyp.long4b.asb.m.fit.summary.reg <- table.model.coef(model = ri.med_hyp.long4b.asb.m.fit.summary, step = "S4")
```

Results show that 
* All significant autoregressive lags 
* Isolation does *not* predict later ADHD (e)
* Isolation does *not* predict later lower antisocial behaviours (c)
* ADHD does *not* predict later isolation (p=0.019) (f)
* antisocial behaviours do predict later lower ADHD (d)
* ADHD *does not* predict later lower antisocial behaviours (a)
* antisocial behaviours *does* predict later lower isolation (b)
* **Nonsignificant** indirect mediation path (a*b, p=0.212). ADHD -> lower antisocial behaviours -> isolation


##### Inattention symptoms 

###### 1. The CLPM mediation model 

```{r med_inat.long.asb.m}
med_inat.long.asb.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ sisoem5
                  sisoem12 ~ sisoem710
                  ## asb social bahviour
                  asbem710 ~ asbem5
                  asbem12 ~ asbem710
                  ## ADHD
                  inem710 ~ inem5
                  inem12 ~ inem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  inem710 ~ sisoem5
                  inem12 ~ sisoem710
                  ## ADHD
                  sisoem710 ~ inem5
                  sisoem12 ~ inem710
                  ## antisocial
                  sisoem710 ~ asbem5
                  inem710 ~ asbem5
                  asbem12 ~ sisoem710
                  asbem12 ~ inem710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbem710 ~ a*inem5 
                  sisoem12 ~ b*asbem710
                  ## Isolation to ADHD
                  asbem710 ~ sisoem5
                  inem12 ~ asbem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ asbem5
                  asbem5 ~~ inem5
                  sisoem5 ~~ inem5
                  sisoem710 ~~ asbem710
                  asbem710 ~~ inem710
                  sisoem710 ~~ inem710
                  sisoem12 ~~ asbem12
                  asbem12 ~~ inem12
                  sisoem12 ~~ inem12
                    
                  ###### Variances ######
                  ## Variances
                  inem5 ~~ inem5 
                  sisoem5 ~~ sisoem5 
                  asbem5 ~~ asbem5
                  ## Residual variances
                  inem710 ~~ inem710 
                  sisoem710 ~~ sisoem710 
                  asbem710 ~~ asbem710
                  inem12 ~~ inem12 
                  sisoem12 ~~ sisoem12
                  asbem12 ~~ asbem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_inat.long.asb.m}
med_inat.long.asb.m.fit <- lavaan(model = med_inat.long.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long.asb.m.fit.summary <- summary(med_inat.long.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 2a. Constrained autoregressive paths CLPM mediation model 

```{r med_inat.long2a.asb.m}
med_inat.long2a.asb.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ c*sisoem5
                  sisoem12 ~ c*sisoem710
                  ## asb social bahviour
                  asbem710 ~ d*asbem5
                  asbem12 ~ d*asbem710
                  ## ADHD
                  inem710 ~ e*inem5
                  inem12 ~ e*inem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  inem710 ~ sisoem5
                  inem12 ~ sisoem710
                  ## ADHD
                  sisoem710 ~ inem5
                  sisoem12 ~ inem710
                  ## antisocial
                  sisoem710 ~ asbem5
                  inem710 ~ asbem5
                  asbem12 ~ sisoem710
                  asbem12 ~ inem710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbem710 ~ a*inem5 
                  sisoem12 ~ b*asbem710
                  ## Isolation to ADHD
                  asbem710 ~ sisoem5
                  inem12 ~ asbem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ asbem5
                  asbem5 ~~ inem5
                  sisoem5 ~~ inem5
                  sisoem710 ~~ asbem710
                  asbem710 ~~ inem710
                  sisoem710 ~~ inem710
                  sisoem12 ~~ asbem12
                  asbem12 ~~ inem12
                  sisoem12 ~~ inem12
                    
                  ###### Variances ######
                  ## Variances
                  inem5 ~~ inem5 
                  sisoem5 ~~ sisoem5 
                  asbem5 ~~ asbem5
                  ## Residual variances
                  inem710 ~~ inem710 
                  sisoem710 ~~ sisoem710 
                  asbem710 ~~ asbem710
                  inem12 ~~ inem12 
                  sisoem12 ~~ sisoem12
                  asbem12 ~~ asbem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_inat.long2a.asb.m}
med_inat.long2a.asb.m.fit <- lavaan(model = med_inat.long2a.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long2a.asb.m.fit.summary <- summary(med_inat.long2a.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_inat.long.asb.m.fit and med_inat.long2a.asb.m.fit}
lavTestLRT(med_inat.long.asb.m.fit, med_inat.long2a.asb.m.fit, method = "satorra.bentler.2010")
```

Constrained autoregressive paths lead to significantly worse model fit. 

###### 2b. Constrained crosslag paths CLPM mediation model 

```{r med_inat.long2b.asb.m}
med_inat.long2b.asb.m <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoem710 ~ sisoem5
                  sisoem12 ~ sisoem710
                  ## asb social bahviour
                  asbem710 ~ asbem5
                  asbem12 ~ asbem710
                  ## ADHD
                  inem710 ~ inem5
                  inem12 ~ inem710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  inem710 ~ e*sisoem5
                  inem12 ~ e*sisoem710
                  asbem12 ~ c*sisoem710
                  ## ADHD
                  sisoem710 ~ f*inem5
                  sisoem12 ~ f*inem710
                  asbem12 ~ a*inem710
                  ## antisocial
                  sisoem710 ~ b*asbem5
                  inem710 ~ d*asbem5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbem710 ~ a*inem5 
                  sisoem12 ~ b*asbem710
                  ## Isolation to ADHD
                  asbem710 ~ c*sisoem5
                  inem12 ~ d*asbem710
                  
                  ###### Covariances ######
                  sisoem5 ~~ asbem5
                  asbem5 ~~ inem5
                  sisoem5 ~~ inem5
                  sisoem710 ~~ asbem710
                  asbem710 ~~ inem710
                  sisoem710 ~~ inem710
                  sisoem12 ~~ asbem12
                  asbem12 ~~ inem12
                  sisoem12 ~~ inem12
                    
                  ###### Variances ######
                  ## Variances
                  inem5 ~~ inem5 
                  sisoem5 ~~ sisoem5 
                  asbem5 ~~ asbem5
                  ## Residual variances
                  inem710 ~~ inem710 
                  sisoem710 ~~ sisoem710 
                  asbem710 ~~ asbem710
                  inem12 ~~ inem12 
                  sisoem12 ~~ sisoem12
                  asbem12 ~~ asbem12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_inat.long2b.asb.m}
med_inat.long2b.asb.m.fit <- lavaan(model = med_inat.long2b.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long2b.asb.m.fit.summary <- summary(med_inat.long2b.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_inat.long.asb.m.fit and med_inat.long2b.asb.m.fit}
lavTestLRT(med_inat.long.asb.m.fit, med_inat.long2b.asb.m.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a significant loss in model fit (p=0.02991). Therefore the freed model should be used going forward.

```{r results table for mother report antisocial and total adhd}
# Model fit 
med_inat.long.asb.m.fit.summary.fit <- table.model.fit(med_inat.long.asb.m.fit.summary)
# Coefficients
med_inat.long.asb.m.fit.summary.reg <- table.model.coef(model = med_inat.long.asb.m.fit.summary, step = "S1")
```

Results show that (NOT BEEN UPDATED)
* All significant autoregressive lags
* Isolation *does not* predicts later ADHD (e)
* Isolation predicts later lower antisocial behaviours (c)
* ADHD predicts later isolation (f)
* antisocial behaviours predict later lower ADHD (d)
* ADHD predicts later lower antisocial behaviours (a)
* antisocial behaviours predict later lower isolation (b)
* Significant indirect mediation path (a*b, p=0.0007). ADHD -> lower antisocial behaviours -> isolation

###### 3. The RI-CLPM mediation model 

```{r ri.med_inat.long.asb.m}
ri.med_inat.long.asb.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*inem5 + 1*inem710 + 1*inem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIasb =~ 1*asbem5 + 1*asbem710 + 1*asbem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*inem5
                  wad710 =~ 1*inem710
                  wad12 =~ 1*inem12
                  ## antisocial 
                  wasb5 =~ 1*asbem5
                  wasb710 =~ 1*asbem710
                  wasb12 =~ 1*asbem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## asb social bahviour
                  wasb710 ~ wasb5
                  wasb12 ~ wasb710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  ## antisocial
                  wsi710 ~ wasb5
                  wad710 ~ wasb5
                  wasb12 ~ wsi710
                  wasb12 ~ wad710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ wsi5
                  wad12 ~ wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_inat.long.asb.m}
ri.med_inat.long.asb.m.fit <- lavaan(model = ri.med_inat.long.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long.asb.m.fit.summary <- summary(ri.med_inat.long.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 4a. Constrained autoregressive RI-CLPM mediation model 

```{r ri.med_inat.long4a.asb.m}
ri.med_inat.long4a.asb.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*inem5 + 1*inem710 + 1*inem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIasb =~ 1*asbem5 + 1*asbem710 + 1*asbem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*inem5
                  wad710 =~ 1*inem710
                  wad12 =~ 1*inem12
                  ## antisocial 
                  wasb5 =~ 1*asbem5
                  wasb710 =~ 1*asbem710
                  wasb12 =~ 1*asbem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ c*wsi5
                  wsi12 ~ c*wsi710
                  ## asb social bahviour
                  wasb710 ~ d*wasb5
                  wasb12 ~ d*wasb710
                  ## ADHD
                  wad710 ~ e*wad5
                  wad12 ~ e*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  wasb12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  wasb12 ~ wad710
                  ## antisocial
                  wsi710 ~ wasb5
                  wad710 ~ wasb5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ wsi5
                  wad12 ~ wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_inat.long4a.asb.m}
ri.med_inat.long4a.asb.m.fit <- lavaan(model = ri.med_inat.long4a.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long4a.asb.m.fit.summary <- summary(ri.med_inat.long4a.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

**Saying non-significant loss of fit but the fit statistics have reduced a lot.**

```{r LRT for ri.med_inat.long.asb.m.fit and ri.med_inat.long4a.asb.m.fit}
lavTestLRT(ri.med_inat.long.asb.m.fit, ri.med_inat.long4a.asb.m.fit, method = "satorra.bentler.2010")
```

###### 4b. Constrained cross-lag RI-CLPM mediation model 

```{r ri.med_inat.long4b.asb.m}
ri.med_inat.long4b.asb.m <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*inem5 + 1*inem710 + 1*inem12 
                  RIsi =~ 1*sisoem5 + 1*sisoem710 + 1*sisoem12 
                  RIasb =~ 1*asbem5 + 1*asbem710 + 1*asbem12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoem5
                  wsi710 =~ 1*sisoem710
                  wsi12 =~ 1*sisoem12
                  ## ADHD
                  wad5 =~ 1*inem5
                  wad710 =~ 1*inem710
                  wad12 =~ 1*inem12
                  ## antisocial 
                  wasb5 =~ 1*asbem5
                  wasb710 =~ 1*asbem710
                  wasb12 =~ 1*asbem12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## asb social bahviour
                  wasb710 ~ wasb5
                  wasb12 ~ wasb710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ e*wsi5
                  wad12 ~ e*wsi710
                  wasb12 ~ c*wsi710
                  ## ADHD
                  wsi710 ~ f*wad5
                  wsi12 ~ f*wad710
                  wasb12 ~ a*wad710
                  ## antisocial
                  wsi710 ~ b*wasb5
                  wad710 ~ d*wasb5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ c*wsi5
                  wad12 ~ d*wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_inat.long4b.asb.m}
ri.med_inat.long4b.asb.m.fit <- lavaan(model = ri.med_inat.long4b.asb.m, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long4b.asb.m.fit.summary <- summary(ri.med_inat.long4b.asb.m.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_inat.long.asb.m.fit and ri.med_inat.long4a.asb.m.fit}
lavTestLRT(ri.med_inat.long.asb.m.fit, ri.med_inat.long4b.asb.m.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=1). Therefore this model 4b will be carried forward.

```{r results table for random intercept mother report antisocial and total adhd}
# Model fit 
ri.med_inat.long4b.asb.m.fit.summary.fit <- table.model.fit(ri.med_inat.long4b.asb.m.fit.summary)
# Coefficients
ri.med_inat.long4b.asb.m.fit.summary.reg <- table.model.coef(model = ri.med_inat.long4b.asb.m.fit.summary, step = "S4")
```

Results show that 
* All significant autoregressive lags 
* Isolation does *not* predict later ADHD (e)
* Isolation does *not* predict later lower antisocial behaviours (c)
* ADHD does *not* predict later isolation (f)
* antisocial behaviours **does** predict later lower ADHD (d)
* ADHD **does** predict later lower antisocial behaviours (a)
* antisocial behaviours *do not* predict later lower isolation (b)
* **Nonsignificant** indirect mediation path (a*b, p=0.153). ADHD -> lower antisocial behaviours -> isolation

***

### Teacher report

#### Prosocial behaviour 

##### Total ADHD symptoms 

###### 1. The CLPM mediation model 

```{r med.long.pro.t}
med.long.pro.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ sisoet5
                  sisoet12 ~ sisoet710
                  ## Pro social bahviour
                  proet710 ~ proet5
                  proet12 ~ proet710
                  ## ADHD
                  tadhdet710 ~ tadhdet5
                  tadhdet12 ~ tadhdet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  tadhdet710 ~ sisoet5
                  tadhdet12 ~ sisoet710
                  ## ADHD
                  sisoet710 ~ tadhdet5
                  sisoet12 ~ tadhdet710
                  ## Prosocial
                  sisoet710 ~ proet5
                  tadhdet710 ~ proet5
                  proet12 ~ sisoet710
                  proet12 ~ tadhdet710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proet710 ~ a*tadhdet5 
                  sisoet12 ~ b*proet710
                  ## Isolation to ADHD
                  proet710 ~ sisoet5
                  tadhdet12 ~ proet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ proet5
                  proet5 ~~ tadhdet5
                  sisoet5 ~~ tadhdet5
                  sisoet710 ~~ proet710
                  proet710 ~~ tadhdet710
                  sisoet710 ~~ tadhdet710
                  sisoet12 ~~ proet12
                  proet12 ~~ tadhdet12
                  sisoet12 ~~ tadhdet12
                    
                  ###### Variances ######
                  ## Variances
                  tadhdet5 ~~ tadhdet5 
                  sisoet5 ~~ sisoet5 
                  proet5 ~~ proet5
                  ## Residual variances
                  tadhdet710 ~~ tadhdet710 
                  sisoet710 ~~ sisoet710 
                  proet710 ~~ proet710
                  tadhdet12 ~~ tadhdet12 
                  sisoet12 ~~ sisoet12
                  proet12 ~~ proet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med.long.pro.t}
med.long.pro.t.fit <- lavaan(model = med.long.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long.pro.t.fit.summary <- summary(med.long.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 2a. Constrained autoregressive paths CLPM mediation model 

```{r med.long2a.pro.t}
med.long2a.pro.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ c*sisoet5
                  sisoet12 ~ c*sisoet710
                  ## Pro social bahviour
                  proet710 ~ d*proet5
                  proet12 ~ d*proet710
                  ## ADHD
                  tadhdet710 ~ e*tadhdet5
                  tadhdet12 ~ e*tadhdet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  tadhdet710 ~ sisoet5
                  tadhdet12 ~ sisoet710
                  ## ADHD
                  sisoet710 ~ tadhdet5
                  sisoet12 ~ tadhdet710
                  ## Prosocial
                  sisoet710 ~ proet5
                  tadhdet710 ~ proet5
                  proet12 ~ sisoet710
                  proet12 ~ tadhdet710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proet710 ~ a*tadhdet5 
                  sisoet12 ~ b*proet710
                  ## Isolation to ADHD
                  proet710 ~ sisoet5
                  tadhdet12 ~ proet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ proet5
                  proet5 ~~ tadhdet5
                  sisoet5 ~~ tadhdet5
                  sisoet710 ~~ proet710
                  proet710 ~~ tadhdet710
                  sisoet710 ~~ tadhdet710
                  sisoet12 ~~ proet12
                  proet12 ~~ tadhdet12
                  sisoet12 ~~ tadhdet12
                    
                  ###### Variances ######
                  ## Variances
                  tadhdet5 ~~ tadhdet5 
                  sisoet5 ~~ sisoet5 
                  proet5 ~~ proet5
                  ## Residual variances
                  tadhdet710 ~~ tadhdet710 
                  sisoet710 ~~ sisoet710 
                  proet710 ~~ proet710
                  tadhdet12 ~~ tadhdet12 
                  sisoet12 ~~ sisoet12
                  proet12 ~~ proet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med.long2a.pro.t}
med.long2a.pro.t.fit <- lavaan(model = med.long2a.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long2a.pro.t.fit.summary <- summary(med.long2a.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med.long.pro.t.fit and med.long2a.pro.t.fit}
lavTestLRT(med.long.pro.t.fit, med.long2a.pro.t.fit, method = "satorra.bentler.2010")
```

Constrained autoregressive paths lead to significantly worse model fit. 

###### 2b. Constrained crosslag paths CLPM mediation model 

```{r med.long2b.pro.t}
med.long2b.pro.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ sisoet5
                  sisoet12 ~ sisoet710
                  ## Pro social bahviour
                  proet710 ~ proet5
                  proet12 ~ proet710
                  ## ADHD
                  tadhdet710 ~ tadhdet5
                  tadhdet12 ~ tadhdet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  tadhdet710 ~ e*sisoet5
                  tadhdet12 ~ e*sisoet710
                  proet12 ~ c*sisoet710
                  ## ADHD
                  sisoet710 ~ f*tadhdet5
                  sisoet12 ~ f*tadhdet710
                  proet12 ~ a*tadhdet710
                  ## Prosocial
                  sisoet710 ~ b*proet5
                  tadhdet710 ~ d*proet5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proet710 ~ a*tadhdet5 
                  sisoet12 ~ b*proet710
                  ## Isolation to ADHD
                  proet710 ~ c*sisoet5
                  tadhdet12 ~ d*proet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ proet5
                  proet5 ~~ tadhdet5
                  sisoet5 ~~ tadhdet5
                  sisoet710 ~~ proet710
                  proet710 ~~ tadhdet710
                  sisoet710 ~~ tadhdet710
                  sisoet12 ~~ proet12
                  proet12 ~~ tadhdet12
                  sisoet12 ~~ tadhdet12
                    
                  ###### Variances ######
                  ## Variances
                  tadhdet5 ~~ tadhdet5 
                  sisoet5 ~~ sisoet5 
                  proet5 ~~ proet5
                  ## Residual variances
                  tadhdet710 ~~ tadhdet710 
                  sisoet710 ~~ sisoet710 
                  proet710 ~~ proet710
                  tadhdet12 ~~ tadhdet12 
                  sisoet12 ~~ sisoet12
                  proet12 ~~ proet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med.long.pro.t}
med.long2b.pro.t.fit <- lavaan(model = med.long2b.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long2b.pro.t.fit.summary <- summary(med.long2b.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med.long.pro.t.fit and med.long2b.pro.t.fit}
lavTestLRT(med.long.pro.t.fit, med.long2b.pro.t.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.3128). Therefore this model 2b will be carried forward.

```{r results table for mother report prosocial and total adhd}
# Model fit 
med.long2b.pro.t.fit.summary.fit <- table.model.fit(med.long2b.pro.t.fit.summary)
# Coefficients
med.long2b.pro.t.fit.summary.reg <- table.model.coef(model = med.long2b.pro.t.fit.summary, step = "S2")
```

Results show that 
* All significant autoregressive lags 
* Isolation does *not* predict later ADHD (e)
* Isolation predicts later lower prosocial behaviours (c)
* ADHD predicts later isolation (f)
* Prosocial behaviours predict later lower ADHD (d)
* ADHD predicts later lower prosocial behaviours (a)
* Prosocial behaviours predict later lower isolation (b)
* Significant indirect mediation path (a*b, p=0.001). ADHD -> lower prosocial behaviours -> isolation

###### 3. The RI-CLPM mediation model 

```{r ri.med.long.pro.t}
ri.med.long.pro.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhdet5 + 1*tadhdet710 + 1*tadhdet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIpro =~ 1*proet5 + 1*proet710 + 1*proet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*tadhdet5
                  wad710 =~ 1*tadhdet710
                  wad12 =~ 1*tadhdet12
                  ## Prosocial 
                  wpro5 =~ 1*proet5
                  wpro710 =~ 1*proet710
                  wpro12 =~ 1*proet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## Pro social bahviour
                  wpro710 ~ wpro5
                  wpro12 ~ wpro710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  ## Prosocial
                  wsi710 ~ wpro5
                  wad710 ~ wpro5
                  wpro12 ~ wsi710
                  wpro12 ~ wad710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ wsi5
                  wad12 ~ wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med.long.pro.t}
ri.med.long.pro.t.fit <- lavaan(model = ri.med.long.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long.pro.t.fit.summary <- summary(ri.med.long.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 4a. Constrained autoregressive RI-CLPM mediation model 

```{r ri.med.long4a.pro.t}
ri.med.long4a.pro.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhdet5 + 1*tadhdet710 + 1*tadhdet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIpro =~ 1*proet5 + 1*proet710 + 1*proet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*tadhdet5
                  wad710 =~ 1*tadhdet710
                  wad12 =~ 1*tadhdet12
                  ## Prosocial 
                  wpro5 =~ 1*proet5
                  wpro710 =~ 1*proet710
                  wpro12 =~ 1*proet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ c*wsi5
                  wsi12 ~ c*wsi710
                  ## Pro social bahviour
                  wpro710 ~ d*wpro5
                  wpro12 ~ d*wpro710
                  ## ADHD
                  wad710 ~ e*wad5
                  wad12 ~ e*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  wpro12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  wpro12 ~ wad710
                  ## Prosocial
                  wsi710 ~ wpro5
                  wad710 ~ wpro5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ wsi5
                  wad12 ~ wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med.long4a.pro.t}
ri.med.long4a.pro.t.fit <- lavaan(model = ri.med.long4a.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long4a.pro.t.fit.summary <- summary(ri.med.long4a.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med.long.pro.t.fit and ri.med.long4a.pro.t.fit}
lavTestLRT(ri.med.long.pro.t.fit, ri.med.long4a.pro.t.fit, method = "satorra.bentler.2010")
```

This model is not significantly worse fit (p=0.2153)

###### 4b. Constrained cross-lag RI-CLPM mediation model 

This will now have both corss-lags and autoregressive parameters constrained. 

```{r ri.med.long4b.pro.t}
ri.med.long4b.pro.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhdet5 + 1*tadhdet710 + 1*tadhdet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIpro =~ 1*proet5 + 1*proet710 + 1*proet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*tadhdet5
                  wad710 =~ 1*tadhdet710
                  wad12 =~ 1*tadhdet12
                  ## Prosocial 
                  wpro5 =~ 1*proet5
                  wpro710 =~ 1*proet710
                  wpro12 =~ 1*proet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ g*wsi5
                  wsi12 ~ g*wsi710
                  ## Pro social bahviour
                  wpro710 ~ h*wpro5
                  wpro12 ~ h*wpro710
                  ## ADHD
                  wad710 ~ i*wad5
                  wad12 ~ i*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ e*wsi5
                  wad12 ~ e*wsi710
                  wpro12 ~ c*wsi710
                  ## ADHD
                  wsi710 ~ f*wad5
                  wsi12 ~ f*wad710
                  wpro12 ~ a*wad710
                  ## Prosocial
                  wsi710 ~ b*wpro5
                  wad710 ~ d*wpro5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ c*wsi5
                  wad12 ~ d*wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med.long4b.pro.t}
ri.med.long4b.pro.t.fit <- lavaan(model = ri.med.long4b.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long4b.pro.t.fit.summary <- summary(ri.med.long4b.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med.long.pro.t.fit and ri.med.long4a.pro.t.fit}
lavTestLRT(ri.med.long4a.pro.t.fit, ri.med.long4b.pro.t.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.582). Therefore this model 4b will be carried forward (**both autoregressive and cross-lags constrained**)

```{r results table for random intercept mother report prosocial and total adhd}
# Model fit 
ri.med.long4b.pro.t.fit.summary.fit <- table.model.fit(ri.med.long4b.pro.t.fit.summary)
# Coefficients
ri.med.long4b.pro.t.fit.summary.reg <- table.model.coef(model = ri.med.long4b.pro.t.fit.summary, step = "S4")
```

Results show that 
* Significant autoregressive lags for isolation and ADHD, but not for prosocial behaviours
* Isolation does *not* predict later ADHD (e)
* Isolation does *not* predict later lower prosocial behaviours (c)
* ADHD **does** predict later isolation (f)
* Prosocial behaviours *do not* predict later lower ADHD (d)
* ADHD predicts *does not* predict later lower prosocial behaviours (a)
* Prosocial behaviours *do not* predict later lower isolation (b)
* **Nonsignificant** indirect mediation path (a*b, p=0.45). ADHD -> lower prosocial behaviours -> isolation


##### Hyperactivity symptoms 

###### 1. The CLPM mediation model 

```{r med_hyp.long.pro.t}
med_hyp.long.pro.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ sisoet5
                  sisoet12 ~ sisoet710
                  ## Pro social bahviour
                  proet710 ~ proet5
                  proet12 ~ proet710
                  ## ADHD
                  hyet710 ~ hyet5
                  hyet12 ~ hyet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  hyet710 ~ sisoet5
                  hyet12 ~ sisoet710
                  ## ADHD
                  sisoet710 ~ hyet5
                  sisoet12 ~ hyet710
                  ## Prosocial
                  sisoet710 ~ proet5
                  hyet710 ~ proet5
                  proet12 ~ sisoet710
                  proet12 ~ hyet710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proet710 ~ a*hyet5 
                  sisoet12 ~ b*proet710
                  ## Isolation to ADHD
                  proet710 ~ sisoet5
                  hyet12 ~ proet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ proet5
                  proet5 ~~ hyet5
                  sisoet5 ~~ hyet5
                  sisoet710 ~~ proet710
                  proet710 ~~ hyet710
                  sisoet710 ~~ hyet710
                  sisoet12 ~~ proet12
                  proet12 ~~ hyet12
                  sisoet12 ~~ hyet12
                    
                  ###### Variances ######
                  ## Variances
                  hyet5 ~~ hyet5 
                  sisoet5 ~~ sisoet5 
                  proet5 ~~ proet5
                  ## Residual variances
                  hyet710 ~~ hyet710 
                  sisoet710 ~~ sisoet710 
                  proet710 ~~ proet710
                  hyet12 ~~ hyet12 
                  sisoet12 ~~ sisoet12
                  proet12 ~~ proet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_hyp.long.pro.t}
med_hyp.long.pro.t.fit <- lavaan(model = med_hyp.long.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long.pro.t.fit.summary <- summary(med_hyp.long.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 2a. Constrained autoregressive paths CLPM mediation model 

```{r med_hyp.long2a.pro.t}
med_hyp.long2a.pro.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ c*sisoet5
                  sisoet12 ~ c*sisoet710
                  ## Pro social bahviour
                  proet710 ~ d*proet5
                  proet12 ~ d*proet710
                  ## ADHD
                  hyet710 ~ e*hyet5
                  hyet12 ~ e*hyet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  hyet710 ~ sisoet5
                  hyet12 ~ sisoet710
                  ## ADHD
                  sisoet710 ~ hyet5
                  sisoet12 ~ hyet710
                  ## Prosocial
                  sisoet710 ~ proet5
                  hyet710 ~ proet5
                  proet12 ~ sisoet710
                  proet12 ~ hyet710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proet710 ~ a*hyet5 
                  sisoet12 ~ b*proet710
                  ## Isolation to ADHD
                  proet710 ~ sisoet5
                  hyet12 ~ proet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ proet5
                  proet5 ~~ hyet5
                  sisoet5 ~~ hyet5
                  sisoet710 ~~ proet710
                  proet710 ~~ hyet710
                  sisoet710 ~~ hyet710
                  sisoet12 ~~ proet12
                  proet12 ~~ hyet12
                  sisoet12 ~~ hyet12
                    
                  ###### Variances ######
                  ## Variances
                  hyet5 ~~ hyet5 
                  sisoet5 ~~ sisoet5 
                  proet5 ~~ proet5
                  ## Residual variances
                  hyet710 ~~ hyet710 
                  sisoet710 ~~ sisoet710 
                  proet710 ~~ proet710
                  hyet12 ~~ hyet12 
                  sisoet12 ~~ sisoet12
                  proet12 ~~ proet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_hyp.long2a.pro.t}
med_hyp.long2a.pro.t.fit <- lavaan(model = med_hyp.long2a.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long2a.pro.t.fit.summary <- summary(med_hyp.long2a.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_hyp.long.pro.t.fit and med_hyp.long2a.pro.t.fit}
lavTestLRT(med_hyp.long.pro.t.fit, med_hyp.long2a.pro.t.fit, method = "satorra.bentler.2010")
```

Constrained autoregressive paths lead to significantly worse model fit. 

###### 2b. Constrained crosslag paths CLPM mediation model 

```{r med_hyp.long2b.pro.t}
med_hyp.long2b.pro.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ sisoet5
                  sisoet12 ~ sisoet710
                  ## Pro social bahviour
                  proet710 ~ proet5
                  proet12 ~ proet710
                  ## ADHD
                  hyet710 ~ hyet5
                  hyet12 ~ hyet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  hyet710 ~ e*sisoet5
                  hyet12 ~ e*sisoet710
                  proet12 ~ c*sisoet710
                  ## ADHD
                  sisoet710 ~ f*hyet5
                  sisoet12 ~ f*hyet710
                  proet12 ~ a*hyet710
                  ## Prosocial
                  sisoet710 ~ b*proet5
                  hyet710 ~ d*proet5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proet710 ~ a*hyet5 
                  sisoet12 ~ b*proet710
                  ## Isolation to ADHD
                  proet710 ~ c*sisoet5
                  hyet12 ~ d*proet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ proet5
                  proet5 ~~ hyet5
                  sisoet5 ~~ hyet5
                  sisoet710 ~~ proet710
                  proet710 ~~ hyet710
                  sisoet710 ~~ hyet710
                  sisoet12 ~~ proet12
                  proet12 ~~ hyet12
                  sisoet12 ~~ hyet12
                    
                  ###### Variances ######
                  ## Variances
                  hyet5 ~~ hyet5 
                  sisoet5 ~~ sisoet5 
                  proet5 ~~ proet5
                  ## Residual variances
                  hyet710 ~~ hyet710 
                  sisoet710 ~~ sisoet710 
                  proet710 ~~ proet710
                  hyet12 ~~ hyet12 
                  sisoet12 ~~ sisoet12
                  proet12 ~~ proet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_hyp.long.pro.t}
med_hyp.long2b.pro.t.fit <- lavaan(model = med_hyp.long2b.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long2b.pro.t.fit.summary <- summary(med_hyp.long2b.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_hyp.long.pro.t.fit and med_hyp.long2b.pro.t.fit}
lavTestLRT(med_hyp.long.pro.t.fit, med_hyp.long2b.pro.t.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.4832). Therefore this model 2b will be carried forward.

```{r results table for mother report prosocial and total adhd}
# Model fit 
med_hyp.long2b.pro.t.fit.summary.fit <- table.model.fit(med_hyp.long2b.pro.t.fit.summary)
# Coefficients
med_hyp.long2b.pro.t.fit.summary.reg <- table.model.coef(model = med_hyp.long2b.pro.t.fit.summary, step = "S2")
```

Results show that 
* All significant autoregressive lags
* Isolation *does not* predict later ADHD (e)
* Isolation predicts later lower prosocial behaviours (c)
* ADHD predicts later isolation (f)
* Prosocial behaviours predict later lower ADHD (d)
* ADHD predicts later lower prosocial behaviours (a)
* Prosocial behaviours predict later lower isolation (b)
* Significant indirect mediation path (a*b, p=0.0007). ADHD -> lower prosocial behaviours -> isolation

###### 3. The RI-CLPM mediation model 

```{r ri.med_hyp.long.pro.t}
ri.med_hyp.long.pro.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hyet5 + 1*hyet710 + 1*hyet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIpro =~ 1*proet5 + 1*proet710 + 1*proet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*hyet5
                  wad710 =~ 1*hyet710
                  wad12 =~ 1*hyet12
                  ## Prosocial 
                  wpro5 =~ 1*proet5
                  wpro710 =~ 1*proet710
                  wpro12 =~ 1*proet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## Pro social bahviour
                  wpro710 ~ wpro5
                  wpro12 ~ wpro710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  ## Prosocial
                  wsi710 ~ wpro5
                  wad710 ~ wpro5
                  wpro12 ~ wsi710
                  wpro12 ~ wad710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ wsi5
                  wad12 ~ wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_hyp.long.pro.t}
ri.med_hyp.long.pro.t.fit <- lavaan(model = ri.med_hyp.long.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long.pro.t.fit.summary <- summary(ri.med_hyp.long.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 4a. Constrained autoregressive RI-CLPM mediation model 

```{r ri.med_hyp.long4a.pro.t}
ri.med_hyp.long4a.pro.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hyet5 + 1*hyet710 + 1*hyet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIpro =~ 1*proet5 + 1*proet710 + 1*proet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*hyet5
                  wad710 =~ 1*hyet710
                  wad12 =~ 1*hyet12
                  ## Prosocial 
                  wpro5 =~ 1*proet5
                  wpro710 =~ 1*proet710
                  wpro12 =~ 1*proet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ c*wsi5
                  wsi12 ~ c*wsi710
                  ## Pro social bahviour
                  wpro710 ~ d*wpro5
                  wpro12 ~ d*wpro710
                  ## ADHD
                  wad710 ~ e*wad5
                  wad12 ~ e*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  wpro12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  wpro12 ~ wad710
                  ## Prosocial
                  wsi710 ~ wpro5
                  wad710 ~ wpro5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ wsi5
                  wad12 ~ wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_hyp.long4a.pro.t}
ri.med_hyp.long4a.pro.t.fit <- lavaan(model = ri.med_hyp.long4a.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long4a.pro.t.fit.summary <- summary(ri.med_hyp.long4a.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_hyp.long.pro.t.fit and ri.med_hyp.long4a.pro.t.fit}
lavTestLRT(ri.med_hyp.long.pro.t.fit, ri.med_hyp.long4a.pro.t.fit, method = "satorra.bentler.2010")
```

This was non-significant (p=0.08587) worse fit - therefore we will compare the 4b model to the 4a model. 

###### 4b. Constrained cross-lag RI-CLPM mediation model 

This will include constrained cross-lags and autoregressive lags. 

```{r ri.med_hyp.long4b.pro.t}
ri.med_hyp.long4b.pro.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hyet5 + 1*hyet710 + 1*hyet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIpro =~ 1*proet5 + 1*proet710 + 1*proet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*hyet5
                  wad710 =~ 1*hyet710
                  wad12 =~ 1*hyet12
                  ## Prosocial 
                  wpro5 =~ 1*proet5
                  wpro710 =~ 1*proet710
                  wpro12 =~ 1*proet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ g*wsi5
                  wsi12 ~ g*wsi710
                  ## Pro social bahviour
                  wpro710 ~ h*wpro5
                  wpro12 ~ h*wpro710
                  ## ADHD
                  wad710 ~ i*wad5
                  wad12 ~ i*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ e*wsi5
                  wad12 ~ e*wsi710
                  wpro12 ~ c*wsi710
                  ## ADHD
                  wsi710 ~ f*wad5
                  wsi12 ~ f*wad710
                  wpro12 ~ a*wad710
                  ## Prosocial
                  wsi710 ~ b*wpro5
                  wad710 ~ d*wpro5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ c*wsi5
                  wad12 ~ d*wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_hyp.long4b.pro.t}
ri.med_hyp.long4b.pro.t.fit <- lavaan(model = ri.med_hyp.long4b.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long4b.pro.t.fit.summary <- summary(ri.med_hyp.long4b.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_hyp.long.pro.t.fit and ri.med_hyp.long4a.pro.t.fit}
lavTestLRT(ri.med_hyp.long4a.pro.t.fit, ri.med_hyp.long4b.pro.t.fit, method = "satorra.bentler.2010")
```

This model was no significantly worse fit (p=0.5283). Therefore this model 4b will be carried forward.

```{r results table for random intercept mother report prosocial and total adhd}
# Model fit 
ri.med_hyp.long4b.pro.t.fit.summary.fit <- table.model.fit(ri.med_hyp.long4b.pro.t.fit.summary)
# Coefficients
ri.med_hyp.long4b.pro.t.fit.summary.reg <- table.model.coef(model = ri.med_hyp.long4b.pro.t.fit.summary, step = "S4")
```

Results show that 
* Significant autoregressive lags for isolation and hyperactivity, but not for prosocial behaviours. 
* Isolation does *not* predict later ADHD (e)
* Isolation does *not* predict later lower prosocial behaviours (c)
* ADHD **does** predict later isolation (p=0.008) (f)
* Prosocial behaviours *do not* predict later lower ADHD (d)
* ADHD **does** predict later lower prosocial behaviours (a)
* Prosocial behaviours *do not* predict later lower isolation (b)
* **Nonsignificant** indirect mediation path (a*b, p=0.141). ADHD -> lower prosocial behaviours -> isolation


##### Inattention symptoms 

###### 1. The CLPM mediation model 

```{r med_inat.long.pro.t}
med_inat.long.pro.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ sisoet5
                  sisoet12 ~ sisoet710
                  ## Pro social bahviour
                  proet710 ~ proet5
                  proet12 ~ proet710
                  ## ADHD
                  inet710 ~ inet5
                  inet12 ~ inet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  inet710 ~ sisoet5
                  inet12 ~ sisoet710
                  ## ADHD
                  sisoet710 ~ inet5
                  sisoet12 ~ inet710
                  ## Prosocial
                  sisoet710 ~ proet5
                  inet710 ~ proet5
                  proet12 ~ sisoet710
                  proet12 ~ inet710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proet710 ~ a*inet5 
                  sisoet12 ~ b*proet710
                  ## Isolation to ADHD
                  proet710 ~ sisoet5
                  inet12 ~ proet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ proet5
                  proet5 ~~ inet5
                  sisoet5 ~~ inet5
                  sisoet710 ~~ proet710
                  proet710 ~~ inet710
                  sisoet710 ~~ inet710
                  sisoet12 ~~ proet12
                  proet12 ~~ inet12
                  sisoet12 ~~ inet12
                    
                  ###### Variances ######
                  ## Variances
                  inet5 ~~ inet5 
                  sisoet5 ~~ sisoet5 
                  proet5 ~~ proet5
                  ## Residual variances
                  inet710 ~~ inet710 
                  sisoet710 ~~ sisoet710 
                  proet710 ~~ proet710
                  inet12 ~~ inet12 
                  sisoet12 ~~ sisoet12
                  proet12 ~~ proet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_inat.long.pro.t}
med_inat.long.pro.t.fit <- lavaan(model = med_inat.long.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long.pro.t.fit.summary <- summary(med_inat.long.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 2a. Constrained autoregressive paths CLPM mediation model 

```{r med_inat.long2a.pro.t}
med_inat.long2a.pro.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ c*sisoet5
                  sisoet12 ~ c*sisoet710
                  ## Pro social bahviour
                  proet710 ~ d*proet5
                  proet12 ~ d*proet710
                  ## ADHD
                  inet710 ~ e*inet5
                  inet12 ~ e*inet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  inet710 ~ sisoet5
                  inet12 ~ sisoet710
                  ## ADHD
                  sisoet710 ~ inet5
                  sisoet12 ~ inet710
                  ## Prosocial
                  sisoet710 ~ proet5
                  inet710 ~ proet5
                  proet12 ~ sisoet710
                  proet12 ~ inet710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proet710 ~ a*inet5 
                  sisoet12 ~ b*proet710
                  ## Isolation to ADHD
                  proet710 ~ sisoet5
                  inet12 ~ proet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ proet5
                  proet5 ~~ inet5
                  sisoet5 ~~ inet5
                  sisoet710 ~~ proet710
                  proet710 ~~ inet710
                  sisoet710 ~~ inet710
                  sisoet12 ~~ proet12
                  proet12 ~~ inet12
                  sisoet12 ~~ inet12
                    
                  ###### Variances ######
                  ## Variances
                  inet5 ~~ inet5 
                  sisoet5 ~~ sisoet5 
                  proet5 ~~ proet5
                  ## Residual variances
                  inet710 ~~ inet710 
                  sisoet710 ~~ sisoet710 
                  proet710 ~~ proet710
                  inet12 ~~ inet12 
                  sisoet12 ~~ sisoet12
                  proet12 ~~ proet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_inat.long2a.pro.t}
med_inat.long2a.pro.t.fit <- lavaan(model = med_inat.long2a.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long2a.pro.t.fit.summary <- summary(med_inat.long2a.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_inat.long.pro.t.fit and med_inat.long2a.pro.t.fit}
lavTestLRT(med_inat.long.pro.t.fit, med_inat.long2a.pro.t.fit, method = "satorra.bentler.2010")
```

Constrained autoregressive paths did not lead to significantly worse model fit. 

###### 2b. Constrained crosslag paths CLPM mediation model 

This model has both cross and autoregressive lags constrained. 

```{r med_inat.long2b.pro.t}
med_inat.long2b.pro.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ g*sisoet5
                  sisoet12 ~ g*sisoet710
                  ## Pro social bahviour
                  proet710 ~ h*proet5
                  proet12 ~ h*proet710
                  ## ADHD
                  inet710 ~ i*inet5
                  inet12 ~ i*inet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  inet710 ~ e*sisoet5
                  inet12 ~ e*sisoet710
                  proet12 ~ c*sisoet710
                  ## ADHD
                  sisoet710 ~ f*inet5
                  sisoet12 ~ f*inet710
                  proet12 ~ a*inet710
                  ## Prosocial
                  sisoet710 ~ b*proet5
                  inet710 ~ d*proet5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  proet710 ~ a*inet5 
                  sisoet12 ~ b*proet710
                  ## Isolation to ADHD
                  proet710 ~ c*sisoet5
                  inet12 ~ d*proet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ proet5
                  proet5 ~~ inet5
                  sisoet5 ~~ inet5
                  sisoet710 ~~ proet710
                  proet710 ~~ inet710
                  sisoet710 ~~ inet710
                  sisoet12 ~~ proet12
                  proet12 ~~ inet12
                  sisoet12 ~~ inet12
                    
                  ###### Variances ######
                  ## Variances
                  inet5 ~~ inet5 
                  sisoet5 ~~ sisoet5 
                  proet5 ~~ proet5
                  ## Residual variances
                  inet710 ~~ inet710 
                  sisoet710 ~~ sisoet710 
                  proet710 ~~ proet710
                  inet12 ~~ inet12 
                  sisoet12 ~~ sisoet12
                  proet12 ~~ proet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_inat.long.pro.t}
med_inat.long2b.pro.t.fit <- lavaan(model = med_inat.long2b.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long2b.pro.t.fit.summary <- summary(med_inat.long2b.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_inat.long.pro.t.fit and med_inat.long2b.pro.t.fit}
lavTestLRT(med_inat.long2a.pro.t.fit, med_inat.long2b.pro.t.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints was significant loss in model fit (p=0.04625). However, this is verging on non-significance and the fit did not decrease substantially. Therefore this model 2b will be carried forward.

```{r results table for mother report prosocial and total adhd}
# Model fit 
med_inat.long2b.pro.t.fit.summary.fit <- table.model.fit(med_inat.long2b.pro.t.fit.summary)
# Coefficients
med_inat.long2b.pro.t.fit.summary.reg <- table.model.coef(model = med_inat.long2b.pro.t.fit.summary, step = "S2")
```

Results show that 
* All significant autoregressive lags
* Isolation *does not* predicts later ADHD (e)
* Isolation predicts later lower prosocial behaviours (c)
* ADHD predicts later isolation (f)
* Prosocial behaviours predict later lower ADHD (d)
* ADHD predicts later lower prosocial behaviours (a)
* Prosocial behaviours predict later lower isolation (b)
* Significant indirect mediation path (a*b, p=0.0007). ADHD -> lower prosocial behaviours -> isolation

###### 3. The RI-CLPM mediation model 

```{r ri.med_inat.long.pro.t}
ri.med_inat.long.pro.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*inet5 + 1*inet710 + 1*inet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIpro =~ 1*proet5 + 1*proet710 + 1*proet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*inet5
                  wad710 =~ 1*inet710
                  wad12 =~ 1*inet12
                  ## Prosocial 
                  wpro5 =~ 1*proet5
                  wpro710 =~ 1*proet710
                  wpro12 =~ 1*proet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## Pro social bahviour
                  wpro710 ~ wpro5
                  wpro12 ~ wpro710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  ## Prosocial
                  wsi710 ~ wpro5
                  wad710 ~ wpro5
                  wpro12 ~ wsi710
                  wpro12 ~ wad710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ wsi5
                  wad12 ~ wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_inat.long.pro.t}
ri.med_inat.long.pro.t.fit <- lavaan(model = ri.med_inat.long.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long.pro.t.fit.summary <- summary(ri.med_inat.long.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 4a. Constrained autoregressive RI-CLPM mediation model 

```{r ri.med_inat.long4a.pro.t}
ri.med_inat.long4a.pro.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*inet5 + 1*inet710 + 1*inet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIpro =~ 1*proet5 + 1*proet710 + 1*proet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*inet5
                  wad710 =~ 1*inet710
                  wad12 =~ 1*inet12
                  ## Prosocial 
                  wpro5 =~ 1*proet5
                  wpro710 =~ 1*proet710
                  wpro12 =~ 1*proet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ c*wsi5
                  wsi12 ~ c*wsi710
                  ## Pro social bahviour
                  wpro710 ~ d*wpro5
                  wpro12 ~ d*wpro710
                  ## ADHD
                  wad710 ~ e*wad5
                  wad12 ~ e*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  wpro12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  wpro12 ~ wad710
                  ## Prosocial
                  wsi710 ~ wpro5
                  wad710 ~ wpro5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ wsi5
                  wad12 ~ wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_inat.long4a.pro.t}
ri.med_inat.long4a.pro.t.fit <- lavaan(model = ri.med_inat.long4a.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long4a.pro.t.fit.summary <- summary(ri.med_inat.long4a.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_inat.long.pro.t.fit and ri.med_inat.long4a.pro.t.fit}
lavTestLRT(ri.med_inat.long.pro.t.fit, ri.med_inat.long4a.pro.t.fit, method = "satorra.bentler.2010")
```

This model was significantly worse fit (p=0.02571). However, the fit did not reduce dramatically, therefore we continue to compare the 4b to 4a. 


###### 4b. Constrained cross-lag RI-CLPM mediation model 

This model includes constrained autoregressive and cross lags. 

```{r ri.med_inat.long4b.pro.t}
ri.med_inat.long4b.pro.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*inet5 + 1*inet710 + 1*inet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIpro =~ 1*proet5 + 1*proet710 + 1*proet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*inet5
                  wad710 =~ 1*inet710
                  wad12 =~ 1*inet12
                  ## Prosocial 
                  wpro5 =~ 1*proet5
                  wpro710 =~ 1*proet710
                  wpro12 =~ 1*proet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ g*wsi5
                  wsi12 ~ g*wsi710
                  ## Pro social bahviour
                  wpro710 ~ h*wpro5
                  wpro12 ~ h*wpro710
                  ## ADHD
                  wad710 ~ i*wad5
                  wad12 ~ i*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ e*wsi5
                  wad12 ~ e*wsi710
                  wpro12 ~ c*wsi710
                  ## ADHD
                  wsi710 ~ f*wad5
                  wsi12 ~ f*wad710
                  wpro12 ~ a*wad710
                  ## Prosocial
                  wsi710 ~ b*wpro5
                  wad710 ~ d*wpro5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro710 ~ a*wad5 
                  wsi12 ~ b*wpro710
                  ## Isolation to ADHD
                  wpro710 ~ c*wsi5
                  wad12 ~ d*wpro710
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wpro710
                  wpro710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wpro710 ~~ wpro710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_inat.long4b.pro.t}
ri.med_inat.long4b.pro.t.fit <- lavaan(model = ri.med_inat.long4b.pro.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long4b.pro.t.fit.summary <- summary(ri.med_inat.long4b.pro.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_inat.long.pro.t.fit and ri.med_inat.long4a.pro.t.fit}
lavTestLRT(ri.med_inat.long.pro.t.fit, ri.med_inat.long4b.pro.t.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.0692). Therefore this model 4b will be carried forward.

```{r results table for random intercept mother report prosocial and total adhd}
# Model fit 
ri.med_inat.long4b.pro.t.fit.summary.fit <- table.model.fit(ri.med_inat.long4b.pro.t.fit.summary)
# Coefficients
ri.med_inat.long4b.pro.t.fit.summary.reg <- table.model.coef(model = ri.med_inat.long4b.pro.t.fit.summary, step = "S4")
```

Results show that 
* Significant autoregressive lags for social isolation and inattention, but not for prosocial behaviours.  
* Isolation does *not* predict later ADHD (e)
* Isolation does *not* predict later lower prosocial behaviours (c)
* ADHD *does not* predict later isolation (f)
* Prosocial behaviours *do not* predict later lower ADHD (d)
* ADHD *does not* predict later lower prosocial behaviours (a)
* Prosocial behaviours *do not* predict later lower isolation (b)
* **Nonsignificant** indirect mediation path (a*b, p=0.564). ADHD -> lower prosocial behaviours -> isolation

***


#### Antisocial behaviour 

##### Total ADHD symptoms 

###### 1. The CLPM mediation model 

```{r med.long.asb.t}
med.long.asb.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ sisoet5
                  sisoet12 ~ sisoet710
                  ## asb social bahviour
                  asbet710 ~ asbet5
                  asbet12 ~ asbet710
                  ## ADHD
                  tadhdet710 ~ tadhdet5
                  tadhdet12 ~ tadhdet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  tadhdet710 ~ sisoet5
                  tadhdet12 ~ sisoet710
                  ## ADHD
                  sisoet710 ~ tadhdet5
                  sisoet12 ~ tadhdet710
                  ## antisocial
                  sisoet710 ~ asbet5
                  tadhdet710 ~ asbet5
                  asbet12 ~ sisoet710
                  asbet12 ~ tadhdet710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbet710 ~ a*tadhdet5 
                  sisoet12 ~ b*asbet710
                  ## Isolation to ADHD
                  asbet710 ~ sisoet5
                  tadhdet12 ~ asbet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ asbet5
                  asbet5 ~~ tadhdet5
                  sisoet5 ~~ tadhdet5
                  sisoet710 ~~ asbet710
                  asbet710 ~~ tadhdet710
                  sisoet710 ~~ tadhdet710
                  sisoet12 ~~ asbet12
                  asbet12 ~~ tadhdet12
                  sisoet12 ~~ tadhdet12
                    
                  ###### Variances ######
                  ## Variances
                  tadhdet5 ~~ tadhdet5 
                  sisoet5 ~~ sisoet5 
                  asbet5 ~~ asbet5
                  ## Residual variances
                  tadhdet710 ~~ tadhdet710 
                  sisoet710 ~~ sisoet710 
                  asbet710 ~~ asbet710
                  tadhdet12 ~~ tadhdet12 
                  sisoet12 ~~ sisoet12
                  asbet12 ~~ asbet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med.long.asb.t}
med.long.asb.t.fit <- lavaan(model = med.long.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long.asb.t.fit.summary <- summary(med.long.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 2a. Constrained autoregressive paths CLPM mediation model 

```{r med.long2a.asb.t}
med.long2a.asb.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ c*sisoet5
                  sisoet12 ~ c*sisoet710
                  ## asb social bahviour
                  asbet710 ~ d*asbet5
                  asbet12 ~ d*asbet710
                  ## ADHD
                  tadhdet710 ~ e*tadhdet5
                  tadhdet12 ~ e*tadhdet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  tadhdet710 ~ sisoet5
                  tadhdet12 ~ sisoet710
                  ## ADHD
                  sisoet710 ~ tadhdet5
                  sisoet12 ~ tadhdet710
                  ## antisocial
                  sisoet710 ~ asbet5
                  tadhdet710 ~ asbet5
                  asbet12 ~ sisoet710
                  asbet12 ~ tadhdet710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbet710 ~ a*tadhdet5 
                  sisoet12 ~ b*asbet710
                  ## Isolation to ADHD
                  asbet710 ~ sisoet5
                  tadhdet12 ~ asbet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ asbet5
                  asbet5 ~~ tadhdet5
                  sisoet5 ~~ tadhdet5
                  sisoet710 ~~ asbet710
                  asbet710 ~~ tadhdet710
                  sisoet710 ~~ tadhdet710
                  sisoet12 ~~ asbet12
                  asbet12 ~~ tadhdet12
                  sisoet12 ~~ tadhdet12
                    
                  ###### Variances ######
                  ## Variances
                  tadhdet5 ~~ tadhdet5 
                  sisoet5 ~~ sisoet5 
                  asbet5 ~~ asbet5
                  ## Residual variances
                  tadhdet710 ~~ tadhdet710 
                  sisoet710 ~~ sisoet710 
                  asbet710 ~~ asbet710
                  tadhdet12 ~~ tadhdet12 
                  sisoet12 ~~ sisoet12
                  asbet12 ~~ asbet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med.long2a.asb.t}
med.long2a.asb.t.fit <- lavaan(model = med.long2a.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long2a.asb.t.fit.summary <- summary(med.long2a.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med.long.asb.t.fit and med.long2a.asb.t.fit}
lavTestLRT(med.long.asb.t.fit, med.long2a.asb.t.fit, method = "satorra.bentler.2010")
```

Constrained autoregressive paths lead to significantly worse model fit. 

###### 2b. Constrained crosslag paths CLPM mediation model 

```{r med.long2b.asb.t}
med.long2b.asb.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ sisoet5
                  sisoet12 ~ sisoet710
                  ## asb social bahviour
                  asbet710 ~ asbet5
                  asbet12 ~ asbet710
                  ## ADHD
                  tadhdet710 ~ tadhdet5
                  tadhdet12 ~ tadhdet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  tadhdet710 ~ e*sisoet5
                  tadhdet12 ~ e*sisoet710
                  asbet12 ~ c*sisoet710
                  ## ADHD
                  sisoet710 ~ f*tadhdet5
                  sisoet12 ~ f*tadhdet710
                  asbet12 ~ a*tadhdet710
                  ## antisocial
                  sisoet710 ~ b*asbet5
                  tadhdet710 ~ d*asbet5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbet710 ~ a*tadhdet5 
                  sisoet12 ~ b*asbet710
                  ## Isolation to ADHD
                  asbet710 ~ c*sisoet5
                  tadhdet12 ~ d*asbet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ asbet5
                  asbet5 ~~ tadhdet5
                  sisoet5 ~~ tadhdet5
                  sisoet710 ~~ asbet710
                  asbet710 ~~ tadhdet710
                  sisoet710 ~~ tadhdet710
                  sisoet12 ~~ asbet12
                  asbet12 ~~ tadhdet12
                  sisoet12 ~~ tadhdet12
                    
                  ###### Variances ######
                  ## Variances
                  tadhdet5 ~~ tadhdet5 
                  sisoet5 ~~ sisoet5 
                  asbet5 ~~ asbet5
                  ## Residual variances
                  tadhdet710 ~~ tadhdet710 
                  sisoet710 ~~ sisoet710 
                  asbet710 ~~ asbet710
                  tadhdet12 ~~ tadhdet12 
                  sisoet12 ~~ sisoet12
                  asbet12 ~~ asbet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med.long.asb.t}
med.long2b.asb.t.fit <- lavaan(model = med.long2b.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med.long2b.asb.t.fit.summary <- summary(med.long2b.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med.long.asb.t.fit and med.long2b.asb.t.fit}
lavTestLRT(med.long.asb.t.fit, med.long2b.asb.t.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.1118). Therefore this model 2b will be carried forward.

```{r results table for mother report antisocial and total adhd}
# Model fit 
med.long2b.asb.t.fit.summary.fit <- table.model.fit(med.long2b.asb.t.fit.summary)
# Coefficients
med.long2b.asb.t.fit.summary.reg <- table.model.coef(model = med.long2b.asb.t.fit.summary, step = "S2")
```

Results show that 
* All significant autoregressive lags 
* Isolation does *not* predict later ADHD (e)
* Isolation predicts later lower antisocial behaviours (c)
* ADHD predicts later isolation (f)
* antisocial behaviours predict later lower ADHD (d)
* ADHD predicts later lower antisocial behaviours (ish, p=0.051) (a)
* antisocial behaviours predict later lower isolation (b)
* Significant(ish) indirect mediation path (a*b, p=0.049). ADHD -> lower antisocial behaviours -> isolation

###### 3. The RI-CLPM mediation model 

```{r ri.med.long.asb.t}
ri.med.long.asb.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhdet5 + 1*tadhdet710 + 1*tadhdet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIasb =~ 1*asbet5 + 1*asbet710 + 1*asbet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*tadhdet5
                  wad710 =~ 1*tadhdet710
                  wad12 =~ 1*tadhdet12
                  ## antisocial 
                  wasb5 =~ 1*asbet5
                  wasb710 =~ 1*asbet710
                  wasb12 =~ 1*asbet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## asb social bahviour
                  wasb710 ~ wasb5
                  wasb12 ~ wasb710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  ## antisocial
                  wsi710 ~ wasb5
                  wad710 ~ wasb5
                  wasb12 ~ wsi710
                  wasb12 ~ wad710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ wsi5
                  wad12 ~ wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med.long.asb.t}
ri.med.long.asb.t.fit <- lavaan(model = ri.med.long.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long.asb.t.fit.summary <- summary(ri.med.long.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

**This parameter freed model produced negative variances and none of the paramter standard errors could be estimated?????**


###### 4a. Constrained autoregressive RI-CLPM mediation model 

```{r ri.med.long4a.asb.t}
ri.med.long4a.asb.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhdet5 + 1*tadhdet710 + 1*tadhdet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIasb =~ 1*asbet5 + 1*asbet710 + 1*asbet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*tadhdet5
                  wad710 =~ 1*tadhdet710
                  wad12 =~ 1*tadhdet12
                  ## antisocial 
                  wasb5 =~ 1*asbet5
                  wasb710 =~ 1*asbet710
                  wasb12 =~ 1*asbet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ c*wsi5
                  wsi12 ~ c*wsi710
                  ## asb social bahviour
                  wasb710 ~ d*wasb5
                  wasb12 ~ d*wasb710
                  ## ADHD
                  wad710 ~ e*wad5
                  wad12 ~ e*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  wasb12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  wasb12 ~ wad710
                  ## antisocial
                  wsi710 ~ wasb5
                  wad710 ~ wasb5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ wsi5
                  wad12 ~ wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med.long4a.asb.t}
ri.med.long4a.asb.t.fit <- lavaan(model = ri.med.long4a.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long4a.asb.t.fit.summary <- summary(ri.med.long4a.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med.long.asb.t.fit and ri.med.long4a.asb.t.fit}
lavTestLRT(ri.med.long.asb.t.fit, ri.med.long4a.asb.t.fit, method = "satorra.bentler.2010")
```

Does not give p value here, I think this is because it is actually better fit. 

###### 4b. Constrained cross-lag RI-CLPM mediation model 

```{r ri.med.long4b.asb.t}
ri.med.long4b.asb.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhdet5 + 1*tadhdet710 + 1*tadhdet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIasb =~ 1*asbet5 + 1*asbet710 + 1*asbet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*tadhdet5
                  wad710 =~ 1*tadhdet710
                  wad12 =~ 1*tadhdet12
                  ## antisocial 
                  wasb5 =~ 1*asbet5
                  wasb710 =~ 1*asbet710
                  wasb12 =~ 1*asbet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ g*wsi5
                  wsi12 ~ g*wsi710
                  ## asb social bahviour
                  wasb710 ~ h*wasb5
                  wasb12 ~ h*wasb710
                  ## ADHD
                  wad710 ~ i*wad5
                  wad12 ~ i*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ e*wsi5
                  wad12 ~ e*wsi710
                  wasb12 ~ c*wsi710
                  ## ADHD
                  wsi710 ~ f*wad5
                  wsi12 ~ f*wad710
                  wasb12 ~ a*wad710
                  ## antisocial
                  wsi710 ~ b*wasb5
                  wad710 ~ d*wasb5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ c*wsi5
                  wad12 ~ d*wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med.long4b.asb.t}
ri.med.long4b.asb.t.fit <- lavaan(model = ri.med.long4b.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long4b.asb.t.fit.summary <- summary(ri.med.long4b.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med.long.asb.t.fit and ri.med.long4a.asb.t.fit}
lavTestLRT(ri.med.long4a.asb.t.fit, ri.med.long4b.asb.t.fit, method = "satorra.bentler.2010")
```

This was not significantly worse fit, we will continue with the 4b model. 

```{r results table for random intercept mother report antisocial and total adhd}
# Model fit 
ri.med.long4b.asb.t.fit.summary.fit <- table.model.fit(ri.med.long4b.asb.t.fit.summary)
# Coefficients
ri.med.long4b.asb.t.fit.summary.reg <- table.model.coef(model = ri.med.long4b.asb.t.fit.summary, step = "S4")
```

Results show that 
* Significant autoregressive paths for anisocial behaviour and ADHD but not for social isolation. 
* Isolation does *not* predict later ADHD (e)
* Isolation does *not* predict later lower antisocial behaviours (c)
* ADHD does *not* predict later isolation (f)
* Antisocial behaviours *do not* predict later lower ADHD (d)
* ADHD *does not* predicts antisocial behaviours (a)
* Antisocial behaviours predict later lower isolation (b)
* **Nonsignificant** indirect mediation path (a*b, p=0.98). ADHD -> lower antisocial behaviours -> isolation


##### Hyperactivity symptoms 

###### 1. The CLPM mediation model 

```{r med_hyp.long.asb.t}
med_hyp.long.asb.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ sisoet5
                  sisoet12 ~ sisoet710
                  ## asb social bahviour
                  asbet710 ~ asbet5
                  asbet12 ~ asbet710
                  ## ADHD
                  hyet710 ~ hyet5
                  hyet12 ~ hyet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  hyet710 ~ sisoet5
                  hyet12 ~ sisoet710
                  ## ADHD
                  sisoet710 ~ hyet5
                  sisoet12 ~ hyet710
                  ## antisocial
                  sisoet710 ~ asbet5
                  hyet710 ~ asbet5
                  asbet12 ~ sisoet710
                  asbet12 ~ hyet710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbet710 ~ a*hyet5 
                  sisoet12 ~ b*asbet710
                  ## Isolation to ADHD
                  asbet710 ~ sisoet5
                  hyet12 ~ asbet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ asbet5
                  asbet5 ~~ hyet5
                  sisoet5 ~~ hyet5
                  sisoet710 ~~ asbet710
                  asbet710 ~~ hyet710
                  sisoet710 ~~ hyet710
                  sisoet12 ~~ asbet12
                  asbet12 ~~ hyet12
                  sisoet12 ~~ hyet12
                    
                  ###### Variances ######
                  ## Variances
                  hyet5 ~~ hyet5 
                  sisoet5 ~~ sisoet5 
                  asbet5 ~~ asbet5
                  ## Residual variances
                  hyet710 ~~ hyet710 
                  sisoet710 ~~ sisoet710 
                  asbet710 ~~ asbet710
                  hyet12 ~~ hyet12 
                  sisoet12 ~~ sisoet12
                  asbet12 ~~ asbet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_hyp.long.asb.t}
med_hyp.long.asb.t.fit <- lavaan(model = med_hyp.long.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long.asb.t.fit.summary <- summary(med_hyp.long.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 2a. Constrained autoregressive paths CLPM mediation model 

```{r med_hyp.long2a.asb.t}
med_hyp.long2a.asb.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ c*sisoet5
                  sisoet12 ~ c*sisoet710
                  ## asb social bahviour
                  asbet710 ~ d*asbet5
                  asbet12 ~ d*asbet710
                  ## ADHD
                  hyet710 ~ e*hyet5
                  hyet12 ~ e*hyet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  hyet710 ~ sisoet5
                  hyet12 ~ sisoet710
                  ## ADHD
                  sisoet710 ~ hyet5
                  sisoet12 ~ hyet710
                  ## antisocial
                  sisoet710 ~ asbet5
                  hyet710 ~ asbet5
                  asbet12 ~ sisoet710
                  asbet12 ~ hyet710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbet710 ~ a*hyet5 
                  sisoet12 ~ b*asbet710
                  ## Isolation to ADHD
                  asbet710 ~ sisoet5
                  hyet12 ~ asbet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ asbet5
                  asbet5 ~~ hyet5
                  sisoet5 ~~ hyet5
                  sisoet710 ~~ asbet710
                  asbet710 ~~ hyet710
                  sisoet710 ~~ hyet710
                  sisoet12 ~~ asbet12
                  asbet12 ~~ hyet12
                  sisoet12 ~~ hyet12
                    
                  ###### Variances ######
                  ## Variances
                  hyet5 ~~ hyet5 
                  sisoet5 ~~ sisoet5 
                  asbet5 ~~ asbet5
                  ## Residual variances
                  hyet710 ~~ hyet710 
                  sisoet710 ~~ sisoet710 
                  asbet710 ~~ asbet710
                  hyet12 ~~ hyet12 
                  sisoet12 ~~ sisoet12
                  asbet12 ~~ asbet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_hyp.long2a.asb.t}
med_hyp.long2a.asb.t.fit <- lavaan(model = med_hyp.long2a.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long2a.asb.t.fit.summary <- summary(med_hyp.long2a.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_hyp.long.asb.t.fit and med_hyp.long2a.asb.t.fit}
lavTestLRT(med_hyp.long.asb.t.fit, med_hyp.long2a.asb.t.fit, method = "satorra.bentler.2010")
```

Constrained autoregressive paths lead to significantly worse model fit. 

###### 2b. Constrained crosslag paths CLPM mediation model 

```{r med_hyp.long2b.asb.t}
med_hyp.long2b.asb.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ sisoet5
                  sisoet12 ~ sisoet710
                  ## asb social bahviour
                  asbet710 ~ asbet5
                  asbet12 ~ asbet710
                  ## ADHD
                  hyet710 ~ hyet5
                  hyet12 ~ hyet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  hyet710 ~ e*sisoet5
                  hyet12 ~ e*sisoet710
                  asbet12 ~ c*sisoet710
                  ## ADHD
                  sisoet710 ~ f*hyet5
                  sisoet12 ~ f*hyet710
                  asbet12 ~ a*hyet710
                  ## antisocial
                  sisoet710 ~ b*asbet5
                  hyet710 ~ d*asbet5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbet710 ~ a*hyet5 
                  sisoet12 ~ b*asbet710
                  ## Isolation to ADHD
                  asbet710 ~ c*sisoet5
                  hyet12 ~ d*asbet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ asbet5
                  asbet5 ~~ hyet5
                  sisoet5 ~~ hyet5
                  sisoet710 ~~ asbet710
                  asbet710 ~~ hyet710
                  sisoet710 ~~ hyet710
                  sisoet12 ~~ asbet12
                  asbet12 ~~ hyet12
                  sisoet12 ~~ hyet12
                    
                  ###### Variances ######
                  ## Variances
                  hyet5 ~~ hyet5 
                  sisoet5 ~~ sisoet5 
                  asbet5 ~~ asbet5
                  ## Residual variances
                  hyet710 ~~ hyet710 
                  sisoet710 ~~ sisoet710 
                  asbet710 ~~ asbet710
                  hyet12 ~~ hyet12 
                  sisoet12 ~~ sisoet12
                  asbet12 ~~ asbet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_hyp.long.asb.t}
med_hyp.long2b.asb.t.fit <- lavaan(model = med_hyp.long2b.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_hyp.long2b.asb.t.fit.summary <- summary(med_hyp.long2b.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_hyp.long.asb.t.fit and med_hyp.long2b.asb.t.fit}
lavTestLRT(med_hyp.long.asb.t.fit, med_hyp.long2b.asb.t.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.1948). Therefore this model 2b will be carried forward.

```{r results table for mother report antisocial and total adhd}
# Model fit 
med_hyp.long2b.asb.t.fit.summary.fit <- table.model.fit(med_hyp.long2b.asb.t.fit.summary)
# Coefficients
med_hyp.long2b.asb.t.fit.summary.reg <- table.model.coef(model = med_hyp.long2b.asb.t.fit.summary, step = "S2")
```

Results show that 
* All significant autoregressive lags
* Isolation predicts later ADHD (e)
* Isolation predicts later lower antisocial behaviours (c)
* ADHD *does not* predict later isolation (f)
* antisocial behaviours predict later lower ADHD (d)
* ADHD *does not* predicts later lower antisocial behaviours (a)
* antisocial behaviours predict later lower isolation (b)
* **Non-Significant** indirect mediation path (a*b, p=0.007). ADHD -> lower antisocial behaviours -> isolation

###### 3. The RI-CLPM mediation model 

```{r ri.med_hyp.long.asb.t}
ri.med_hyp.long.asb.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hyet5 + 1*hyet710 + 1*hyet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIasb =~ 1*asbet5 + 1*asbet710 + 1*asbet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*hyet5
                  wad710 =~ 1*hyet710
                  wad12 =~ 1*hyet12
                  ## antisocial 
                  wasb5 =~ 1*asbet5
                  wasb710 =~ 1*asbet710
                  wasb12 =~ 1*asbet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## asb social bahviour
                  wasb710 ~ wasb5
                  wasb12 ~ wasb710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  ## antisocial
                  wsi710 ~ wasb5
                  wad710 ~ wasb5
                  wasb12 ~ wsi710
                  wasb12 ~ wad710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ wsi5
                  wad12 ~ wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_hyp.long.asb.t}
ri.med_hyp.long.asb.t.fit <- lavaan(model = ri.med_hyp.long.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long.asb.t.fit.summary <- summary(ri.med_hyp.long.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 4a. Constrained autoregressive RI-CLPM mediation model 

```{r ri.med_hyp.long4a.asb.t}
ri.med_hyp.long4a.asb.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hyet5 + 1*hyet710 + 1*hyet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIasb =~ 1*asbet5 + 1*asbet710 + 1*asbet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*hyet5
                  wad710 =~ 1*hyet710
                  wad12 =~ 1*hyet12
                  ## antisocial 
                  wasb5 =~ 1*asbet5
                  wasb710 =~ 1*asbet710
                  wasb12 =~ 1*asbet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ c*wsi5
                  wsi12 ~ c*wsi710
                  ## asb social bahviour
                  wasb710 ~ d*wasb5
                  wasb12 ~ d*wasb710
                  ## ADHD
                  wad710 ~ e*wad5
                  wad12 ~ e*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  wasb12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  wasb12 ~ wad710
                  ## antisocial
                  wsi710 ~ wasb5
                  wad710 ~ wasb5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ wsi5
                  wad12 ~ wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_hyp.long4a.asb.t}
ri.med_hyp.long4a.asb.t.fit <- lavaan(model = ri.med_hyp.long4a.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long4a.asb.t.fit.summary <- summary(ri.med_hyp.long4a.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_hyp.long.asb.t.fit and ri.med_hyp.long4a.asb.t.fit}
lavTestLRT(ri.med_hyp.long.asb.t.fit, ri.med_hyp.long4a.asb.t.fit, method = "satorra.bentler.2010")
```

This model did not show significantly worse fit. 

###### 4b. Constrained cross-lag RI-CLPM mediation model 

```{r ri.med_hyp.long4b.asb.t}
ri.med_hyp.long4b.asb.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*hyet5 + 1*hyet710 + 1*hyet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIasb =~ 1*asbet5 + 1*asbet710 + 1*asbet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*hyet5
                  wad710 =~ 1*hyet710
                  wad12 =~ 1*hyet12
                  ## antisocial 
                  wasb5 =~ 1*asbet5
                  wasb710 =~ 1*asbet710
                  wasb12 =~ 1*asbet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ g*wsi5
                  wsi12 ~ g*wsi710
                  ## asb social bahviour
                  wasb710 ~ h*wasb5
                  wasb12 ~ h*wasb710
                  ## ADHD
                  wad710 ~ i*wad5
                  wad12 ~ i*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ e*wsi5
                  wad12 ~ e*wsi710
                  wasb12 ~ c*wsi710
                  ## ADHD
                  wsi710 ~ f*wad5
                  wsi12 ~ f*wad710
                  wasb12 ~ a*wad710
                  ## antisocial
                  wsi710 ~ b*wasb5
                  wad710 ~ d*wasb5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ c*wsi5
                  wad12 ~ d*wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_hyp.long4b.asb.t}
ri.med_hyp.long4b.asb.t.fit <- lavaan(model = ri.med_hyp.long4b.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_hyp.long4b.asb.t.fit.summary <- summary(ri.med_hyp.long4b.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_hyp.long.asb.t.fit and ri.med_hyp.long4a.asb.t.fit}
lavTestLRT(ri.med_hyp.long4a.asb.t.fit, ri.med_hyp.long4b.asb.t.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.3189). Therefore this model 4b will be carried forward.

```{r results table for random intercept mother report antisocial and total adhd}
# Model fit 
ri.med_hyp.long4b.asb.t.fit.summary.fit <- table.model.fit(ri.med_hyp.long4b.asb.t.fit.summary)
# Coefficients
ri.med_hyp.long4b.asb.t.fit.summary.reg <- table.model.coef(model = ri.med_hyp.long4b.asb.t.fit.summary, step = "S4")
```

Results show that 
* Only significant auto lags for antisocial behaviour
* Isolation predicts later ADHD (e) (minus Beta???)
* Isolation does *not* predict later lower antisocial behaviours (c)
* ADHD does *not* predict later isolation (p=0.019) (f)
* Antisocial behaviours predict (ish, p=0.05) later lower ADHD (d)
* ADHD *does not* predict later lower antisocial behaviours (a)
* Antisocial behaviours *does* predict later lower isolation (b)
* **Nonsignificant** indirect mediation path (a*b, p=0.269). ADHD -> lower antisocial behaviours -> isolation


##### Inattention symptoms 

###### 1. The CLPM mediation model 

```{r med_inat.long.asb.t}
med_inat.long.asb.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ sisoet5
                  sisoet12 ~ sisoet710
                  ## asb social bahviour
                  asbet710 ~ asbet5
                  asbet12 ~ asbet710
                  ## ADHD
                  inet710 ~ inet5
                  inet12 ~ inet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  inet710 ~ sisoet5
                  inet12 ~ sisoet710
                  ## ADHD
                  sisoet710 ~ inet5
                  sisoet12 ~ inet710
                  ## antisocial
                  sisoet710 ~ asbet5
                  inet710 ~ asbet5
                  asbet12 ~ sisoet710
                  asbet12 ~ inet710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbet710 ~ a*inet5 
                  sisoet12 ~ b*asbet710
                  ## Isolation to ADHD
                  asbet710 ~ sisoet5
                  inet12 ~ asbet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ asbet5
                  asbet5 ~~ inet5
                  sisoet5 ~~ inet5
                  sisoet710 ~~ asbet710
                  asbet710 ~~ inet710
                  sisoet710 ~~ inet710
                  sisoet12 ~~ asbet12
                  asbet12 ~~ inet12
                  sisoet12 ~~ inet12
                    
                  ###### Variances ######
                  ## Variances
                  inet5 ~~ inet5 
                  sisoet5 ~~ sisoet5 
                  asbet5 ~~ asbet5
                  ## Residual variances
                  inet710 ~~ inet710 
                  sisoet710 ~~ sisoet710 
                  asbet710 ~~ asbet710
                  inet12 ~~ inet12 
                  sisoet12 ~~ sisoet12
                  asbet12 ~~ asbet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_inat.long.asb.t}
med_inat.long.asb.t.fit <- lavaan(model = med_inat.long.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long.asb.t.fit.summary <- summary(med_inat.long.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 2a. Constrained autoregressive paths CLPM mediation model 

```{r med_inat.long2a.asb.t}
med_inat.long2a.asb.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ c*sisoet5
                  sisoet12 ~ c*sisoet710
                  ## asb social bahviour
                  asbet710 ~ d*asbet5
                  asbet12 ~ d*asbet710
                  ## ADHD
                  inet710 ~ e*inet5
                  inet12 ~ e*inet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  inet710 ~ sisoet5
                  inet12 ~ sisoet710
                  ## ADHD
                  sisoet710 ~ inet5
                  sisoet12 ~ inet710
                  ## antisocial
                  sisoet710 ~ asbet5
                  inet710 ~ asbet5
                  asbet12 ~ sisoet710
                  asbet12 ~ inet710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbet710 ~ a*inet5 
                  sisoet12 ~ b*asbet710
                  ## Isolation to ADHD
                  asbet710 ~ sisoet5
                  inet12 ~ asbet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ asbet5
                  asbet5 ~~ inet5
                  sisoet5 ~~ inet5
                  sisoet710 ~~ asbet710
                  asbet710 ~~ inet710
                  sisoet710 ~~ inet710
                  sisoet12 ~~ asbet12
                  asbet12 ~~ inet12
                  sisoet12 ~~ inet12
                    
                  ###### Variances ######
                  ## Variances
                  inet5 ~~ inet5 
                  sisoet5 ~~ sisoet5 
                  asbet5 ~~ asbet5
                  ## Residual variances
                  inet710 ~~ inet710 
                  sisoet710 ~~ sisoet710 
                  asbet710 ~~ asbet710
                  inet12 ~~ inet12 
                  sisoet12 ~~ sisoet12
                  asbet12 ~~ asbet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_inat.long2a.asb.t}
med_inat.long2a.asb.t.fit <- lavaan(model = med_inat.long2a.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long2a.asb.t.fit.summary <- summary(med_inat.long2a.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_inat.long.asb.t.fit and med_inat.long2a.asb.t.fit}
lavTestLRT(med_inat.long.asb.t.fit, med_inat.long2a.asb.t.fit, method = "satorra.bentler.2010")
```

Constrained autoregressive paths lead to significantly worse model fit. 

###### 2b. Constrained crosslag paths CLPM mediation model 

```{r med_inat.long2b.asb.t}
med_inat.long2b.asb.t <- ' 
                  ###### Autoregressive lags ######
                  ## Isolation
                  sisoet710 ~ sisoet5
                  sisoet12 ~ sisoet710
                  ## asb social bahviour
                  asbet710 ~ asbet5
                  asbet12 ~ asbet710
                  ## ADHD
                  inet710 ~ inet5
                  inet12 ~ inet710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  inet710 ~ e*sisoet5
                  inet12 ~ e*sisoet710
                  asbet12 ~ c*sisoet710
                  ## ADHD
                  sisoet710 ~ f*inet5
                  sisoet12 ~ f*inet710
                  asbet12 ~ a*inet710
                  ## antisocial
                  sisoet710 ~ b*asbet5
                  inet710 ~ d*asbet5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  asbet710 ~ a*inet5 
                  sisoet12 ~ b*asbet710
                  ## Isolation to ADHD
                  asbet710 ~ c*sisoet5
                  inet12 ~ d*asbet710
                  
                  ###### Covariances ######
                  sisoet5 ~~ asbet5
                  asbet5 ~~ inet5
                  sisoet5 ~~ inet5
                  sisoet710 ~~ asbet710
                  asbet710 ~~ inet710
                  sisoet710 ~~ inet710
                  sisoet12 ~~ asbet12
                  asbet12 ~~ inet12
                  sisoet12 ~~ inet12
                    
                  ###### Variances ######
                  ## Variances
                  inet5 ~~ inet5 
                  sisoet5 ~~ sisoet5 
                  asbet5 ~~ asbet5
                  ## Residual variances
                  inet710 ~~ inet710 
                  sisoet710 ~~ sisoet710 
                  asbet710 ~~ asbet710
                  inet12 ~~ inet12 
                  sisoet12 ~~ sisoet12
                  asbet12 ~~ asbet12

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r  fit med_inat.long2b.asb.t}
med_inat.long2b.asb.t.fit <- lavaan(model = med_inat.long2b.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

med_inat.long2b.asb.t.fit.summary <- summary(med_inat.long2b.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for med_inat.long.asb.t.fit and med_inat.long2b.asb.t.fit}
lavTestLRT(med_inat.long.asb.t.fit, med_inat.long2b.asb.t.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a significant loss in model fit (p=0.02991). Therefore the freed model should be used going forward.

```{r results table for mother report antisocial and total adhd}
# Model fit 
med_inat.long.asb.t.fit.summary.fit <- table.model.fit(med_inat.long.asb.t.fit.summary)
# Coefficients
med_inat.long.asb.t.fit.summary.reg <- table.model.coef(model = med_inat.long.asb.t.fit.summary, step = "S1")
```

Results show that (**NOT BEEN UPDATED**)
* All significant autoregressive lags
* Isolation *does not* predicts later ADHD (e)
* Isolation predicts later lower antisocial behaviours (c)
* ADHD predicts later isolation (f)
* antisocial behaviours predict later lower ADHD (d)
* ADHD predicts later lower antisocial behaviours (a)
* antisocial behaviours predict later lower isolation (b)
* Significant indirect mediation path (a*b, p=0.0007). ADHD -> lower antisocial behaviours -> isolation

###### 3. The RI-CLPM mediation model 

```{r ri.med_inat.long.asb.t}
ri.med_inat.long.asb.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*inet5 + 1*inet710 + 1*inet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIasb =~ 1*asbet5 + 1*asbet710 + 1*asbet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*inet5
                  wad710 =~ 1*inet710
                  wad12 =~ 1*inet12
                  ## antisocial 
                  wasb5 =~ 1*asbet5
                  wasb710 =~ 1*asbet710
                  wasb12 =~ 1*asbet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## asb social bahviour
                  wasb710 ~ wasb5
                  wasb12 ~ wasb710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  ## antisocial
                  wsi710 ~ wasb5
                  wad710 ~ wasb5
                  wasb12 ~ wsi710
                  wasb12 ~ wad710
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ wsi5
                  wad12 ~ wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_inat.long.asb.t}
ri.med_inat.long.asb.t.fit <- lavaan(model = ri.med_inat.long.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        se = "robust",        
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long.asb.t.fit.summary <- summary(ri.med_inat.long.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

###### 4a. Constrained autoregressive RI-CLPM mediation model 

```{r ri.med_inat.long4a.asb.t}
ri.med_inat.long4a.asb.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*inet5 + 1*inet710 + 1*inet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIasb =~ 1*asbet5 + 1*asbet710 + 1*asbet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*inet5
                  wad710 =~ 1*inet710
                  wad12 =~ 1*inet12
                  ## antisocial 
                  wasb5 =~ 1*asbet5
                  wasb710 =~ 1*asbet710
                  wasb12 =~ 1*asbet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ c*wsi5
                  wsi12 ~ c*wsi710
                  ## asb social bahviour
                  wasb710 ~ d*wasb5
                  wasb12 ~ d*wasb710
                  ## ADHD
                  wad710 ~ e*wad5
                  wad12 ~ e*wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ wsi5
                  wad12 ~ wsi710
                  wasb12 ~ wsi710
                  ## ADHD
                  wsi710 ~ wad5
                  wsi12 ~ wad710
                  wasb12 ~ wad710
                  ## antisocial
                  wsi710 ~ wasb5
                  wad710 ~ wasb5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ wsi5
                  wad12 ~ wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_inat.long4a.asb.t}
ri.med_inat.long4a.asb.t.fit <- lavaan(model = ri.med_inat.long4a.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long4a.asb.t.fit.summary <- summary(ri.med_inat.long4a.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_inat.long.asb.t.fit and ri.med_inat.long4a.asb.t.fit}
lavTestLRT(ri.med_inat.long.asb.t.fit, ri.med_inat.long4a.asb.t.fit, method = "satorra.bentler.2010")
```

**Really large decrease in model fit - this should not be used going forward**

###### 4b. Constrained cross-lag RI-CLPM mediation model 

```{r ri.med_inat.long4b.asb.t}
ri.med_inat.long4b.asb.t <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*inet5 + 1*inet710 + 1*inet12 
                  RIsi =~ 1*sisoet5 + 1*sisoet710 + 1*sisoet12 
                  RIasb =~ 1*asbet5 + 1*asbet710 + 1*asbet12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoet5
                  wsi710 =~ 1*sisoet710
                  wsi12 =~ 1*sisoet12
                  ## ADHD
                  wad5 =~ 1*inet5
                  wad710 =~ 1*inet710
                  wad12 =~ 1*inet12
                  ## antisocial 
                  wasb5 =~ 1*asbet5
                  wasb710 =~ 1*asbet710
                  wasb12 =~ 1*asbet12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi710 ~ wsi5
                  wsi12 ~ wsi710
                  ## asb social bahviour
                  wasb710 ~ wasb5
                  wasb12 ~ wasb710
                  ## ADHD
                  wad710 ~ wad5
                  wad12 ~ wad710
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad710 ~ e*wsi5
                  wad12 ~ e*wsi710
                  wasb12 ~ c*wsi710
                  ## ADHD
                  wsi710 ~ f*wad5
                  wsi12 ~ f*wad710
                  wasb12 ~ a*wad710
                  ## antisocial
                  wsi710 ~ b*wasb5
                  wad710 ~ d*wasb5
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb710 ~ a*wad5 
                  wsi12 ~ b*wasb710
                  ## Isolation to ADHD
                  wasb710 ~ c*wsi5
                  wad12 ~ d*wasb710
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi710 ~~ wasb710
                  wasb710 ~~ wad710
                  wsi710 ~~ wad710
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad710 ~~ wad710 
                  wsi710 ~~ wsi710 
                  wasb710 ~~ wasb710
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect := a*b
         '
```

```{r fit ri.med_inat.long4b.asb.t}
ri.med_inat.long4b.asb.t.fit <- lavaan(model = ri.med_inat.long4b.asb.t, 
                        data = dat,
                        missing = 'ML',       
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med_inat.long4b.asb.t.fit.summary <- summary(ri.med_inat.long4b.asb.t.fit, standardized = TRUE, fit.measures = TRUE)
```

```{r LRT for ri.med_inat.long.asb.t.fit and ri.med_inat.long4a.asb.t.fit}
lavTestLRT(ri.med_inat.long.asb.t.fit, ri.med_inat.long4b.asb.t.fit, method = "satorra.bentler.2010")
```

The cross-lag constraints gave a non-significant loss in model fit (p=0.1202). Therefore this model 4b will be carried forward.

```{r results table for random intercept mother report antisocial and total adhd}
# Model fit 
ri.med_inat.long4b.asb.t.fit.summary.fit <- table.model.fit(ri.med_inat.long4b.asb.t.fit.summary)
# Coefficients
ri.med_inat.long4b.asb.t.fit.summary.reg <- table.model.coef(model = ri.med_inat.long4b.asb.t.fit.summary, step = "S4")
```

Results show that 
* Almost all significant autoregressive lags - increasing significance with age
* Isolation does *not* predict later ADHD (e)
* Isolation does (ish, p=0.052) predict later lower antisocial behaviours (c)
* ADHD does *not* predict later isolation (f)
* Antisocial behaviours *does not* predict later lower ADHD (d)
* ADHD *does not* predict later lower antisocial behaviours (a)
* Antisocial behaviours **do** predict later lower isolation (b)
* **Nonsignificant** indirect mediation path (a*b, p=0.356). ADHD -> lower antisocial behaviours -> isolation

***


