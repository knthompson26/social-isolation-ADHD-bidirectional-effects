---
title: "Factor analysis of social isolation items: mother and teacher report"
output:  
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: false
    number_sections: false
    highlight: monochrome
    theme: flatly
    code_folding: hide
    includes:
      after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment = NA,
                      prompt = FALSE,
                      cache = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      results = 'asis')

options(bitmapType = 'quartz') # to render fonts better
```

```{r Clear global environment, include=FALSE}
remove(list = ls())
```

```{r Load packages, include=FALSE}
library(knitr)
library(haven)
library(lavaan)
library(tidyverse)
library(dplyr) #conflicts with tidyverse for e.g. rename and row_number
```

```{r source the data file path, include=FALSE}
#source raw data directory: data_raw and data included
source("../isolation_ADHD_data_path.R")
```

```{r read in dta data file}
dat.raw <- read_dta(paste0(data.raw_path, "Katie_19Jan22.dta"))
colnames(dat.raw)

dat <- dat.raw %>%
  dplyr::select(id = atwinid,
         pe2m5,   # social isolation mother report raw items (elder variables)
         pe4m5,
         pe7m5,
         pe11m5,
         pe13m5,
         pe25m5,
         trf11e5, # social isolation teacher report raw items (elder variables)
         trf19e5,
         trf24e5,
         trf30e5,
         trf34e5,
         trf77e5,
         pe2m7,   # social isolation mother report raw items (elder variables)
         pe4m7,
         pe7m7,
         pe11m7,
         pe13m7,
         pe25m7,
         trf11e7, # social isolation teacher report raw items (elder variables)
         trf19e7,
         trf24e7,
         trf30e7,
         trf34e7,
         trf77e7,
         pe2m10,   # social isolation mother report raw items (elder variables)
         pe4m10,
         pe7m10,
         pe11m10,
         pe13m10,
         pe25m10,
         trf11e10, # social isolation teacher report raw items (elder variables)
         trf19e10,
         trf24e10,
         trf30e10,
         trf34e10,
         trf77e10,
         pe2m12,   # social isolation mother report raw items (elder variables)
         pe4m12,
         pe7m12,
         pe11m12,
         pe13m12,
         pe25m12,
         trf11e12, # social isolation teacher report raw items (elder variables)
         trf19e12,
         trf24e12,
         trf30e12,
         trf34e12,
         trf77e12
  )

colnames(dat)
```

# Mother report age 5 

All factors load adequately - but very poor model fit. 

```{r cfa model mother report age 5}
cfa.model.m5 <- 'isolation =~ 
              pe2m5 + 
              pe4m5 + 
              pe7m5 + 
              pe11m5 + 
              pe13m5 +
              pe25m5
'
cfa.model.m5.fit <- cfa(cfa.model.m5, data = dat, ordered = TRUE)
summary(cfa.model.m5.fit, fit.measures = TRUE, standardized = TRUE) # need to look at standardised laodings here
```

# Mother report age 7

All factors load adequately - but very poor model fit. 

```{r cfa model mother report age 7}
cfa.model.m7 <- 'isolation =~ 
              pe2m7 + 
              pe4m7 + 
              pe7m7 + 
              pe11m7 + 
              pe13m7 +
              pe25m7
'
cfa.model.m7.fit <- cfa(cfa.model.m7, data = dat, ordered = TRUE)
summary(cfa.model.m7.fit, fit.measures = TRUE, standardized = TRUE) # need to look at standardised laodings here
```

# Mother report age 10

All factors load adequately - but very poor model fit. 

```{r cfa model mother report age 10}
cfa.model.m10 <- 'isolation =~ 
              pe2m10 + 
              pe4m10 + 
              pe7m10 + 
              pe11m10 + 
              pe13m10 +
              pe25m10
'
cfa.model.m10.fit <- cfa(cfa.model.m10, data = dat, ordered = TRUE)
summary(cfa.model.m10.fit, fit.measures = TRUE, standardized = TRUE) # need to look at standardised laodings here
```

# Mother report age 12

All factors load adequately - but very poor model fit. 

```{r cfa model mother report age 10}
cfa.model.m12 <- 'isolation =~ 
              pe2m12 + 
              pe4m12 + 
              pe7m12 + 
              pe11m12 + 
              pe13m12 +
              pe25m12
'
cfa.model.m12.fit <- cfa(cfa.model.m12, data = dat, ordered = TRUE)
summary(cfa.model.m12.fit, fit.measures = TRUE, standardized = TRUE) # need to look at standardised laodings here
```

# Teacher report age 5

All factors load adequately - but very poor model fit. 

```{r cfa model teacher report age 5}
cfa.model.t5 <- 'isolation =~ 
              trf11e5 + 
              trf19e5 + 
              trf24e5 + 
              trf30e5 + 
              trf34e5 +
              trf77e5 
'
cfa.model.t5.fit <- cfa(cfa.model.t5, data = dat, ordered = TRUE)
summary(cfa.model.m5.fit, fit.measures = TRUE, standardized = TRUE) # need to look at standardised laodings here
```

# Teacher report age 7

All factors load adequately - but very poor model fit. 

```{r cfa model teacher report age 7}
cfa.model.t7 <- 'isolation =~ 
              trf11e7 + 
              trf19e7 + 
              trf24e7 + 
              trf30e7 + 
              trf34e7 +
              trf77e7 
'
cfa.model.t7.fit <- cfa(cfa.model.t7, data = dat, ordered = TRUE)
summary(cfa.model.m7.fit, fit.measures = TRUE, standardized = TRUE) # need to look at standardised laodings here
```

# Teacher report age 10

All factors load adequately - but very poor model fit. 

```{r cfa model teacher report age 10}
cfa.model.t10 <- 'isolation =~ 
              trf11e10 + 
              trf19e10 + 
              trf24e10 + 
              trf30e10 + 
              trf34e10 +
              trf77e10 
'
cfa.model.t10.fit <- cfa(cfa.model.t10, data = dat, ordered = TRUE)
summary(cfa.model.m10.fit, fit.measures = TRUE, standardized = TRUE) # need to look at standardised laodings here
```

# Teacher report age 12

All factors load adequately - but very poor model fit. 

```{r cfa model teacher report age 12}
cfa.model.t12 <- 'isolation =~ 
              trf11e12 + 
              trf19e12 + 
              trf24e12 + 
              trf30e12 + 
              trf34e12 +
              trf77e12 
'
cfa.model.t12.fit <- cfa(cfa.model.t12, data = dat, ordered = TRUE)
summary(cfa.model.m12.fit, fit.measures = TRUE, standardized = TRUE) # need to look at standardised laodings here
```
