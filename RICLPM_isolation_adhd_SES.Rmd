---
title: "SES differences in RI-CLPM for social isolation and ADHD symptoms in childhood"
output:  
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: false
    number_sections: false
    highlight: monochrome
    theme: flatly
    code_folding: hide
    includes:
      after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment = NA,
                      prompt = FALSE,
                      cache = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      results = 'asis')

options(bitmapType = 'quartz') # to render fonts better
```

```{r Clear global environment, include=FALSE}
remove(list = ls())
```

```{r Load packages, include=FALSE}
library(knitr)
library(haven)
library(lavaan)
library(tidyverse)
library(dplyr) #conflicts with tidyverse for e.g. rename and row_number
```

```{r source the data file path, include=FALSE}
#source raw data directory: data_raw and data included
source("../isolation_ADHD_data_path.R")
```

```{r read in dta data file}
dat.raw <- read_dta(paste0(data.raw_path, "Katie_10Mar22.dta"))

dat <- dat.raw %>%
  dplyr::select(id = atwinid,
         sampsex,
         seswq35,
         sisoem5,  # social isolation mother report
         sisoem7,
         sisoem10,
         sisoem12,
         sisoet5,  # social isolation teacher report
         sisoet7, 
         sisoet10,
         sisoet12,
         sisoe5,
         sisoe7,
         sisoe10,
         sisoe12,
         tadhdem5,  # total ADHD mother report
         tadhdem7,
         tadhdem10,
         tadhdem12,
         tadhdet5,  # total ADHD teacher report
         tadhdet7,
         tadhdet10,
         tadhdet12,
         hyem5,     # hyperactivity ADHD mother report
         hyem7,
         hyem10,
         hyem12, 
         hyet5,     # hyperactivity ADHD teacher report
         hyet7,
         hyet10,
         hyet12,
         inem5,    # inattention ADHD mother report
         inem7,
         inem10,
         inem12,
         inet5,    # inattention ADHD teacher report
         inet7,
         inet10,
         inet12,
         proem5,    # prosocial total scores mother report
         proem7,
         proem10,
         proem12, 
         proet5,    # prosocial total scores teacher report
         proet7,
         proet10,
         proet12, 
         asbem5,   # antisocial total scores mother report
         asbem7,
         asbem10,
         asbem12, 
         asbet5,   # antisocial total scores teacher report
         asbet7,
         asbet10,
         asbet12
  )

colnames(dat)
```

Functions

```{r functions}
# Table of model fit 
table.model.fit <- function(model){
  model.fit <- as.data.frame(t(as.data.frame(model$FIT))) %>%
    dplyr::select(chisq, df, chisq.scaled, cfi.robust, tli.robust, aic, bic, bic2, rmsea.robust, rmsea.ci.lower.robust, rmsea.ci.upper.robust, srmr) #can only be used with "MLR" estimator
  return(model.fit)
}

# Table of regression and correlation (standardised covariance) - only constrained models have been made into tables. 
table.model.coef <- function(model, ses){
  if (ses == "Low"){
    model.coef <- as.tibble(model$PE[c(86:101),]) %>% dplyr::select(-block, -group, -exo, -label, -std.lv, -std.nox)
    return(model.coef)
  } else if(ses == "Middle"){
    model.coef <- as.tibble(model$PE[c(17:32),]) %>% dplyr::select(-block, -group, -exo, -label, -std.lv, -std.nox)
    return(model.coef)
  } else if(ses == "High"){
    model.coef <- as.tibble(model$PE[c(155:170),]) %>% dplyr::select(-block, -group, -exo, -label, -std.lv, -std.nox)
    return(model.coef)
  } else {model.coef <- NULL}
}
```

First we need to recode SES as a factor, to show which level is which. 

```{r recode SES variable}
dat <- dat %>%
  mutate(
    SES = 
      recode_factor(as_factor(seswq35),
        "1" = "Low",
        "2" = "Middle", 
        "3" = "High"))

table(dat$SES)
```

***

# Create combined ADHD variables

```{r create combined total adhd variables}
# age 5
dat <- dat %>%
  mutate(tadhde5 = 
           case_when(
             is.na(tadhdem5) & is.na(tadhdet5) ~ NA_real_,
             is.na(tadhdem5) & !is.na(tadhdet5) ~ as.numeric(tadhdet5),
             is.na(tadhdet5) & !is.na(tadhdem5) ~ as.numeric(tadhdem5),
             !is.na(tadhdem5) & !is.na(tadhdet5) ~ as.numeric(rowMeans(across(.cols = c(tadhdem5,tadhdet5)))))
  )
# age 7
dat <- dat %>%
  mutate(tadhde7 = 
           case_when(
             is.na(tadhdem7) & is.na(tadhdet7) ~ NA_real_,
             is.na(tadhdem7) & !is.na(tadhdet7) ~ as.numeric(tadhdet7),
             is.na(tadhdet7) & !is.na(tadhdem7) ~ as.numeric(tadhdem7),
             !is.na(tadhdem7) & !is.na(tadhdet7) ~ as.numeric(rowMeans(across(.cols = c(tadhdem7,tadhdet7)))))
  )
# age 10
dat <- dat %>%
  mutate(tadhde10 = 
           case_when(
             is.na(tadhdem10) & is.na(tadhdet10) ~ NA_real_,
             is.na(tadhdem10) & !is.na(tadhdet10) ~ as.numeric(tadhdet10),
             is.na(tadhdet10) & !is.na(tadhdem10) ~ as.numeric(tadhdem10),
             !is.na(tadhdem10) & !is.na(tadhdet10) ~ as.numeric(rowMeans(across(.cols = c(tadhdem10,tadhdet10)))))
  )
# age 12
dat <- dat %>%
  mutate(tadhde12 = 
           case_when(
             is.na(tadhdem12) & is.na(tadhdet12) ~ NA_real_,
             is.na(tadhdem12) & !is.na(tadhdet12) ~ as.numeric(tadhdet12),
             is.na(tadhdet12) & !is.na(tadhdem12) ~ as.numeric(tadhdem12),
             !is.na(tadhdem12) & !is.na(tadhdet12) ~ as.numeric(rowMeans(across(.cols = c(tadhdem12,tadhdet12)))))
  )
```

```{r create combined hyperactivity adhd variables}
# age 5
dat <- dat %>%
  mutate(hye5 = 
           case_when(
             is.na(hyem5) & is.na(hyet5) ~ NA_real_,
             is.na(hyem5) & !is.na(hyet5) ~ as.numeric(hyet5),
             is.na(hyet5) & !is.na(hyem5) ~ as.numeric(hyem5),
             !is.na(hyem5) & !is.na(hyet5) ~ as.numeric(rowMeans(across(.cols = c(hyem5,hyet5)))))
  )
# age 7
dat <- dat %>%
  mutate(hye7 = 
           case_when(
             is.na(hyem7) & is.na(hyet7) ~ NA_real_,
             is.na(hyem7) & !is.na(hyet7) ~ as.numeric(hyet7),
             is.na(hyet7) & !is.na(hyem7) ~ as.numeric(hyem7),
             !is.na(hyem7) & !is.na(hyet7) ~ as.numeric(rowMeans(across(.cols = c(hyem7,hyet7)))))
  )
# age 10
dat <- dat %>%
  mutate(hye10 = 
           case_when(
             is.na(hyem10) & is.na(hyet10) ~ NA_real_,
             is.na(hyem10) & !is.na(hyet10) ~ as.numeric(hyet10),
             is.na(hyet10) & !is.na(hyem10) ~ as.numeric(hyem10),
             !is.na(hyem10) & !is.na(hyet10) ~ as.numeric(rowMeans(across(.cols = c(hyem10,hyet10)))))
  )
# age 12
dat <- dat %>%
  mutate(hye12 = 
           case_when(
             is.na(hyem12) & is.na(hyet12) ~ NA_real_,
             is.na(hyem12) & !is.na(hyet12) ~ as.numeric(hyet12),
             is.na(hyet12) & !is.na(hyem12) ~ as.numeric(hyem12),
             !is.na(hyem12) & !is.na(hyet12) ~ as.numeric(rowMeans(across(.cols = c(hyem12,hyet12)))))
  )
```

```{r create combined inattention adhd variables}
# age 5
dat <- dat %>%
  mutate(ine5 = 
           case_when(
             is.na(inem5) & is.na(inet5) ~ NA_real_,
             is.na(inem5) & !is.na(inet5) ~ as.numeric(inet5),
             is.na(inet5) & !is.na(inem5) ~ as.numeric(inem5),
             !is.na(inem5) & !is.na(inet5) ~ as.numeric(rowMeans(across(.cols = c(inem5,inet5)))))
  )
# age 7
dat <- dat %>%
  mutate(ine7 = 
           case_when(
             is.na(inem7) & is.na(inet7) ~ NA_real_,
             is.na(inem7) & !is.na(inet7) ~ as.numeric(inet7),
             is.na(inet7) & !is.na(inem7) ~ as.numeric(inem7),
             !is.na(inem7) & !is.na(inet7) ~ as.numeric(rowMeans(across(.cols = c(inem7,inet7)))))
  )
# age 10
dat <- dat %>%
  mutate(ine10 = 
           case_when(
             is.na(inem10) & is.na(inet10) ~ NA_real_,
             is.na(inem10) & !is.na(inet10) ~ as.numeric(inet10),
             is.na(inet10) & !is.na(inem10) ~ as.numeric(inem10),
             !is.na(inem10) & !is.na(inet10) ~ as.numeric(rowMeans(across(.cols = c(inem10,inet10)))))
  )
# age 12
dat <- dat %>%
  mutate(ine12 = 
           case_when(
             is.na(inem12) & is.na(inet12) ~ NA_real_,
             is.na(inem12) & !is.na(inet12) ~ as.numeric(inet12),
             is.na(inet12) & !is.na(inem12) ~ as.numeric(inem12),
             !is.na(inem12) & !is.na(inet12) ~ as.numeric(rowMeans(across(.cols = c(inem12,inet12)))))
  )
```

## Combined report prosocial variables

```{r create combined report prosocial variables }
# age 5
dat <- dat %>%
  mutate(proe5 = 
           case_when(
             is.na(proem5) & is.na(proet5) ~ NA_real_,
             is.na(proem5) & !is.na(proet5) ~ as.numeric(proet5),
             is.na(proet5) & !is.na(proem5) ~ as.numeric(proem5),
             !is.na(proem5) & !is.na(proet5) ~ as.numeric(rowMeans(across(.cols = c(proem5,proet5)))))
  )
# age 7
dat <- dat %>%
  mutate(proe7 = 
           case_when(
             is.na(proem7) & is.na(proet7) ~ NA_real_,
             is.na(proem7) & !is.na(proet7) ~ as.numeric(proet7),
             is.na(proet7) & !is.na(proem7) ~ as.numeric(proem7),
             !is.na(proem7) & !is.na(proet7) ~ as.numeric(rowMeans(across(.cols = c(proem7,proet7)))))
  )
# age 10
dat <- dat %>%
  mutate(proe10 = 
           case_when(
             is.na(proem10) & is.na(proet10) ~ NA_real_,
             is.na(proem10) & !is.na(proet10) ~ as.numeric(proet10),
             is.na(proet10) & !is.na(proem10) ~ as.numeric(proem10),
             !is.na(proem10) & !is.na(proet10) ~ as.numeric(rowMeans(across(.cols = c(proem10,proet10)))))
  )
# age 12
dat <- dat %>%
  mutate(proe12 = 
           case_when(
             is.na(proem12) & is.na(proet12) ~ NA_real_,
             is.na(proem12) & !is.na(proet12) ~ as.numeric(proet12),
             is.na(proet12) & !is.na(proem12) ~ as.numeric(proem12),
             !is.na(proem12) & !is.na(proet12) ~ as.numeric(rowMeans(across(.cols = c(proem12,proet12)))))
  )
```

## Combined report antisocial variables

```{r create combined report asbsocial variables }
# age 5
dat <- dat %>%
  mutate(asbe5 = 
           case_when(
             is.na(asbem5) & is.na(asbet5) ~ NA_real_,
             is.na(asbem5) & !is.na(asbet5) ~ as.numeric(asbet5),
             is.na(asbet5) & !is.na(asbem5) ~ as.numeric(asbem5),
             !is.na(asbem5) & !is.na(asbet5) ~ as.numeric(rowMeans(across(.cols = c(asbem5,asbet5)))))
  )
# age 7
dat <- dat %>%
  mutate(asbe7 = 
           case_when(
             is.na(asbem7) & is.na(asbet7) ~ NA_real_,
             is.na(asbem7) & !is.na(asbet7) ~ as.numeric(asbet7),
             is.na(asbet7) & !is.na(asbem7) ~ as.numeric(asbem7),
             !is.na(asbem7) & !is.na(asbet7) ~ as.numeric(rowMeans(across(.cols = c(asbem7,asbet7)))))
  )
# age 10
dat <- dat %>%
  mutate(asbe10 = 
           case_when(
             is.na(asbem10) & is.na(asbet10) ~ NA_real_,
             is.na(asbem10) & !is.na(asbet10) ~ as.numeric(asbet10),
             is.na(asbet10) & !is.na(asbem10) ~ as.numeric(asbem10),
             !is.na(asbem10) & !is.na(asbet10) ~ as.numeric(rowMeans(across(.cols = c(asbem10,asbet10)))))
  )
# age 12
dat <- dat %>%
  mutate(asbe12 = 
           case_when(
             is.na(asbem12) & is.na(asbet12) ~ NA_real_,
             is.na(asbem12) & !is.na(asbet12) ~ as.numeric(asbet12),
             is.na(asbet12) & !is.na(asbem12) ~ as.numeric(asbem12),
             !is.na(asbem12) & !is.na(asbet12) ~ as.numeric(rowMeans(across(.cols = c(asbem12,asbet12)))))
  )
```

***

# Constrained model with SES differences 

In the script "RICLPM_isolation_adhd.Rmd" and "RICLPMcomb_isolation_adhd.Rmd", we decided that combined and mother report models will be constrained to have equal cross lags onlly, and teacher report models will be constrained to have equal autoregressive and crosslags. 

Here, we will apply sex difference testing to each of these reporter models. 

All models are using robust test statistics and standard errors. 

Imposing constraints to the model can be achieved through **pre-multiplication**. It means that we have to prepend the number that we want to fix the parameter to, and an asterisk, to the parameter in the model specification. For example, `F =~ 0*x1` fixes the factor loading of item `x1` to factor `F` to 0. Using pre-multiplication we can also constrain parameters to be the same by giving them the same label. Below we specify an RI-CLPM with the following constraints: 

Naming: 
  a = lag in ad
  b = lag in si
  c = cross lag ad->si
  d = cross lag si->ad

  sex.c = sex differences in constrained model 
  lag.c = lag constrained model
  sex.lag.c = sex and lag constrained model

We will text for sex differences in two steps: 
  1) Estimate a model where constraints are applied across lags but not for each of the groups (low/middle/high)
  2) Estimate a model where constraints are applied across both lags and the groups (low/middle/high)

An example of the constraining: For lag c, I have constrained each lag to be set to c1 for females and c2 for males. They layout for group specification is c(group 1, group 2, group 3). This provides the same estimates across each lag, but that they differ for different SES groups. 

## Combined report

### RI-CLPM - total ADHD symptoms

```{r specify RICLPMcomb.lag.c, class.source = 'fold-show'}
RICLPMcomb.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*tadhde5 + 1*tadhde7 + 1*tadhde10 + 1*tadhde12 #x
  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 #y

  # Create within-person centered variables
  wad5 =~ 1*tadhde5
  wad7 =~ 1*tadhde7
  wad10 =~ 1*tadhde10 
  wad12 =~ 1*tadhde12
  wsi5 =~ 1*sisoe5
  wsi7 =~ 1*sisoe7
  wsi10 =~ 1*sisoe10
  wsi12 =~ 1*sisoe12
  
  # Constrained lagged effects between the within-person centered variables. c(group1, group2) - different values across groups, but the same values within groups and across lags. 
  wad7 ~ wad5 + c(d1,d2,d3)*wsi5 
  wsi7 ~ c(c1,c2,c3)*wad5 + wsi5
  
  wad10 ~ wad7 + c(d1,d2,d3)*wsi7
  wsi10 ~ c(c1,c2,c3)*wad7 + wsi7
  
  wad12 ~ wad10 + c(d1,d2,d3)*wsi10
  wsi12 ~ c(c1,c2,c3)*wad10 + wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

To check for group differences in parameter estimates between different levels of SES, we specify that we are interested to group by SES.

```{r fit RICLPMcomb.lag.c grouped by ses}
RICLPMcomb.lag.c.fit <- lavaan(RICLPMcomb.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPMcomb.lag.c.fit.summary <- summary(RICLPMcomb.lag.c.fit, 
                                fit.measures = TRUE,
                                standardized = TRUE)

#Table of model fit 
RICLPMcomb.lag.c.fit.summary.fit <- table.model.fit(RICLPMcomb.lag.c.fit.summary)
#Table of regression coefficients and covariances for females and males separately
RICLPMcomb.lag.c.fit.summary.reg.low <- table.model.coef(model = RICLPMcomb.lag.c.fit.summary, ses = "Low")
RICLPMcomb.lag.c.fit.summary.reg.mid <- table.model.coef(model = RICLPMcomb.lag.c.fit.summary, ses = "Middle")
RICLPMcomb.lag.c.fit.summary.reg.high <- table.model.coef(model = RICLPMcomb.lag.c.fit.summary, ses = "High")

RICLPMcomb.lag.c.fit.summary.reg.high %>% select(lhs, op, rhs, std.all, pvalue) %>% mutate_if(is.numeric, round, 4)
```

Now we want to apply constraints over time to test if lagged parameters are invariant across groups, if the chi square is significant then the lagged effects for boys and girls are different.  
```{r specify RICLPMcomb.ses.lag.c}
RICLPMcomb.ses.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*tadhde5 + 1*tadhde7 + 1*tadhde10 + 1*tadhde12 #x
  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 #y

  # Create within-person centered variables
  wad5 =~ 1*tadhde5
  wad7 =~ 1*tadhde7
  wad10 =~ 1*tadhde10 
  wad12 =~ 1*tadhde12
  wsi5 =~ 1*sisoe5
  wsi7 =~ 1*sisoe7
  wsi10 =~ 1*sisoe10
  wsi12 =~ 1*sisoe12
  
 # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a1,a1,a1)*wad5 + c(d,d,d)*wsi5
  wsi7 ~ c(c,c,c)*wad5 + c(b1,b1,b1)*wsi5
  
  wad10 ~ c(a2,a2,a2)*wad7 + c(d,d,d)*wsi7
  wsi10 ~ c(c,c,c)*wad7 + c(b2,b2,b2)*wsi7
  
  wad12 ~ c(a3,a3,a3)*wad10 + c(d,d,d)*wsi10
  wsi12 ~ c(c,c,c)*wad10 + c(b3,b3,b3)*wsi10 

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMcomb.ses.lag.c grouped by ses}
RICLPMcomb.ses.lag.c.fit <- lavaan(RICLPMcomb.ses.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPMcomb.ses and RICLPMcomb.ses2}
lavTestLRT(RICLPMcomb.lag.c.fit, RICLPMcomb.ses.lag.c.fit, method = "satorra.bentler.2010")
```

For robust test statistics (MLR estimation and satorra.bentler.2010 LRT method): 
The chi-square difference test of these two nested models is **significant** (p=0.003083).

### RI-CLPM - Hyperactivity ADHD symptoms

```{r specify RICLPMcomb_hyp.lag.c, class.source = 'fold-show'}
RICLPMcomb_hyp.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*hye5 + 1*hye7 + 1*hye10 + 1*hye12 #x
  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 #y

  # Create within-person centered variables
  wad5 =~ 1*hye5
  wad7 =~ 1*hye7
  wad10 =~ 1*hye10 
  wad12 =~ 1*hye12
  wsi5 =~ 1*sisoe5
  wsi7 =~ 1*sisoe7
  wsi10 =~ 1*sisoe10
  wsi12 =~ 1*sisoe12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across lags. 
  wad7 ~ wad5 + c(d1,d2,d3)*wsi5 
  wsi7 ~ c(c1,c2,c3)*wad5 + wsi5
  
  wad10 ~ wad7 + c(d1,d2,d3)*wsi7
  wsi10 ~ c(c1,c2,c3)*wad7 + wsi7
  
  wad12 ~ wad10 + c(d1,d2,d3)*wsi10
  wsi12 ~ c(c1,c2,c3)*wad10 + wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

To check for group differences in parameter estimates between different levels of SES, we specify that we are interested to group by SES.

```{r fit RICLPMcomb_hyp.lag.c grouped by ses}
RICLPMcomb_hyp.lag.c.fit <- lavaan(RICLPMcomb_hyp.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPMcomb_hyp.lag.c.fit.summary <- summary(RICLPMcomb_hyp.lag.c.fit, 
                                fit.measures = TRUE,
                                standardized = TRUE)

#Table of model fit 
RICLPMcomb_hyp.lag.c.fit.summary.fit <- table.model.fit(RICLPMcomb_hyp.lag.c.fit.summary)
#Table of regression coefficients and covariances for females and males separately
RICLPMcomb_hyp.lag.c.fit.summary.reg.low <- table.model.coef(model = RICLPMcomb_hyp.lag.c.fit.summary, ses = "Low")
RICLPMcomb_hyp.lag.c.fit.summary.reg.mid <- table.model.coef(model = RICLPMcomb_hyp.lag.c.fit.summary, ses = "Middle")
RICLPMcomb_hyp.lag.c.fit.summary.reg.high <- table.model.coef(model = RICLPMcomb_hyp.lag.c.fit.summary, ses = "High")

RICLPMcomb_hyp.lag.c.fit.summary.reg.high %>% select(lhs, op, rhs, std.all, pvalue) %>% mutate_if(is.numeric, round, 4)
```

Now we want to apply constraints over time to test if lagged parameters are invariant across groups, if the chi square is significant then the lagged effects for boys and girls are different.  
```{r specify RICLPMcomb_hyp.ses.lag.c}
RICLPMcomb_hyp.ses.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*hye5 + 1*hye7 + 1*hye10 + 1*hye12 #x
  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 #y

  # Create within-person centered variables
  wad5 =~ 1*hye5
  wad7 =~ 1*hye7
  wad10 =~ 1*hye10 
  wad12 =~ 1*hye12
  wsi5 =~ 1*sisoe5
  wsi7 =~ 1*sisoe7
  wsi10 =~ 1*sisoe10
  wsi12 =~ 1*sisoe12
  
 # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a1,a1,a1)*wad5 + c(d,d,d)*wsi5
  wsi7 ~ c(c,c,c)*wad5 + c(b1,b1,b1)*wsi5
  
  wad10 ~ c(a2,a2,a2)*wad7 + c(d,d,d)*wsi7
  wsi10 ~ c(c,c,c)*wad7 + c(b2,b2,b2)*wsi7
  
  wad12 ~ c(a3,a3,a3)*wad10 + c(d,d,d)*wsi10
  wsi12 ~ c(c,c,c)*wad10 + c(b3,b3,b3)*wsi10 

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMcomb_hyp.ses.lag.c grouped by ses}
RICLPMcomb_hyp.ses.lag.c.fit <- lavaan(RICLPMcomb_hyp.ses.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPMcomb_hyp.ses and RICLPMcomb_hyp.ses2}
lavTestLRT(RICLPMcomb_hyp.lag.c.fit, RICLPMcomb_hyp.ses.lag.c.fit, method = "satorra.bentler.2010")
```

The chi-square difference test of these two nested models is **significant** (p=0.003312). 

### RI-CLPM - Inattention ADHD symptoms

```{r specify RICLPMcomb_inat.lag.c, class.source = 'fold-show'}
RICLPMcomb_inat.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*ine5 + 1*ine7 + 1*ine10 + 1*ine12 #x
  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 #y

  # Create within-person centered variables
  wad5 =~ 1*ine5
  wad7 =~ 1*ine7
  wad10 =~ 1*ine10 
  wad12 =~ 1*ine12
  wsi5 =~ 1*sisoe5
  wsi7 =~ 1*sisoe7
  wsi10 =~ 1*sisoe10
  wsi12 =~ 1*sisoe12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across lags. 
  wad7 ~ wad5 + c(d1,d2,d3)*wsi5 
  wsi7 ~ c(c1,c2,c3)*wad5 + wsi5
  
  wad10 ~ wad7 + c(d1,d2,d3)*wsi7
  wsi10 ~ c(c1,c2,c3)*wad7 + wsi7
  
  wad12 ~ wad10 + c(d1,d2,d3)*wsi10
  wsi12 ~ c(c1,c2,c3)*wad10 + wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

To check for group differences in parameter estimates between different levels of SES, we specify that we are interested to group by SES.

```{r fit RICLPMcomb_inat.lag.c grouped by ses}
RICLPMcomb_inat.lag.c.fit <- lavaan(RICLPMcomb_inat.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPMcomb_inat.lag.c.fit.summary <- summary(RICLPMcomb_inat.lag.c.fit, 
                                fit.measures = TRUE,
                                standardized = TRUE)

#Table of model fit 
RICLPMcomb_inat.lag.c.fit.summary.fit <- table.model.fit(RICLPMcomb_inat.lag.c.fit.summary)
#Table of regression coefficients and covariances for females and males separately
RICLPMcomb_inat.lag.c.fit.summary.reg.low <- table.model.coef(model = RICLPMcomb_inat.lag.c.fit.summary, ses = "Low")
RICLPMcomb_inat.lag.c.fit.summary.reg.mid <- table.model.coef(model = RICLPMcomb_inat.lag.c.fit.summary, ses = "Middle")
RICLPMcomb_inat.lag.c.fit.summary.reg.high <- table.model.coef(model = RICLPMcomb_inat.lag.c.fit.summary, ses = "High")

RICLPMcomb_hyp.lag.c.fit.summary.reg.high %>% select(lhs, op, rhs, std.all, pvalue) %>% mutate_if(is.numeric, round, 4)
```

Now we want to apply constraints over time to test if lagged parameters are invariant across groups, if the chi square is significant then the lagged effects for boys and girls are different.  

```{r specify RICLPMcomb_inat.ses.lag.c}
RICLPMcomb_inat.ses.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*ine5 + 1*ine7 + 1*ine10 + 1*ine12 #x
  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 #y

  # Create within-person centered variables
  wad5 =~ 1*ine5
  wad7 =~ 1*ine7
  wad10 =~ 1*ine10 
  wad12 =~ 1*ine12
  wsi5 =~ 1*sisoe5
  wsi7 =~ 1*sisoe7
  wsi10 =~ 1*sisoe10
  wsi12 =~ 1*sisoe12
  
 # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a1,a1,a1)*wad5 + c(d,d,d)*wsi5
  wsi7 ~ c(c,c,c)*wad5 + c(b1,b1,b1)*wsi5
  
  wad10 ~ c(a2,a2,a2)*wad7 + c(d,d,d)*wsi7
  wsi10 ~ c(c,c,c)*wad7 + c(b2,b2,b2)*wsi7
  
  wad12 ~ c(a3,a3,a3)*wad10 + c(d,d,d)*wsi10
  wsi12 ~ c(c,c,c)*wad10 + c(b3,b3,b3)*wsi10 

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMcomb_inat.ses.lag.c grouped by ses}
RICLPMcomb_inat.ses.lag.c.fit <- lavaan(RICLPMcomb_inat.ses.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPMcomb_inat.ses and RICLPMcomb_inat.ses2}
lavTestLRT(RICLPMcomb_inat.lag.c.fit, RICLPMcomb_inat.ses.lag.c.fit, method = "satorra.bentler.2010")
```

For robust statistics:
The chi-square difference test of these two nested models is **significant** (p=0.01348),

## Mother report

### RI-CLPM - total ADHD symptoms

```{r specify RICLPM.lag.c, class.source = 'fold-show'}
RICLPM.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*tadhdem5 + 1*tadhdem7 + 1*tadhdem10 + 1*tadhdem12 #x
  RIsi =~ 1*sisoem5 + 1*sisoem7 + 1*sisoem10 + 1*sisoem12 #y

  # Create within-person centered variables
  wad5 =~ 1*tadhdem5
  wad7 =~ 1*tadhdem7
  wad10 =~ 1*tadhdem10 
  wad12 =~ 1*tadhdem12
  wsi5 =~ 1*sisoem5
  wsi7 =~ 1*sisoem7
  wsi10 =~ 1*sisoem10
  wsi12 =~ 1*sisoem12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across lags. 
  wad7 ~ wad5 + c(d1,d2,d3)*wsi5 
  wsi7 ~ c(c1,c2,c3)*wad5 + wsi5
  
  wad10 ~ wad7 + c(d1,d2,d3)*wsi7
  wsi10 ~ c(c1,c2,c3)*wad7 + wsi7
  
  wad12 ~ wad10 + c(d1,d2,d3)*wsi10
  wsi12 ~ c(c1,c2,c3)*wad10 + wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

To check for group differences in parameter estimates between different levels of SES, we specify that we are interested to group by SES.

```{r fit RICLPM.lag.c grouped by ses}
RICLPM.lag.c.fit <- lavaan(RICLPM.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPM.lag.c.fit.summary <- summary(RICLPM.lag.c.fit, 
                                fit.measures = TRUE,
                                standardized = TRUE)

#Table of model fit 
RICLPM.lag.c.fit.summary.fit <- table.model.fit(RICLPM.lag.c.fit.summary)
#Table of regression coefficients and covariances for females and males separately
RICLPM.lag.c.fit.summary.reg.low <- table.model.coef(model = RICLPM.lag.c.fit.summary, ses = "Low")
RICLPM.lag.c.fit.summary.reg.mid <- table.model.coef(model = RICLPM.lag.c.fit.summary, ses = "Middle")
RICLPM.lag.c.fit.summary.reg.high <- table.model.coef(model = RICLPM.lag.c.fit.summary, ses = "High")
```

Now we want to apply constraints over time to test if lagged parameters are invariant across groups, if the chi square is significant then the lagged effects for boys and girls are different.  

```{r specify RICLPM.ses.lag.c}
RICLPM.ses.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*tadhdem5 + 1*tadhdem7 + 1*tadhdem10 + 1*tadhdem12 #x
  RIsi =~ 1*sisoem5 + 1*sisoem7 + 1*sisoem10 + 1*sisoem12 #y

  # Create within-person centered variables
  wad5 =~ 1*tadhdem5
  wad7 =~ 1*tadhdem7
  wad10 =~ 1*tadhdem10 
  wad12 =~ 1*tadhdem12
  wsi5 =~ 1*sisoem5
  wsi7 =~ 1*sisoem7
  wsi10 =~ 1*sisoem10
  wsi12 =~ 1*sisoem12
  
 # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a1,a1,a1)*wad5 + c(d,d,d)*wsi5
  wsi7 ~ c(c,c,c)*wad5 + c(b1,b1,b1)*wsi5
  
  wad10 ~ c(a2,a2,a2)*wad7 + c(d,d,d)*wsi7
  wsi10 ~ c(c,c,c)*wad7 + c(b2,b2,b2)*wsi7
  
  wad12 ~ c(a3,a3,a3)*wad10 + c(d,d,d)*wsi10
  wsi12 ~ c(c,c,c)*wad10 + c(b3,b3,b3)*wsi10 

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPM.ses.lag.c grouped by ses}
RICLPM.ses.lag.c.fit <- lavaan(RICLPM.ses.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPM.ses and RICLPM.ses2}
lavTestLRT(RICLPM.lag.c.fit, RICLPM.ses.lag.c.fit, method = "satorra.bentler.2010")
```

For robust test statistics (MLR estimation and satorra.bentler.2010 LRT method): 
The chi-square difference test of these two nested models is **non significant** (p=0.5758).

For non-rubust statistics:
The chi-square difference test of these two nested models is **significant** (p=0.009818), which implies that the lagged effects appear to be the **different for different levels of SES** 

SES differences found:
- Low SES has significant ADHD -> social isolation cross-lag (p=0.022)
- Non-significant cross-lags in middle SES. 
- Non-significant cross-lags in high SES. 
- Some differences in atuoregressive paths - but need to see what this means 

### RI-CLPM - Hyperactivity ADHD symptoms

```{r specify RICLPM_hyp.lag.c, class.source = 'fold-show'}
RICLPM_hyp.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*hyem5 + 1*hyem7 + 1*hyem10 + 1*hyem12 #x
  RIsi =~ 1*sisoem5 + 1*sisoem7 + 1*sisoem10 + 1*sisoem12 #y

  # Create within-person centered variables
  wad5 =~ 1*hyem5
  wad7 =~ 1*hyem7
  wad10 =~ 1*hyem10 
  wad12 =~ 1*hyem12
  wsi5 =~ 1*sisoem5
  wsi7 =~ 1*sisoem7
  wsi10 =~ 1*sisoem10
  wsi12 =~ 1*sisoem12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across lags. 
  wad7 ~ wad5 + c(d1,d2,d3)*wsi5 
  wsi7 ~ c(c1,c2,c3)*wad5 + wsi5
  
  wad10 ~ wad7 + c(d1,d2,d3)*wsi7
  wsi10 ~ c(c1,c2,c3)*wad7 + wsi7
  
  wad12 ~ wad10 + c(d1,d2,d3)*wsi10
  wsi12 ~ c(c1,c2,c3)*wad10 + wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

To check for group differences in parameter estimates between different levels of SES, we specify that we are interested to group by SES.

```{r fit RICLPM_hyp.lag.c grouped by ses}
RICLPM_hyp.lag.c.fit <- lavaan(RICLPM_hyp.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPM_hyp.lag.c.fit.summary <- summary(RICLPM_hyp.lag.c.fit, 
                                fit.measures = TRUE,
                                standardized = TRUE)

#Table of model fit 
RICLPM_hyp.lag.c.fit.summary.fit <- table.model.fit(RICLPM_hyp.lag.c.fit.summary)
#Table of regression coefficients and covariances for females and males separately
RICLPM_hyp.lag.c.fit.summary.reg.low <- table.model.coef(model = RICLPM_hyp.lag.c.fit.summary, ses = "Low")
RICLPM_hyp.lag.c.fit.summary.reg.mid <- table.model.coef(model = RICLPM_hyp.lag.c.fit.summary, ses = "Middle")
RICLPM_hyp.lag.c.fit.summary.reg.high <- table.model.coef(model = RICLPM_hyp.lag.c.fit.summary, ses = "High")
```

Now we want to apply constraints over time to test if lagged parameters are invariant across groups, if the chi square is significant then the lagged effects for boys and girls are different.  

```{r specify RICLPM_hyp.ses.lag.c}
RICLPM_hyp.ses.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*hyem5 + 1*hyem7 + 1*hyem10 + 1*hyem12 #x
  RIsi =~ 1*sisoem5 + 1*sisoem7 + 1*sisoem10 + 1*sisoem12 #y

  # Create within-person centered variables
  wad5 =~ 1*hyem5
  wad7 =~ 1*hyem7
  wad10 =~ 1*hyem10 
  wad12 =~ 1*hyem12
  wsi5 =~ 1*sisoem5
  wsi7 =~ 1*sisoem7
  wsi10 =~ 1*sisoem10
  wsi12 =~ 1*sisoem12
  
 # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a1,a1,a1)*wad5 + c(d,d,d)*wsi5
  wsi7 ~ c(c,c,c)*wad5 + c(b1,b1,b1)*wsi5
  
  wad10 ~ c(a2,a2,a2)*wad7 + c(d,d,d)*wsi7
  wsi10 ~ c(c,c,c)*wad7 + c(b2,b2,b2)*wsi7
  
  wad12 ~ c(a3,a3,a3)*wad10 + c(d,d,d)*wsi10
  wsi12 ~ c(c,c,c)*wad10 + c(b3,b3,b3)*wsi10 

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPM_hyp.ses.lag.c grouped by ses}
RICLPM_hyp.ses.lag.c.fit <- lavaan(RICLPM_hyp.ses.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPM_hyp.ses and RICLPM_hyp.ses2}
lavTestLRT(RICLPM_hyp.lag.c.fit, RICLPM_hyp.ses.lag.c.fit, method = "satorra.bentler.2010")
```

For robust statistics:
The chi-square difference test of these two nested models is **non significant** (p=0.6128). 

Fro non-robust statistics: 
The chi-square difference test of these two nested models is **significant** (p=0.02456), which implies that the lagged effects appear to be the **different for different levels of SES** 

SES differences found:
- Low SES has non-sig (p=0.098) ADHD -> social isolation cross-lag 
- Non-significant cross-lags in middle and high SES. 

*Can conclude here that there are no SES differences - no differences in significance of the cross-lags*

### RI-CLPM - Inattention ADHD symptoms

```{r specify RICLPM_inat.lag.c, class.source = 'fold-show'}
RICLPM_inat.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*inem5 + 1*inem7 + 1*inem10 + 1*inem12 #x
  RIsi =~ 1*sisoem5 + 1*sisoem7 + 1*sisoem10 + 1*sisoem12 #y

  # Create within-person centered variables
  wad5 =~ 1*inem5
  wad7 =~ 1*inem7
  wad10 =~ 1*inem10 
  wad12 =~ 1*inem12
  wsi5 =~ 1*sisoem5
  wsi7 =~ 1*sisoem7
  wsi10 =~ 1*sisoem10
  wsi12 =~ 1*sisoem12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across lags. 
  wad7 ~ wad5 + c(d1,d2,d3)*wsi5 
  wsi7 ~ c(c1,c2,c3)*wad5 + wsi5
  
  wad10 ~ wad7 + c(d1,d2,d3)*wsi7
  wsi10 ~ c(c1,c2,c3)*wad7 + wsi7
  
  wad12 ~ wad10 + c(d1,d2,d3)*wsi10
  wsi12 ~ c(c1,c2,c3)*wad10 + wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

To check for group differences in parameter estimates between different levels of SES, we specify that we are interested to group by SES.

```{r fit RICLPM_inat.lag.c grouped by ses}
RICLPM_inat.lag.c.fit <- lavaan(RICLPM_inat.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPM_inat.lag.c.fit.summary <- summary(RICLPM_inat.lag.c.fit, 
                                fit.measures = TRUE,
                                standardized = TRUE)

#Table of model fit 
RICLPM_inat.lag.c.fit.summary.fit <- table.model.fit(RICLPM_inat.lag.c.fit.summary)
#Table of regression coefficients and covariances for females and males separately
RICLPM_inat.lag.c.fit.summary.reg.low <- table.model.coef(model = RICLPM_inat.lag.c.fit.summary, ses = "Low")
RICLPM_inat.lag.c.fit.summary.reg.mid <- table.model.coef(model = RICLPM_inat.lag.c.fit.summary, ses = "Middle")
RICLPM_inat.lag.c.fit.summary.reg.high <- table.model.coef(model = RICLPM_inat.lag.c.fit.summary, ses = "High")
```

Now we want to apply constraints over time to test if lagged parameters are invariant across groups, if the chi square is significant then the lagged effects for boys and girls are different.  

```{r specify RICLPM_inat.ses.lag.c}
RICLPM_inat.ses.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*inem5 + 1*inem7 + 1*inem10 + 1*inem12 #x
  RIsi =~ 1*sisoem5 + 1*sisoem7 + 1*sisoem10 + 1*sisoem12 #y

  # Create within-person centered variables
  wad5 =~ 1*inem5
  wad7 =~ 1*inem7
  wad10 =~ 1*inem10 
  wad12 =~ 1*inem12
  wsi5 =~ 1*sisoem5
  wsi7 =~ 1*sisoem7
  wsi10 =~ 1*sisoem10
  wsi12 =~ 1*sisoem12
  
 # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a1,a1,a1)*wad5 + c(d,d,d)*wsi5
  wsi7 ~ c(c,c,c)*wad5 + c(b1,b1,b1)*wsi5
  
  wad10 ~ c(a2,a2,a2)*wad7 + c(d,d,d)*wsi7
  wsi10 ~ c(c,c,c)*wad7 + c(b2,b2,b2)*wsi7
  
  wad12 ~ c(a3,a3,a3)*wad10 + c(d,d,d)*wsi10
  wsi12 ~ c(c,c,c)*wad10 + c(b3,b3,b3)*wsi10 

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPM_inat.ses.lag.c grouped by ses}
RICLPM_inat.ses.lag.c.fit <- lavaan(RICLPM_inat.ses.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPM_inat.ses and RICLPM_inat.ses2}
lavTestLRT(RICLPM_inat.lag.c.fit, RICLPM_inat.ses.lag.c.fit, method = "satorra.bentler.2010")
```

For robust statistics:
The chi-square difference test of these two nested models is **non significant** (p=0.4287),

For non-robust statistics:
The chi-square difference test of these two nested models is **significant** (p=0.002148), which implies that the lagged effects appear to be the **different for different levels of SES** 

SES differences found:
- Low SES has significant (p=0.006) ADHD -> social isolation cross-lag 
- Non-significant cross-lags in middle and high SES. 

*Can conclude here that there are SES differences - low SES association remains only.*

***

## Teacher report

### RI-CLPM - total ADHD symptoms

```{r specify RICLPMt.lag.c, class.source = 'fold-show'}
RICLPMt.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*tadhdet5 + 1*tadhdet7 + 1*tadhdet10 + 1*tadhdet12 #x
  RIsi =~ 1*sisoet5 + 1*sisoet7 + 1*sisoet10 + 1*sisoet12 #y

  # Create within-person centered variables
  wad5 =~ 1*tadhdet5
  wad7 =~ 1*tadhdet7
  wad10 =~ 1*tadhdet10 
  wad12 =~ 1*tadhdet12
  wsi5 =~ 1*sisoet5
  wsi7 =~ 1*sisoet7
  wsi10 =~ 1*sisoet10
  wsi12 =~ 1*sisoet12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/middle, group2/low, group3/high) - different values across groups, but the same values within groups and across lags (all lags constrained). 
  wad7 ~ c(a1,a2,a3)*wad5 + c(d1,d2,d3)*wsi5 
  wsi7 ~ c(c1,c2,c3)*wad5 + c(b1,b2,b3)*wsi5
  
  wad10 ~ c(a1,a2,a3)*wad7 + c(d1,d2,d3)*wsi7
  wsi10 ~ c(c1,c2,c3)*wad7 + c(b1,b2,b3)*wsi7
  
  wad12 ~ c(a1,a2,a3)*wad10 + c(d1,d2,d3)*wsi10
  wsi12 ~ c(c1,c2,c3)*wad10 + c(b1,b2,b3)*wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

To check for group differences in parameter estimates between different levels of SES, we specify that we are interested to group by SES.

```{r fit RICLPMt.lag.c grouped by ses}
RICLPMt.lag.c.fit <- lavaan(RICLPMt.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPMt.lag.c.fit.summary <- summary(RICLPMt.lag.c.fit, 
                                fit.measures = TRUE,
                                standardized = TRUE)

#Table of model fit 
RICLPMt.lag.c.fit.summary.fit <- table.model.fit(RICLPMt.lag.c.fit.summary)
#Table of regression coefficients and covariances for females and males separately
RICLPMt.lag.c.fit.summary.reg.low <- table.model.coef(model = RICLPMt.lag.c.fit.summary, ses = "Low")
RICLPMt.lag.c.fit.summary.reg.mid <- table.model.coef(model = RICLPMt.lag.c.fit.summary, ses = "Middle")
RICLPMt.lag.c.fit.summary.reg.high <- table.model.coef(model = RICLPMt.lag.c.fit.summary, ses = "High")
```

Now we want to apply constraints over time to test if lagged parameters are invariant across groups, if the chi square is significant then the lagged effects for boys and girls are different.  

```{r specify RICLPMt.ses.lag.c}
RICLPMt.ses.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*tadhdet5 + 1*tadhdet7 + 1*tadhdet10 + 1*tadhdet12 #x
  RIsi =~ 1*sisoet5 + 1*sisoet7 + 1*sisoet10 + 1*sisoet12 #y

  # Create within-person centered variables
  wad5 =~ 1*tadhdet5
  wad7 =~ 1*tadhdet7
  wad10 =~ 1*tadhdet10 
  wad12 =~ 1*tadhdet12
  wsi5 =~ 1*sisoet5
  wsi7 =~ 1*sisoet7
  wsi10 =~ 1*sisoet10
  wsi12 =~ 1*sisoet12
  
 # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a,a,a)*wad5 + c(d,d,d)*wsi5
  wsi7 ~ c(c,c,c)*wad5 + c(b,b,b)*wsi5
  
  wad10 ~ c(a,a,a)*wad7 + c(d,d,d)*wsi7
  wsi10 ~ c(c,c,c)*wad7 + c(b,b,b)*wsi7
  
  wad12 ~ c(a,a,a)*wad10 + c(d,d,d)*wsi10
  wsi12 ~ c(c,c,c)*wad10 + c(b,b,b)*wsi10 

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMt.ses.lag.c grouped by ses}
RICLPMt.ses.lag.c.fit <- lavaan(RICLPMt.ses.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPMt.ses and RICLPMt.ses2}
lavTestLRT(RICLPMt.lag.c.fit, RICLPMt.ses.lag.c.fit, method = "satorra.bentler.2010")
```

For robust statistics:
The chi-square difference test of these two nested models is **non significant** (p=0.3931). 

For non-robust statistics: 
The chi-square difference test of these two nested models is **significant** (p=0.004629), which implies that the lagged effects appear to be the **different for different levels of SES** 

SES differences found:
- Low SES has non significant but close (p=0.061) ADHD -> social isolation cross-lag 
- Middle SES has significant (p=0.039) ADHD -> social isolation crosslag.
- No significant cross-lags in high SES. 

*Can conclude here that there are SES differences - middle SES association remains only (close for low SES).*

### RI-CLPM - hyperactivity ADHD symptoms

```{r specify RICLPMt_hyp.lag.c, class.source = 'fold-show'}
RICLPMt_hyp.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*hyet5 + 1*hyet7 + 1*hyet10 + 1*hyet12 #x
  RIsi =~ 1*sisoet5 + 1*sisoet7 + 1*sisoet10 + 1*sisoet12 #y

  # Create within-person centered variables
  wad5 =~ 1*hyet5
  wad7 =~ 1*hyet7
  wad10 =~ 1*hyet10 
  wad12 =~ 1*hyet12
  wsi5 =~ 1*sisoet5
  wsi7 =~ 1*sisoet7
  wsi10 =~ 1*sisoet10
  wsi12 =~ 1*sisoet12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/middle, group2/low, group3/high) - different values across groups, but the same values within groups and across lags (all lags constrained). 
  wad7 ~ c(a1,a2,a3)*wad5 + c(d1,d2,d3)*wsi5 
  wsi7 ~ c(c1,c2,c3)*wad5 + c(b1,b2,b3)*wsi5
  
  wad10 ~ c(a1,a2,a3)*wad7 + c(d1,d2,d3)*wsi7
  wsi10 ~ c(c1,c2,c3)*wad7 + c(b1,b2,b3)*wsi7
  
  wad12 ~ c(a1,a2,a3)*wad10 + c(d1,d2,d3)*wsi10
  wsi12 ~ c(c1,c2,c3)*wad10 + c(b1,b2,b3)*wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

To check for group differences in parameter estimates between different levels of SES, we specify that we are interested to group by SES.

```{r fit RICLPMt_hyp.lag.c grouped by ses}
RICLPMt_hyp.lag.c.fit <- lavaan(RICLPMt_hyp.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPMt_hyp.lag.c.fit.summary <- summary(RICLPMt_hyp.lag.c.fit, 
                                fit.measures = TRUE,
                                standardized = TRUE)

#Table of model fit 
RICLPMt_hyp.lag.c.fit.summary.fit <- table.model.fit(RICLPMt_hyp.lag.c.fit.summary)
#Table of regression coefficients and covariances for females and males separately
RICLPMt_hyp.lag.c.fit.summary.reg.low <- table.model.coef(model = RICLPMt_hyp.lag.c.fit.summary, ses = "Low")
RICLPMt_hyp.lag.c.fit.summary.reg.mid <- table.model.coef(model = RICLPMt_hyp.lag.c.fit.summary, ses = "Middle")
RICLPMt_hyp.lag.c.fit.summary.reg.high <- table.model.coef(model = RICLPMt_hyp.lag.c.fit.summary, ses = "High")
```

Now we want to apply constraints over time to test if lagged parameters are invariant across groups, if the chi square is significant then the lagged effects for boys and girls are different.  

```{r specify RICLPMt_hyp.ses.lag.c}
RICLPMt_hyp.ses.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*hyet5 + 1*hyet7 + 1*hyet10 + 1*hyet12 #x
  RIsi =~ 1*sisoet5 + 1*sisoet7 + 1*sisoet10 + 1*sisoet12 #y

  # Create within-person centered variables
  wad5 =~ 1*hyet5
  wad7 =~ 1*hyet7
  wad10 =~ 1*hyet10 
  wad12 =~ 1*hyet12
  wsi5 =~ 1*sisoet5
  wsi7 =~ 1*sisoet7
  wsi10 =~ 1*sisoet10
  wsi12 =~ 1*sisoet12
  
 # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a,a,a)*wad5 + c(d,d,d)*wsi5
  wsi7 ~ c(c,c,c)*wad5 + c(b,b,b)*wsi5
  
  wad10 ~ c(a,a,a)*wad7 + c(d,d,d)*wsi7
  wsi10 ~ c(c,c,c)*wad7 + c(b,b,b)*wsi7
  
  wad12 ~ c(a,a,a)*wad10 + c(d,d,d)*wsi10
  wsi12 ~ c(c,c,c)*wad10 + c(b,b,b)*wsi10 

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMt_hyp.ses.lag.c grouped by ses}
RICLPMt_hyp.ses.lag.c.fit <- lavaan(RICLPMt_hyp.ses.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPMt_hyp.ses and RICLPMt_hyp.ses2}
lavTestLRT(RICLPMt_hyp.lag.c.fit, RICLPMt_hyp.ses.lag.c.fit, method = "satorra.bentler.2010")
```

For robust statistics:
The chi-square difference test of these two nested models is **non significant** (p=0.3033). 

For non-robust statistics
The chi-square difference test of these two nested models is **significant** (p=0.001871), which implies that the lagged effects appear to be the **different for different levels of SES** 

SES differences found:
- Low SES has significant (p=0.008) ADHD -> social isolation cross-lag 
- Middle SES has significant (p=0.014) ADHD -> social isolation cross-lag.
- No significant cross-lags in high SES. 

*Can conclude here that there are SES differences - low and middle SES association remains only.*

### RI-CLPM - Inattention ADHD symptoms

```{r specify RICLPMt_inat.lag.c, class.source = 'fold-show'}
RICLPMt_inat.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*inet5 + 1*inet7 + 1*inet10 + 1*inet12 #x
  RIsi =~ 1*sisoet5 + 1*sisoet7 + 1*sisoet10 + 1*sisoet12 #y

  # Create within-person centered variables
  wad5 =~ 1*inet5
  wad7 =~ 1*inet7
  wad10 =~ 1*inet10 
  wad12 =~ 1*inet12
  wsi5 =~ 1*sisoet5
  wsi7 =~ 1*sisoet7
  wsi10 =~ 1*sisoet10
  wsi12 =~ 1*sisoet12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/middle, group2/low, group3/high) - different values across groups, but the same values within groups and across lags (all lags constrained). 
  wad7 ~ c(a1,a2,a3)*wad5 + c(d1,d2,d3)*wsi5 
  wsi7 ~ c(c1,c2,c3)*wad5 + c(b1,b2,b3)*wsi5
  
  wad10 ~ c(a1,a2,a3)*wad7 + c(d1,d2,d3)*wsi7
  wsi10 ~ c(c1,c2,c3)*wad7 + c(b1,b2,b3)*wsi7
  
  wad12 ~ c(a1,a2,a3)*wad10 + c(d1,d2,d3)*wsi10
  wsi12 ~ c(c1,c2,c3)*wad10 + c(b1,b2,b3)*wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

To check for group differences in parameter estimates between different levels of SES, we specify that we are interested to group by SES.

```{r fit RICLPMt_inat.lag.c grouped by ses}
RICLPMt_inat.lag.c.fit <- lavaan(RICLPMt_inat.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPMt_inat.lag.c.fit.summary <- summary(RICLPMt_inat.lag.c.fit, 
                                fit.measures = TRUE,
                                standardized = TRUE)

#Table of model fit 
RICLPMt_inat.lag.c.fit.summary.fit <- table.model.fit(RICLPMt_inat.lag.c.fit.summary)
#Table of regression coefficients and covariances for females and males separately
RICLPMt_inat.lag.c.fit.summary.reg.low <- table.model.coef(model = RICLPMt_inat.lag.c.fit.summary, ses = "Low")
RICLPMt_inat.lag.c.fit.summary.reg.mid <- table.model.coef(model = RICLPMt_inat.lag.c.fit.summary, ses = "Middle")
RICLPMt_inat.lag.c.fit.summary.reg.high <- table.model.coef(model = RICLPMt_inat.lag.c.fit.summary, ses = "High")
```

Now we want to apply constraints over time to test if lagged parameters are invariant across groups, if the chi square is significant then the lagged effects for boys and girls are different.  

```{r specify RICLPMt_inat.ses.lag.c}
RICLPMt_inat.ses.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*inet5 + 1*inet7 + 1*inet10 + 1*inet12 #x
  RIsi =~ 1*sisoet5 + 1*sisoet7 + 1*sisoet10 + 1*sisoet12 #y

  # Create within-person centered variables
  wad5 =~ 1*inet5
  wad7 =~ 1*inet7
  wad10 =~ 1*inet10 
  wad12 =~ 1*inet12
  wsi5 =~ 1*sisoet5
  wsi7 =~ 1*sisoet7
  wsi10 =~ 1*sisoet10
  wsi12 =~ 1*sisoet12
  
 # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a,a,a)*wad5 + c(d,d,d)*wsi5
  wsi7 ~ c(c,c,c)*wad5 + c(b,b,b)*wsi5
  
  wad10 ~ c(a,a,a)*wad7 + c(d,d,d)*wsi7
  wsi10 ~ c(c,c,c)*wad7 + c(b,b,b)*wsi7
  
  wad12 ~ c(a,a,a)*wad10 + c(d,d,d)*wsi10
  wsi12 ~ c(c,c,c)*wad10 + c(b,b,b)*wsi10 

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMt_inat.ses.lag.c grouped by ses}
RICLPMt_inat.ses.lag.c.fit <- lavaan(RICLPMt_inat.ses.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPMt_inat.ses and RICLPMt_inat.ses2}
lavTestLRT(RICLPMt_inat.lag.c.fit, RICLPMt_inat.ses.lag.c.fit, method = "satorra.bentler.2010")
```

For robust statistics:
The chi-square difference test of these two nested models is **non significant** (p=0.5639). 

For non-robust statistics:
The chi-square difference test of these two nested models is **significant** (p=0.02542), which implies that the lagged effects appear to be the **different for different levels of SES** 

SES differences found:
- No significant cross lag associations for different levels of SES.
- Significant autoregressive cross-lags for low SES only. 

*Can conclude here that there are no SES differences in inattention cross-lags*

***

# Three variable longitudinal mediation - stratified by SES

All models using total combined ADHD symptoms and cross-lags are constrained to be equal across time. 

## Prosocial behaviours 

### Constrained full cross-lag RI-CLPM mediation model 

Cross-lagged paths are constrained to be equal across time, but freely estimated across SES groups. Autoregressive paths are freely estimated across time and SES groups. 

```{r ri.med.long.pro.c}
ri.med.long.pro.c <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhde5 + 1*tadhde7 + 1*tadhde10 + 1*tadhde12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIpro =~ 1*proe5 + 1*proe7 + 1*proe10  + 1*proe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*tadhde5
                  wad7 =~ 1*tadhde7
                  wad10 =~ 1*tadhde10
                  wad12 =~ 1*tadhde12
                  ## Prosocial 
                  wpro5 =~ 1*proe5
                  wpro7 =~ 1*proe7
                  wpro10 =~ 1*proe10
                  wpro12 =~ 1*proe12
                  
                  ###### Autoregressive lags ###### 
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## Pro social bahviour
                  wpro7 ~ wpro5
                  wpro10 ~ wpro7
                  wpro12 ~ wpro10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ c(e1,e2,e3)*wsi5
                  wad10 ~ c(e1,e2,e3)*wsi7
                  wad12 ~ c(e1,e2,e3)*wsi10
                  ## ADHD
                  wsi7 ~ c(f1,f2,f3)*wad5
                  wsi10 ~ c(f1,f2,f3)*wad7
                  wsi12 ~ c(f1,f2,f3)*wad10
                  ## Prosocial
                  wsi7 ~ c(b1,b2,b3)*wpro5
                  wad7 ~ c(d1,d2,d3)*wpro5
                  wpro12 ~ c(c1,c2,c3)*wsi10
                  wpro12 ~ c(a1,a2,a3)*wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro7 ~ c(a1,a2,a3)*wad5 
                  wsi10 ~ c(b1,b2,b3)*wpro7
                  wpro10 ~ c(a1,a2,a3)*wad7 
                  wsi12 ~ c(b1,b2,b3)*wpro10
                  ## Isolation to ADHD
                  wpro7 ~ c(c1,c2,c3)*wsi5
                  wad10 ~ c(d1,d2,d3)*wpro7
                  wpro10 ~ c(c1,c2,c3)*wsi7
                  wad12 ~ c(d1,d2,d3)*wpro10
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wpro7
                  wpro7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wpro10
                  wpro10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wpro7 ~~ wpro7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wpro10 ~~ wpro10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro

                  ###### Indirect effect (a*b) ######
                  indirect1mid := a1*b1
                  indirect1low := a2*b2
                  indirect1high := a3*b3
                  indirect2mid := c1*d1
                  indirect2low := c2*d2
                  indirect2high := c3*d3
         '
```

```{r fit ri.med.long.pro}
ri.med.long.pro.c.fit <- lavaan(model = ri.med.long.pro.c, 
                        data = dat,
                        missing = 'ML',
                        group = "SES",
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long.pro.c.fit.summary <- summary(ri.med.long.pro.c.fit, standardized = TRUE, fit.measures = TRUE)
```
  
### Constrained full cross-lag RI-CLPM mediation model - SES constraints

Autoregressive paths are constrained to be equal across groups of SES but freed across time. 

Cross lags are constrained to be equal across groups AND across time. 
  
```{r ri.med.long.pro.c.ses}
ri.med.long.pro.c.ses <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhde5 + 1*tadhde7 + 1*tadhde10 + 1*tadhde12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIpro =~ 1*proe5 + 1*proe7 + 1*proe10  + 1*proe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*tadhde5
                  wad7 =~ 1*tadhde7
                  wad10 =~ 1*tadhde10
                  wad12 =~ 1*tadhde12
                  ## Prosocial 
                  wpro5 =~ 1*proe5
                  wpro7 =~ 1*proe7
                  wpro10 =~ 1*proe10
                  wpro12 =~ 1*proe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ c(g1,g1,g1)*wsi5
                  wsi10 ~ c(g2,g2,g2)*wsi7
                  wsi12 ~ c(g3,g3,g3)*wsi10
                  ## Pro social behaviour
                  wpro7 ~ c(h1,h1,h1)*wpro5
                  wpro10 ~ c(h2,h2,h2)*wpro7
                  wpro12 ~ c(h3,h3,h3)*wpro10
                  ## ADHD
                  wad7 ~ c(i1,i1,i1)*wad5
                  wad10 ~ c(i2,i2,i2)*wad7
                  wad12 ~ c(i3,i3,i3)*wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ c(e,e,e)*wsi5
                  wad10 ~ c(e,e,e)*wsi7
                  wad12 ~ c(e,e,e)*wsi10
                  ## ADHD
                  wsi7 ~ c(f,f,f)*wad5
                  wsi10 ~ c(f,f,f)*wad7
                  wsi12 ~ c(f,f,f)*wad10
                  ## Prosocial
                  wsi7 ~ c(b,b,b)*wpro5
                  wad7 ~ c(d,d,d)*wpro5
                  wpro12 ~ c(c,c,c)*wsi10
                  wpro12 ~ c(a,a,a)*wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wpro7 ~ c(a,a,a)*wad5 
                  wsi10 ~ c(b,b,b)*wpro7
                  wpro10 ~ c(a,a,a)*wad7 
                  wsi12 ~ c(b,b,b)*wpro10
                  ## Isolation to ADHD
                  wpro7 ~ c(c,c,c)*wsi5
                  wad10 ~ c(d,d,d)*wpro7
                  wpro10 ~ c(c,c,c)*wsi7
                  wad12 ~ c(d,d,d)*wpro10
                  
                  ###### Covariances ######
                  wsi5 ~~ wpro5
                  wpro5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wpro7
                  wpro7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wpro10
                  wpro10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wpro12
                  wpro12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wpro5 ~~ wpro5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wpro7 ~~ wpro7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wpro10 ~~ wpro10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wpro12 ~~ wpro12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIpro ~~ RIpro
                  RIad ~~ RIsi
                  RIad ~~ RIpro
                  RIsi ~~ RIpro
         '
```
  
```{r fit ri.med.long.pro.c grouped by ses}
ri.med.long.pro.c.ses.fit <- lavaan(ri.med.long.pro.c.ses, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

ri.med.long.pro.c.ses.fit.summary <- summary(ri.med.long.pro.c.ses.fit, standardized = TRUE, fit.measures = TRUE)
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for ri.med.long.pro.c.fit and ri.med.long.pro.c.ses.fit}
lavTestLRT(ri.med.long.pro.c.fit, ri.med.long.pro.c.ses.fit, method = "satorra.bentler.2010")
```

## Antisocial behaviours 

### Constrained full cross-lag RI-CLPM mediation model 

Cross-lagged paths are constrained to be equal across time, but freely estimated across SES groups. Autoregressive paths are freely estimated across time and SES groups. 

```{r ri.med.long.asb.c}
ri.med.long.asb.c <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhde5 + 1*tadhde7 + 1*tadhde10 + 1*tadhde12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIasb =~ 1*asbe5 + 1*asbe7 + 1*asbe10  + 1*asbe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*tadhde5
                  wad7 =~ 1*tadhde7
                  wad10 =~ 1*tadhde10
                  wad12 =~ 1*tadhde12
                  ## antisocial 
                  wasb5 =~ 1*asbe5
                  wasb7 =~ 1*asbe7
                  wasb10 =~ 1*asbe10
                  wasb12 =~ 1*asbe12
                  
                  ###### Autoregressive lags ###### 
                  ## Isolation
                  wsi7 ~ wsi5
                  wsi10 ~ wsi7
                  wsi12 ~ wsi10
                  ## antisocial bahviour
                  wasb7 ~ wasb5
                  wasb10 ~ wasb7
                  wasb12 ~ wasb10
                  ## ADHD
                  wad7 ~ wad5
                  wad10 ~ wad7
                  wad12 ~ wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ c(e1,e2,e3)*wsi5
                  wad10 ~ c(e1,e2,e3)*wsi7
                  wad12 ~ c(e1,e2,e3)*wsi10
                  ## ADHD
                  wsi7 ~ c(f1,f2,f3)*wad5
                  wsi10 ~ c(f1,f2,f3)*wad7
                  wsi12 ~ c(f1,f2,f3)*wad10
                  ## antisocial
                  wsi7 ~ c(b1,b2,b3)*wasb5
                  wad7 ~ c(d1,d2,d3)*wasb5
                  wasb12 ~ c(c1,c2,c3)*wsi10
                  wasb12 ~ c(a1,a2,a3)*wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb7 ~ c(a1,a2,a3)*wad5 
                  wsi10 ~ c(b1,b2,b3)*wasb7
                  wasb10 ~ c(a1,a2,a3)*wad7 
                  wsi12 ~ c(b1,b2,b3)*wasb10
                  ## Isolation to ADHD
                  wasb7 ~ c(c1,c2,c3)*wsi5
                  wad10 ~ c(d1,d2,d3)*wasb7
                  wasb10 ~ c(c1,c2,c3)*wsi7
                  wad12 ~ c(d1,d2,d3)*wasb10
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wasb7
                  wasb7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wasb10
                  wasb10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wasb7 ~~ wasb7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wasb10 ~~ wasb10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb

                  ###### Indirect effect (a*b) ######
                  indirect1mid := a1*b1
                  indirect1low := a2*b2
                  indirect1high := a3*b3
                  indirect2mid := c1*d1
                  indirect2low := c2*d2
                  indirect2high := c3*d3
         '
```

```{r fit ri.med.long.asb}
ri.med.long.asb.c.fit <- lavaan(model = ri.med.long.asb.c, 
                        data = dat,
                        missing = 'ML',
                        group = "SES",
                        meanstructure = TRUE, 
                        int.ov.free = TRUE,   
                        estimator = "MLR")

ri.med.long.asb.c.fit.summary <- summary(ri.med.long.asb.c.fit, standardized = TRUE, fit.measures = TRUE)
```
  
### Constrained full cross-lag RI-CLPM mediation model - SES constraints

Autoregressive paths are constrained to be equal across groups of SES but freed across time. 

Cross lags are constrained to be equal across groups AND across time. 
  
```{r ri.med.long.asb.c.ses}
ri.med.long.asb.c.ses <- ' 
                  ###### Create random intercepts ###### 
                  RIad =~ 1*tadhde5 + 1*tadhde7 + 1*tadhde10 + 1*tadhde12 
                  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 
                  RIasb =~ 1*asbe5 + 1*asbe7 + 1*asbe10  + 1*asbe12
                
                  ###### Create within-person variables ######
                  ## Isolation
                  wsi5 =~ 1*sisoe5
                  wsi7 =~ 1*sisoe7
                  wsi10 =~ 1*sisoe10
                  wsi12 =~ 1*sisoe12
                  ## ADHD
                  wad5 =~ 1*tadhde5
                  wad7 =~ 1*tadhde7
                  wad10 =~ 1*tadhde10
                  wad12 =~ 1*tadhde12
                  ## antisocial 
                  wasb5 =~ 1*asbe5
                  wasb7 =~ 1*asbe7
                  wasb10 =~ 1*asbe10
                  wasb12 =~ 1*asbe12
                  
                  ###### Autoregressive lags ######
                  ## Isolation
                  wsi7 ~ c(g1,g1,g1)*wsi5
                  wsi10 ~ c(g2,g2,g2)*wsi7
                  wsi12 ~ c(g3,g3,g3)*wsi10
                  ## antisocial behaviour
                  wasb7 ~ c(h1,h1,h1)*wasb5
                  wasb10 ~ c(h2,h2,h2)*wasb7
                  wasb12 ~ c(h3,h3,h3)*wasb10
                  ## ADHD
                  wad7 ~ c(i1,i1,i1)*wad5
                  wad10 ~ c(i2,i2,i2)*wad7
                  wad12 ~ c(i3,i3,i3)*wad10
                  
                  ###### Cross lag paths ######
                  ## Isolation
                  wad7 ~ c(e,e,e)*wsi5
                  wad10 ~ c(e,e,e)*wsi7
                  wad12 ~ c(e,e,e)*wsi10
                  ## ADHD
                  wsi7 ~ c(f,f,f)*wad5
                  wsi10 ~ c(f,f,f)*wad7
                  wsi12 ~ c(f,f,f)*wad10
                  ## antisocial
                  wsi7 ~ c(b,b,b)*wasb5
                  wad7 ~ c(d,d,d)*wasb5
                  wasb12 ~ c(c,c,c)*wsi10
                  wasb12 ~ c(a,a,a)*wad10
                  
                  ###### Mediation paths ######
                  ## ADHD to Isolation
                  wasb7 ~ c(a,a,a)*wad5 
                  wsi10 ~ c(b,b,b)*wasb7
                  wasb10 ~ c(a,a,a)*wad7 
                  wsi12 ~ c(b,b,b)*wasb10
                  ## Isolation to ADHD
                  wasb7 ~ c(c,c,c)*wsi5
                  wad10 ~ c(d,d,d)*wasb7
                  wasb10 ~ c(c,c,c)*wsi7
                  wad12 ~ c(d,d,d)*wasb10
                  
                  ###### Covariances ######
                  wsi5 ~~ wasb5
                  wasb5 ~~ wad5
                  wsi5 ~~ wad5
                  wsi7 ~~ wasb7
                  wasb7 ~~ wad7
                  wsi7 ~~ wad7
                  wsi10 ~~ wasb10
                  wasb10 ~~ wad10
                  wsi10 ~~ wad10
                  wsi12 ~~ wasb12
                  wasb12 ~~ wad12
                  wsi12 ~~ wad12
                    
                  ###### Variances ######
                  ## Variances
                  wad5 ~~ wad5 
                  wsi5 ~~ wsi5 
                  wasb5 ~~ wasb5
                  ## Residual variances
                  wad7 ~~ wad7 
                  wsi7 ~~ wsi7 
                  wasb7 ~~ wasb7
                  wad10 ~~ wad10 
                  wsi10 ~~ wsi10 
                  wasb10 ~~ wasb10
                  wad12 ~~ wad12 
                  wsi12 ~~ wsi12
                  wasb12 ~~ wasb12
                  
                  ###### Variance and covariance of random intercepts ######
                  RIad ~~ RIad
                  RIsi ~~ RIsi
                  RIasb ~~ RIasb
                  RIad ~~ RIsi
                  RIad ~~ RIasb
                  RIsi ~~ RIasb
         '
```
  
```{r fit ri.med.long.asb.c grouped by ses}
ri.med.long.asb.c.ses.fit <- lavaan(ri.med.long.asb.c.ses, 
                      data = dat, 
                      missing = 'ML', 
                      group = "SES",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

ri.med.long.asb.c.ses.fit.summary <- summary(ri.med.long.asb.c.ses.fit, standardized = TRUE, fit.measures = TRUE)
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for ri.med.long.asb.c.fit and ri.med.long.asb.c.ses.fit}
lavTestLRT(ri.med.long.asb.c.fit, ri.med.long.asb.c.ses.fit, method = "satorra.bentler.2010")
```

