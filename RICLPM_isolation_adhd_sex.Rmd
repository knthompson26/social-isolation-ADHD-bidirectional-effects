---
title: "Sex differences in RI-CLPM for social isolation and ADHD symptoms in childhood"
output:  
  html_document:
    df_print: paged
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: false
    number_sections: false
    highlight: monochrome
    theme: flatly
    code_folding: hide
    includes:
      after_body: footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment = NA,
                      prompt = FALSE,
                      cache = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      results = 'asis')

options(bitmapType = 'quartz') # to render fonts better
```

```{r Clear global environment, include=FALSE}
remove(list = ls())
```

```{r Load packages, include=FALSE}
library(knitr)
library(haven)
library(lavaan)
library(tidyverse)
library(dplyr) #conflicts with tidyverse for e.g. rename and row_number
```

```{r source the data file path, include=FALSE}
#source raw data directory: data_raw and data included
source("../isolation_ADHD_data_path.R")
```

```{r read in dta data file}
dat.raw <- read_dta(paste0(data.raw_path, "Katie_19Jan22.dta"))

dat <- dat.raw %>%
  dplyr::select(id = atwinid,
         sampsex,
         seswq35,
         sisoem5,  # social isolation mother report
         sisoem7,
         sisoem10,
         sisoem12,
         sisoet5,  # social isolation teacher report
         sisoet7, 
         sisoet10,
         sisoet12,
         sisoe5,  # social isolation combined report
         sisoe7, 
         sisoe10,
         sisoe12,
         tadhdem5,  # total ADHD mother report
         tadhdem7,
         tadhdem10,
         tadhdem12,
         tadhdet5,  # total ADHD teacher report
         tadhdet7,
         tadhdet10,
         tadhdet12,
         hyem5,     # hyperactivity ADHD mother report
         hyem7,
         hyem10,
         hyem12, 
         hyet5,     # hyperactivity ADHD teacher report
         hyet7,
         hyet10,
         hyet12,
         inem5,    # inattention ADHD mother report
         inem7,
         inem10,
         inem12,
         inet5,    # inattention ADHD teacher report
         inet7,
         inet10,
         inet12
  )

colnames(dat)
```

Functions

```{r functions}
# Table of model fit 
table.model.fit <- function(model){
  model.fit <- as.data.frame(t(as.data.frame(model$FIT))) %>%
    dplyr::select(chisq, df, chisq.scaled, cfi.robust, tli.robust, aic, bic, bic2, rmsea.robust, rmsea.ci.lower.robust, rmsea.ci.upper.robust, srmr) #can only be used with "MLR" estimator
  return(model.fit)
}

# Table of regression and correlation (standardised covariance) coefficients
table.model.coef <- function(model, sex, constraints){
  if (sex == "Male" & constraints == "No"){
    model.coef <- as.tibble(model$PE[c(86:101),]) %>% dplyr::select(-block, -group, -exo, -std.lv, -std.nox)
    return(model.coef)
  } else if(sex == "Female" & constraints == "No"){
    model.coef <- as.tibble(model$PE[c(17:32),]) %>% dplyr::select(-block, -group, -exo, -std.lv, -std.nox)
    return(model.coef)
  } else if(sex == "Male" & constraints == "Yes"){
    model.coef <- as.tibble(model$PE[c(86:101),]) %>% dplyr::select(-block, -group, -exo, -label, -std.lv, -std.nox)
    return(model.coef)
  } else if(sex == "Female" & constraints == "Yes"){
    model.coef <- as.tibble(model$PE[c(17:32),]) %>% dplyr::select(-block, -group, -exo, -label, -std.lv, -std.nox)
    return(model.coef)
  } else {model.coef <- NULL}
}
```

To check for group differences in parameter estimates between girls and boys (sex), we can run the same model but test group differences in the lavaan command.

```{r recode sex variable}
dat <- dat %>%
  mutate(
    sex = 
      recode_factor(as_factor(sampsex),
        "1" = "Male",
        "2" = "Female"))

table(dat$sex)
```

***

# Create combined ADHD variables

```{r create combined total adhd variables}
# age 5
dat <- dat %>%
  mutate(tadhde5 = 
           case_when(
             is.na(tadhdem5) & is.na(tadhdet5) ~ NA_real_,
             is.na(tadhdem5) & !is.na(tadhdet5) ~ as.numeric(tadhdet5),
             is.na(tadhdet5) & !is.na(tadhdem5) ~ as.numeric(tadhdem5),
             !is.na(tadhdem5) & !is.na(tadhdet5) ~ as.numeric(rowMeans(across(.cols = c(tadhdem5,tadhdet5)))))
  )
# age 7
dat <- dat %>%
  mutate(tadhde7 = 
           case_when(
             is.na(tadhdem7) & is.na(tadhdet7) ~ NA_real_,
             is.na(tadhdem7) & !is.na(tadhdet7) ~ as.numeric(tadhdet7),
             is.na(tadhdet7) & !is.na(tadhdem7) ~ as.numeric(tadhdem7),
             !is.na(tadhdem7) & !is.na(tadhdet7) ~ as.numeric(rowMeans(across(.cols = c(tadhdem7,tadhdet7)))))
  )
# age 10
dat <- dat %>%
  mutate(tadhde10 = 
           case_when(
             is.na(tadhdem10) & is.na(tadhdet10) ~ NA_real_,
             is.na(tadhdem10) & !is.na(tadhdet10) ~ as.numeric(tadhdet10),
             is.na(tadhdet10) & !is.na(tadhdem10) ~ as.numeric(tadhdem10),
             !is.na(tadhdem10) & !is.na(tadhdet10) ~ as.numeric(rowMeans(across(.cols = c(tadhdem10,tadhdet10)))))
  )
# age 12
dat <- dat %>%
  mutate(tadhde12 = 
           case_when(
             is.na(tadhdem12) & is.na(tadhdet12) ~ NA_real_,
             is.na(tadhdem12) & !is.na(tadhdet12) ~ as.numeric(tadhdet12),
             is.na(tadhdet12) & !is.na(tadhdem12) ~ as.numeric(tadhdem12),
             !is.na(tadhdem12) & !is.na(tadhdet12) ~ as.numeric(rowMeans(across(.cols = c(tadhdem12,tadhdet12)))))
  )
```

```{r create combined hyperactivity adhd variables}
# age 5
dat <- dat %>%
  mutate(hye5 = 
           case_when(
             is.na(hyem5) & is.na(hyet5) ~ NA_real_,
             is.na(hyem5) & !is.na(hyet5) ~ as.numeric(hyet5),
             is.na(hyet5) & !is.na(hyem5) ~ as.numeric(hyem5),
             !is.na(hyem5) & !is.na(hyet5) ~ as.numeric(rowMeans(across(.cols = c(hyem5,hyet5)))))
  )
# age 7
dat <- dat %>%
  mutate(hye7 = 
           case_when(
             is.na(hyem7) & is.na(hyet7) ~ NA_real_,
             is.na(hyem7) & !is.na(hyet7) ~ as.numeric(hyet7),
             is.na(hyet7) & !is.na(hyem7) ~ as.numeric(hyem7),
             !is.na(hyem7) & !is.na(hyet7) ~ as.numeric(rowMeans(across(.cols = c(hyem7,hyet7)))))
  )
# age 10
dat <- dat %>%
  mutate(hye10 = 
           case_when(
             is.na(hyem10) & is.na(hyet10) ~ NA_real_,
             is.na(hyem10) & !is.na(hyet10) ~ as.numeric(hyet10),
             is.na(hyet10) & !is.na(hyem10) ~ as.numeric(hyem10),
             !is.na(hyem10) & !is.na(hyet10) ~ as.numeric(rowMeans(across(.cols = c(hyem10,hyet10)))))
  )
# age 12
dat <- dat %>%
  mutate(hye12 = 
           case_when(
             is.na(hyem12) & is.na(hyet12) ~ NA_real_,
             is.na(hyem12) & !is.na(hyet12) ~ as.numeric(hyet12),
             is.na(hyet12) & !is.na(hyem12) ~ as.numeric(hyem12),
             !is.na(hyem12) & !is.na(hyet12) ~ as.numeric(rowMeans(across(.cols = c(hyem12,hyet12)))))
  )
```

```{r create combined inattention adhd variables}
# age 5
dat <- dat %>%
  mutate(ine5 = 
           case_when(
             is.na(inem5) & is.na(inet5) ~ NA_real_,
             is.na(inem5) & !is.na(inet5) ~ as.numeric(inet5),
             is.na(inet5) & !is.na(inem5) ~ as.numeric(inem5),
             !is.na(inem5) & !is.na(inet5) ~ as.numeric(rowMeans(across(.cols = c(inem5,inet5)))))
  )
# age 7
dat <- dat %>%
  mutate(ine7 = 
           case_when(
             is.na(inem7) & is.na(inet7) ~ NA_real_,
             is.na(inem7) & !is.na(inet7) ~ as.numeric(inet7),
             is.na(inet7) & !is.na(inem7) ~ as.numeric(inem7),
             !is.na(inem7) & !is.na(inet7) ~ as.numeric(rowMeans(across(.cols = c(inem7,inet7)))))
  )
# age 10
dat <- dat %>%
  mutate(ine10 = 
           case_when(
             is.na(inem10) & is.na(inet10) ~ NA_real_,
             is.na(inem10) & !is.na(inet10) ~ as.numeric(inet10),
             is.na(inet10) & !is.na(inem10) ~ as.numeric(inem10),
             !is.na(inem10) & !is.na(inet10) ~ as.numeric(rowMeans(across(.cols = c(inem10,inet10)))))
  )
# age 12
dat <- dat %>%
  mutate(ine12 = 
           case_when(
             is.na(inem12) & is.na(inet12) ~ NA_real_,
             is.na(inem12) & !is.na(inet12) ~ as.numeric(inet12),
             is.na(inet12) & !is.na(inem12) ~ as.numeric(inem12),
             !is.na(inem12) & !is.na(inet12) ~ as.numeric(rowMeans(across(.cols = c(inem12,inet12)))))
  )
```

***

# Constrained models 

In the script "RICLPM_isolation_adhd.Rmd" and "RICLPMcomb_isolation_adhd.Rmd", we decided that combined and mother report models will be constrained to have equal cross lags onlly, and teacher report models will be constrained to have equal autoregressive and crosslags. 

Here, we will apply sex difference testing to each of these reporter models. 

All models are using robust test statistics and standard errors. 

|  Model                                         | Sex differences      
| ---------------------------------------------- | --------------------------------- |
|   Combined report, total ADHD symptoms         |  No significant sex differences   |
|   Combined report, hyperactivity ADHD symptoms |  No significant sex differences   |
|   Combined report, inattention ADHD symptoms   |  No significant sex differences   |
|   Mother report, total ADHD symptoms           |  No significant sex differences   |
|   Mother report, hyperactivity ADHD symptoms   |  No significant sex differences   |
|   Mother report, inattention ADHD symptoms     |  No significant sex differences   |
|   Teacher report, total ADHD symptoms          |  No significant sex differences   |
|   Teacher report, hyperactivity ADHD symptoms  |  No significant sex differences   |
|   Teacher report, inattention ADHD symptoms    |  No significant sex differences   |


Imposing constraints to the model can be achieved through **pre-multiplication**. It means that we have to prepend the number that we want to fix the parameter to, and an asterisk, to the parameter in the model specification. For example, `F =~ 0*x1` fixes the factor loading of item `x1` to factor `F` to 0. Using pre-multiplication we can also constrain parameters to be the same by giving them the same label. Below we specify an RI-CLPM with the following constraints: 

Naming: 
  a = lag in ad
  b = lag in si
  c = cross lag ad->si
  d = cross lag si->ad

  sex.c = sex differences in constrained model 
  lag.c = lag constrained model
  sex.lag.c = sex and lag constrained model

We will text for sex differences in two steps: 
  1) Estimate a model where constraints are applied across lags but not for each of the groups (female/male)
  2) Estimate a model where constraints are applied across both lags and the groups (female/male)

An example of the constraining: For lag c, I have constrained each lag to be set to c1 for females and c2 for males. They layout for group specification is c(group 1, group 2). This provides the same estimates across each lag, but that they differ for girls and boys. 

## Combined report

### Total ADHD 

```{r specify RICLPMcomb_lag.c, class.source = 'fold-show'}
RICLPMcomb.lag.c <- '
  # Create beween components (random intercepts treated as factors here)
  RIad =~ 1*tadhde5 + 1*tadhde7 + 1*tadhde10 + 1*tadhde12 #x
  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 #y

  # Create within-person centered variables
  wad5 =~ 1*tadhde5
  wad7 =~ 1*tadhde7
  wad10 =~ 1*tadhde10 
  wad12 =~ 1*tadhde12
  wsi5 =~ 1*sisoe5
  wsi7 =~ 1*sisoe7
  wsi10 =~ 1*sisoe10
  wsi12 =~ 1*sisoe12
  
  # Constrained lagged effects beween the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across lags (all lags constrained). We want to constrain c and d lags but free the autoregressive lags. Variables without notation are freely estimated across sexes.
  wad7 ~ wad5 + c(d1, d2)*wsi5 
  wsi7 ~ c(c1, c2)*wad5 + wsi5
  
  wad10 ~ wad7 + c(d1, d2)*wsi7
  wsi10 ~ c(c1,c2)*wad7 + wsi7
  
  wad12 ~ wad10 + c(d1,d2)*wsi10
  wsi12 ~ c(c1,c2)*wad10 + wsi10

  # Estimate the covariance beween the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances beween the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMcomb.lag.c grouped by sex}
RICLPMcomb.lag.c.fit <- lavaan(RICLPMcomb.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPMcomb.lag.c.fit.summary <- summary(RICLPMcomb.lag.c.fit,
                                          fit.measures = TRUE,
                                          standardized = TRUE)

#Table of model fit 
RICLPMcomb.lag.c.fit.summary.fit <- table.model.fit(RICLPMcomb.lag.c.fit.summary)
# Table of regression and correlation (standardised covariances) coefficients
RICLPMcomb.lag.c.fit.summary.reg.female <- table.model.coef(RICLPMcomb.lag.c.fit.summary, sex = "Female", constraints = "Yes")
RICLPMcomb.lag.c.fit.summary.reg.male <- table.model.coef(RICLPMcomb.lag.c.fit.summary, sex = "Male", constraints = "Yes")
```

```{r specify RICLPMcomb.sex.lag.c, class.source = 'fold-show'}
RICLPMcomb.sex.lag.c <- '
  # Create beween components (random intercepts treated as factors here)
  RIad =~ 1*tadhde5 + 1*tadhde7 + 1*tadhde10 + 1*tadhde12 #x
  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 #y

  # Create within-person centered variables
  wad5 =~ 1*tadhde5
  wad7 =~ 1*tadhde7
  wad10 =~ 1*tadhde10 
  wad12 =~ 1*tadhde12
  wsi5 =~ 1*sisoe5
  wsi7 =~ 1*sisoe7
  wsi10 =~ 1*sisoe10
  wsi12 =~ 1*sisoe12
  
  # Estimate the lagged effects beween the within-person centered variables. a and b parameters are constrained to be the same across the groups c(females, males), but are different across the lags. c and d parameters are the same across lag and group. 
  wad7 ~ c(a1, a1)*wad5 + c(d, d)*wsi5
  wsi7 ~ c(c, c)*wad5 + c(b1, b1)*wsi5
  
  wad10 ~ c(a2, a2)*wad7 + c(d, d)*wsi7
  wsi10 ~ c(c, c)*wad7 + c(b2, b2)*wsi7
  
  wad12 ~ c(a3, a3)*wad10 + c(d, d)*wsi10
  wsi12 ~ c(c, c)*wad10 + c(b3, b3)*wsi10 
  
  # Estimate the covariance beween the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances beween the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMcomb.sex.lag.c grouped by sex}
RICLPMcomb.sex.lag.c.fit <- lavaan(RICLPMcomb.sex.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameers are constrained to be equal across groups. 

```{r LRT for RICLPMcomb.lag.c.fit and RICLPMcomb.sex.lag.c.fit}
lavTestLRT(RICLPMcomb.lag.c.fit, RICLPMcomb.sex.lag.c.fit, mehod = "satorra.bentler.2010")
```

The chi-square difference test of these two nested models is *NON significant* (p=0.5628). **Therefore, we conclude there are no sex differences in the constrained RICLPM combined report, total ADHD symptoms.** 

### Hyperactivity symptoms 

```{r specify RICLPMcomb_hyp.lag.c, class.source = 'fold-show'}
RICLPMcomb_hyp.lag.c  <- '
  # Create beween components (random intercepts treated as factors here)
  RIad =~ 1*hye5 + 1*hye7 + 1*hye10 + 1*hye12 #x
  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 #y

  # Create within-person centered variables
  wad5 =~ 1*hye5
  wad7 =~ 1*hye7
  wad10 =~ 1*hye10 
  wad12 =~ 1*hye12
  wsi5 =~ 1*sisoe5
  wsi7 =~ 1*sisoe7
  wsi10 =~ 1*sisoe10
  wsi12 =~ 1*sisoe12
  
  # Constrained lagged effects beween the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across cross lags.
  wad7 ~ wad5 + c(d1, d2)*wsi5 
  wsi7 ~ c(c1, c2)*wad5 + wsi5
  
  wad10 ~ wad7 + c(d1, d2)*wsi7
  wsi10 ~ c(c1,c2)*wad7 + wsi7
  
  wad12 ~ wad10 + c(d1,d2)*wsi10
  wsi12 ~ c(c1,c2)*wad10 + wsi10
  
  # Estimate the covariance beween the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances beween the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMcomb_hyp.lag.c grouped by sex}
RICLPMcomb_hyp.lag.c.fit <- lavaan(RICLPMcomb_hyp.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPMcomb_hyp.lag.c.fit.summary <- summary(RICLPMcomb_hyp.lag.c.fit,
                                          fit.measures = TRUE,
                                          standardized = TRUE)

#Table of model fit 
RICLPMcomb_hyp.lag.c.fit.summary.fit <- table.model.fit(RICLPMcomb_hyp.lag.c.fit.summary)
# Table of regression and correlation (standardised covariances) coefficients
RICLPMcomb_hyp.lag.c.fit.summary.reg.female <- table.model.coef(RICLPMcomb_hyp.lag.c.fit.summary, sex = "Female", constraints = "Yes")
RICLPMcomb_hyp.lag.c.fit.summary.reg.male <- table.model.coef(RICLPMcomb_hyp.lag.c.fit.summary, sex = "Male", constraints = "Yes")
```

```{r specify RICLPMcomb_hyp.sex.lag.c, class.source = 'fold-show'}
RICLPMcomb_hyp.sex.lag.c  <- '
  # Create beween components (random intercepts treated as factors here)
  RIad =~ 1*hye5 + 1*hye7 + 1*hye10 + 1*hye12 #x
  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 #y

  # Create within-person centered variables
  wad5 =~ 1*hye5
  wad7 =~ 1*hye7
  wad10 =~ 1*hye10 
  wad12 =~ 1*hye12
  wsi5 =~ 1*sisoe5
  wsi7 =~ 1*sisoe7
  wsi10 =~ 1*sisoe10
  wsi12 =~ 1*sisoe12
  
  # Estimate the lagged effects beween the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects beween the within-person centered variables. 
  wad7 ~ c(a1, a1)*wad5 + c(d, d)*wsi5
  wsi7 ~ c(c, c)*wad5 + c(b1, b1)*wsi5
  
  wad10 ~ c(a2, a2)*wad7 + c(d, d)*wsi7
  wsi10 ~ c(c, c)*wad7 + c(b2, b2)*wsi7
  
  wad12 ~ c(a3, a3)*wad10 + c(d, d)*wsi10
  wsi12 ~ c(c, c)*wad10 + c(b3, b3)*wsi10 
  
  # Estimate the covariance beween the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances beween the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMcomb_hyp.sex.lag.c grouped by sex}
RICLPMcomb_hyp.sex.lag.c.fit <- lavaan(RICLPMcomb_hyp.sex.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameers are constrained to be equal across groups. 

```{r LRT for RICLPMcomb_hyp.lag.c.fit and RICLPMcomb_hyp.sex.lag.c.fit}
lavTestLRT(RICLPMcomb_hyp.lag.c.fit, RICLPMcomb_hyp.sex.lag.c.fit, mehod = "satorra.bentler.2010")
```

### Inattention 

```{r specify RICLPMcomb_inat.lag.c}
RICLPMcomb_inat.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*ine5 + 1*ine7 + 1*ine10 + 1*ine12 #x
  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 #y

  # Create within-person centered variables
  wad5 =~ 1*ine5
  wad7 =~ 1*ine7
  wad10 =~ 1*ine10 
  wad12 =~ 1*ine12
  wsi5 =~ 1*sisoe5
  wsi7 =~ 1*sisoe7
  wsi10 =~ 1*sisoe10
  wsi12 =~ 1*sisoe12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across lags. 
  wad7 ~ wad5 + c(d1, d2)*wsi5 
  wsi7 ~ c(c1, c2)*wad5 + wsi5
  
  wad10 ~ wad7 + c(d1, d2)*wsi7
  wsi10 ~ c(c1,c2)*wad7 + wsi7
  
  wad12 ~ wad10 + c(d1,d2)*wsi10
  wsi12 ~ c(c1,c2)*wad10 + wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMcomb_inat.lag.c.fit split by sex}
RICLPMcomb_inat.lag.c.fit <- lavaan(RICLPMcomb_inat.lag.c, 
                      data = dat, 
                      missing = 'ML',
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPMcomb_inat.lag.c.fit.summary <- summary(RICLPMcomb_inat.lag.c.fit,
                                          fit.measures = TRUE,
                                          standardized = TRUE)

#Table of model fit 
RICLPMcomb_inat.lag.c.fit.summary.fit <- table.model.fit(RICLPMcomb_inat.lag.c.fit.summary)
# Table of regression and correlation (standardised covariances) coefficients
RICLPMcomb_inat.lag.c.fit.summary.reg.female <- table.model.coef(RICLPMcomb_inat.lag.c.fit.summary, sex = "Female", constraints = "Yes")
RICLPMcomb_inat.lag.c.fit.summary.reg.male <- table.model.coef(RICLPMcomb_inat.lag.c.fit.summary, sex = "Male", constraints = "Yes")
```

```{r specify RICLPMcomb_inat.sex.lag.c, class.source = 'fold-show'}
RICLPMcomb_inat.sex.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*ine5 + 1*ine7 + 1*ine10 + 1*ine12 #x
  RIsi =~ 1*sisoe5 + 1*sisoe7 + 1*sisoe10 + 1*sisoe12 #y

  # Create within-person centered variables
  wad5 =~ 1*ine5
  wad7 =~ 1*ine7
  wad10 =~ 1*ine10 
  wad12 =~ 1*ine12
  wsi5 =~ 1*sisoe5
  wsi7 =~ 1*sisoe7
  wsi10 =~ 1*sisoe10
  wsi12 =~ 1*sisoe12
  
  # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a1, a1)*wad5 + c(d, d)*wsi5
  wsi7 ~ c(c, c)*wad5 + c(b1, b1)*wsi5
  
  wad10 ~ c(a2, a2)*wad7 + c(d, d)*wsi7
  wsi10 ~ c(c, c)*wad7 + c(b2, b2)*wsi7
  
  wad12 ~ c(a3, a3)*wad10 + c(d, d)*wsi10
  wsi12 ~ c(c, c)*wad10 + c(b3, b3)*wsi10 

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMcomb_inat.sex.lag.c.fit grouped by sex}
RICLPMcomb_inat.sex.lag.c.fit <- lavaan(RICLPMcomb_inat.sex.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPMcomb_inat_lag.c.fit and RICLPMcomb_inat.sex.lag.c.fit}
lavTestLRT(RICLPMcomb_inat.lag.c.fit, RICLPMcomb_inat.sex.lag.c.fit, method = "satorra.bentler.2010")
```

*non-significant* p = 0.8369. 

## Mother report

### Total ADHD 

```{r specify RICLPM_lag.c, class.source = 'fold-show'}
RICLPM.lag.c <- '
  # Create beween components (random intercepts treated as factors here)
  RIad =~ 1*tadhdem5 + 1*tadhdem7 + 1*tadhdem10 + 1*tadhdem12 #x
  RIsi =~ 1*sisoem5 + 1*sisoem7 + 1*sisoem10 + 1*sisoem12 #y

  # Create within-person centered variables
  wad5 =~ 1*tadhdem5
  wad7 =~ 1*tadhdem7
  wad10 =~ 1*tadhdem10 
  wad12 =~ 1*tadhdem12
  wsi5 =~ 1*sisoem5
  wsi7 =~ 1*sisoem7
  wsi10 =~ 1*sisoem10
  wsi12 =~ 1*sisoem12
  
  # Constrained lagged effects beween the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across lags (all lags constrained). We want to constrain c and d lags but free the autoregressive lags. Variables without notation are freely estimated across sexes.
  wad7 ~ wad5 + c(d1, d2)*wsi5 
  wsi7 ~ c(c1, c2)*wad5 + wsi5
  
  wad10 ~ wad7 + c(d1, d2)*wsi7
  wsi10 ~ c(c1,c2)*wad7 + wsi7
  
  wad12 ~ wad10 + c(d1,d2)*wsi10
  wsi12 ~ c(c1,c2)*wad10 + wsi10

  # Estimate the covariance beween the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances beween the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPM.lag.c grouped by sex}
RICLPM.lag.c.fit <- lavaan(RICLPM.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

```{r specify RICLPM.sex.lag.c, class.source = 'fold-show'}
RICLPM.sex.lag.c <- '
  # Create beween components (random intercepts treated as factors here)
  RIad =~ 1*tadhdem5 + 1*tadhdem7 + 1*tadhdem10 + 1*tadhdem12 #x
  RIsi =~ 1*sisoem5 + 1*sisoem7 + 1*sisoem10 + 1*sisoem12 #y

  # Create within-person centered variables
  wad5 =~ 1*tadhdem5
  wad7 =~ 1*tadhdem7
  wad10 =~ 1*tadhdem10 
  wad12 =~ 1*tadhdem12
  wsi5 =~ 1*sisoem5
  wsi7 =~ 1*sisoem7
  wsi10 =~ 1*sisoem10
  wsi12 =~ 1*sisoem12
  
  # Estimate the lagged effects beween the within-person centered variables. a and b parameters are constrained to be the same across the groups c(females, males), but are different across the lags. c and d parameters are the same across lag and group. 
  wad7 ~ c(a1, a1)*wad5 + c(d, d)*wsi5
  wsi7 ~ c(c, c)*wad5 + c(b1, b1)*wsi5
  
  wad10 ~ c(a2, a2)*wad7 + c(d, d)*wsi7
  wsi10 ~ c(c, c)*wad7 + c(b2, b2)*wsi7
  
  wad12 ~ c(a3, a3)*wad10 + c(d, d)*wsi10
  wsi12 ~ c(c, c)*wad10 + c(b3, b3)*wsi10 
  
  # Estimate the covariance beween the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances beween the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPM.sex.lag.c grouped by sex}
RICLPM.sex.lag.c.fit <- lavaan(RICLPM.sex.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameers are constrained to be equal across groups. 

```{r LRT for RICLPM.lag.c.fit and RICLPM.sex.lag.c.fit}
lavTestLRT(RICLPM.lag.c.fit, RICLPM.sex.lag.c.fit, mehod = "satorra.bentler.2010")
```

The chi-square difference test of these two nested models is *NON significant* (p=0.6957). **Therefore, we conclude there are no sex differences in the constrained RICLPM combined report, total ADHD symptoms.** 

### Hyperactivity symptoms 

```{r specify RICLPM_hyp.lag.c, class.source = 'fold-show'}
RICLPM_hyp.lag.c  <- '
  # Create beween components (random intercepts treated as factors here)
  RIad =~ 1*hyem5 + 1*hyem7 + 1*hyem10 + 1*hyem12 #x
  RIsi =~ 1*sisoem5 + 1*sisoem7 + 1*sisoem10 + 1*sisoem12 #y

  # Create within-person centered variables
  wad5 =~ 1*hyem5
  wad7 =~ 1*hyem7
  wad10 =~ 1*hyem10 
  wad12 =~ 1*hyem12
  wsi5 =~ 1*sisoem5
  wsi7 =~ 1*sisoem7
  wsi10 =~ 1*sisoem10
  wsi12 =~ 1*sisoem12
  
  # Constrained lagged effects beween the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across cross lags.
  wad7 ~ wad5 + c(d1, d2)*wsi5 
  wsi7 ~ c(c1, c2)*wad5 + wsi5
  
  wad10 ~ wad7 + c(d1, d2)*wsi7
  wsi10 ~ c(c1,c2)*wad7 + wsi7
  
  wad12 ~ wad10 + c(d1,d2)*wsi10
  wsi12 ~ c(c1,c2)*wad10 + wsi10
  
  # Estimate the covariance beween the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances beween the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPM_hyp.lag.c grouped by sex}
RICLPM_hyp.lag.c.fit <- lavaan(RICLPM_hyp.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPM_hyp.lag.c.fit.summary <- summary(RICLPM_hyp.lag.c.fit,
                                          fit.measures = TRUE,
                                          standardized = TRUE)

#Table of model fit 
RICLPM_hyp.lag.c.fit.summary.fit <- table.model.fit(RICLPM_hyp.lag.c.fit.summary)
# Table of regression and correlation (standardised covariances) coefficients
RICLPM_hyp.lag.c.fit.summary.reg.female <- table.model.coef(RICLPM_hyp.lag.c.fit.summary, sex = "Female", constraints = "Yes")
RICLPM_hyp.lag.c.fit.summary.reg.male <- table.model.coef(RICLPM_hyp.lag.c.fit.summary, sex = "Male", constraints = "Yes")
```

```{r specify RICLPM_hyp.sex.lag.c, class.source = 'fold-show'}
RICLPM_hyp.sex.lag.c  <- '
  # Create beween components (random intercepts treated as factors here)
  RIad =~ 1*hyem5 + 1*hyem7 + 1*hyem10 + 1*hyem12 #x
  RIsi =~ 1*sisoem5 + 1*sisoem7 + 1*sisoem10 + 1*sisoem12 #y

  # Create within-person centered variables
  wad5 =~ 1*hyem5
  wad7 =~ 1*hyem7
  wad10 =~ 1*hyem10 
  wad12 =~ 1*hyem12
  wsi5 =~ 1*sisoem5
  wsi7 =~ 1*sisoem7
  wsi10 =~ 1*sisoem10
  wsi12 =~ 1*sisoem12
  
  # Estimate the lagged effects beween the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects beween the within-person centered variables. 
  wad7 ~ c(a1, a1)*wad5 + c(d, d)*wsi5
  wsi7 ~ c(c, c)*wad5 + c(b1, b1)*wsi5
  
  wad10 ~ c(a2, a2)*wad7 + c(d, d)*wsi7
  wsi10 ~ c(c, c)*wad7 + c(b2, b2)*wsi7
  
  wad12 ~ c(a3, a3)*wad10 + c(d, d)*wsi10
  wsi12 ~ c(c, c)*wad10 + c(b3, b3)*wsi10 
  
  # Estimate the covariance beween the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances beween the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPM_hyp.sex.lag.c grouped by sex}
RICLPM_hyp.sex.lag.c.fit <- lavaan(RICLPM_hyp.sex.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameers are constrained to be equal across groups. 

```{r LRT for RICLPM_hyp.lag.c.fit and RICLPM_hyp.sex.lag.c.fit}
lavTestLRT(RICLPM_hyp.lag.c.fit, RICLPM_hyp.sex.lag.c.fit, mehod = "satorra.bentler.2010")
```

*Non-significant* p = 0.9554. 

### Inattention  

```{r specify RICLPM_inat.lag.c}
RICLPM_inat.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*inem5 + 1*inem7 + 1*inem10 + 1*inem12 #x
  RIsi =~ 1*sisoem5 + 1*sisoem7 + 1*sisoem10 + 1*sisoem12 #y

  # Create within-person centered variables
  wad5 =~ 1*inem5
  wad7 =~ 1*inem7
  wad10 =~ 1*inem10 
  wad12 =~ 1*inem12
  wsi5 =~ 1*sisoem5
  wsi7 =~ 1*sisoem7
  wsi10 =~ 1*sisoem10
  wsi12 =~ 1*sisoem12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across lags. 
  wad7 ~ wad5 + c(d1, d2)*wsi5 
  wsi7 ~ c(c1, c2)*wad5 + wsi5
  
  wad10 ~ wad7 + c(d1, d2)*wsi7
  wsi10 ~ c(c1,c2)*wad7 + wsi7
  
  wad12 ~ wad10 + c(d1,d2)*wsi10
  wsi12 ~ c(c1,c2)*wad10 + wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPM_inat.lag.c.fit split by sex}
RICLPM_inat.lag.c.fit <- lavaan(RICLPM_inat.lag.c, 
                      data = dat, 
                      missing = 'ML',
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

```{r specify RICLPM_inat.sex.lag.c, class.source = 'fold-show'}
RICLPM_inat.sex.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*inem5 + 1*inem7 + 1*inem10 + 1*inem12 #x
  RIsi =~ 1*sisoem5 + 1*sisoem7 + 1*sisoem10 + 1*sisoem12 #y

  # Create within-person centered variables
  wad5 =~ 1*inem5
  wad7 =~ 1*inem7
  wad10 =~ 1*inem10 
  wad12 =~ 1*inem12
  wsi5 =~ 1*sisoem5
  wsi7 =~ 1*sisoem7
  wsi10 =~ 1*sisoem10
  wsi12 =~ 1*sisoem12
  
  # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a1, a1)*wad5 + c(d, d)*wsi5
  wsi7 ~ c(c, c)*wad5 + c(b1, b1)*wsi5
  
  wad10 ~ c(a2, a2)*wad7 + c(d, d)*wsi7
  wsi10 ~ c(c, c)*wad7 + c(b2, b2)*wsi7
  
  wad12 ~ c(a3, a3)*wad10 + c(d, d)*wsi10
  wsi12 ~ c(c, c)*wad10 + c(b3, b3)*wsi10 

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPM_inat.sex.lag.c.fit grouped by sex}
RICLPM_inat.sex.lag.c.fit <- lavaan(RICLPM_inat.sex.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPM_inat_lag.c.fit and RICLPM_inat.sex.lag.c.fit}
lavTestLRT(RICLPM_inat.lag.c.fit, RICLPM_inat.sex.lag.c.fit, method = "satorra.bentler.2010")
```

The chi-square difference test of these two nested models is *non significant* (p=0.2656). 

**However, there were no differences in significance in the cross-lagged paths so we conclude there are no sex differences in the constrained RICLPM mother report for inattention ADHD symptoms.** 

## Teacher report

### Total ADHD symptoms 

```{r specify RICLPMt_lag.c, class.source = 'fold-show'}
RICLPMt.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*tadhdet5 + 1*tadhdet7 + 1*tadhdet10 + 1*tadhdet12 #x
  RIsi =~ 1*sisoet5 + 1*sisoet7 + 1*sisoet10 + 1*sisoet12 #y

  # Create within-person centered variables
  wad5 =~ 1*tadhdet5
  wad7 =~ 1*tadhdet7
  wad10 =~ 1*tadhdet10 
  wad12 =~ 1*tadhdet12
  wsi5 =~ 1*sisoet5
  wsi7 =~ 1*sisoet7
  wsi10 =~ 1*sisoet10
  wsi12 =~ 1*sisoet12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across lags (all lags constrained). 
  wad7 ~ c(a1, a2)*wad5 + c(d1, d2)*wsi5 
  wsi7 ~ c(c1, c2)*wad5 + c(b1,b2)*wsi5
  
  wad10 ~ c(a1, a2)*wad7 + c(d1, d2)*wsi7
  wsi10 ~ c(c1,c2)*wad7 + c(b1,b2)*wsi7
  
  wad12 ~ c(a1, a2)*wad10 + c(d1,d2)*wsi10
  wsi12 ~ c(c1,c2)*wad10 + c(b1,b2)*wsi10

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMt.lag.c grouped by sex}
RICLPMt.lag.c.fit <- lavaan(RICLPMt.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

```{r specify RICLPMt.sex.lag.c, class.source = 'fold-show'}
RICLPMt.sex.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*tadhdet5 + 1*tadhdet7 + 1*tadhdet10 + 1*tadhdet12 #x
  RIsi =~ 1*sisoet5 + 1*sisoet7 + 1*sisoet10 + 1*sisoet12 #y

  # Create within-person centered variables
  wad5 =~ 1*tadhdet5
  wad7 =~ 1*tadhdet7
  wad10 =~ 1*tadhdet10 
  wad12 =~ 1*tadhdet12
  wsi5 =~ 1*sisoet5
  wsi7 =~ 1*sisoet7
  wsi10 =~ 1*sisoet10
  wsi12 =~ 1*sisoet12
  
  # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a, a)*wad5 + c(d, d)*wsi5
  wsi7 ~ c(c, c)*wad5 + c(b, b)*wsi5
  
  wad10 ~ c(a, a)*wad7 + c(d, d)*wsi7
  wsi10 ~ c(c, c)*wad7 + c(b, b)*wsi7
  
  wad12 ~ c(a, a)*wad10 + c(d, d)*wsi10
  wsi12 ~ c(c, c)*wad10 + c(b, b)*wsi10 
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMt.sex.lag.c grouped by sex}
RICLPMt.sex.lag.c.fit <- lavaan(RICLPMt.sex.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPMt.lag.c.fit and RICLPMt.sex.lag.c.fit}
lavTestLRT(RICLPMt.lag.c.fit, RICLPMt.sex.lag.c.fit, method = "satorra.bentler.2010")
```

The chi-square difference test of these two nested models is *NON significant* (p=0.5833). **Therefore, we conclude there are no sex differences in the constrained RICLPM teacher report, total ADHD symptoms.** 

### Hyperactivity

```{r specify RICLPMt_hyp.lag.c, class.source = 'fold-show'}
RICLPMt_hyp.lag.c  <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*hyet5 + 1*hyet7 + 1*hyet10 + 1*hyet12 #x
  RIsi =~ 1*sisoet5 + 1*sisoet7 + 1*sisoet10 + 1*sisoet12 #y

  # Create within-person centered variables
  wad5 =~ 1*hyet5
  wad7 =~ 1*hyet7
  wad10 =~ 1*hyet10 
  wad12 =~ 1*hyet12
  wsi5 =~ 1*sisoet5
  wsi7 =~ 1*sisoet7
  wsi10 =~ 1*sisoet10
  wsi12 =~ 1*sisoet12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/females, group2/males) - different values across groups, but the same values within groups and across lags (all lags constrained). 
  wad7 ~ c(a1, a2)*wad5 + c(d1, d2)*wsi5 
  wsi7 ~ c(c1, c2)*wad5 + c(b1,b2)*wsi5
  
  wad10 ~ c(a1, a2)*wad7 + c(d1, d2)*wsi7
  wsi10 ~ c(c1,c2)*wad7 + c(b1,b2)*wsi7
  
  wad12 ~ c(a1, a2)*wad10 + c(d1,d2)*wsi10
  wsi12 ~ c(c1,c2)*wad10 + c(b1,b2)*wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMt_hyp.lag.c grouped by sex}
RICLPMt_hyp.lag.c.fit <- lavaan(RICLPMt_hyp.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 

RICLPMt_hyp.lag.c.fit.summary <- summary(RICLPMt_hyp.lag.c.fit,
                                          fit.measures = TRUE,
                                          standardized = TRUE)

#Table of model fit 
RICLPMt_hyp.lag.c.fit.summary.fit <- table.model.fit(RICLPMt_hyp.lag.c.fit.summary)
# Table of regression and correlation (standardised covariances) coefficients
RICLPMt_hyp.lag.c.fit.summary.reg.female <- table.model.coef(RICLPMt_hyp.lag.c.fit.summary, sex = "Female", constraints = "Yes")
RICLPMt_hyp.lag.c.fit.summary.reg.male <- table.model.coef(RICLPMt_hyp.lag.c.fit.summary, sex = "Male", constraints = "Yes")
```

```{r specify RICLPMt_hyp.sex.lag.c, class.source = 'fold-show'}
RICLPMt_hyp.sex.lag.c  <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*hyet5 + 1*hyet7 + 1*hyet10 + 1*hyet12 #x
  RIsi =~ 1*sisoet5 + 1*sisoet7 + 1*sisoet10 + 1*sisoet12 #y

  # Create within-person centered variables
  wad5 =~ 1*hyet5
  wad7 =~ 1*hyet7
  wad10 =~ 1*hyet10 
  wad12 =~ 1*hyet12
  wsi5 =~ 1*sisoet5
  wsi7 =~ 1*sisoet7
  wsi10 =~ 1*sisoet10
  wsi12 =~ 1*sisoet12
  
  # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a, a)*wad5 + c(d, d)*wsi5
  wsi7 ~ c(c, c)*wad5 + c(b, b)*wsi5
  
  wad10 ~ c(a, a)*wad7 + c(d, d)*wsi7
  wsi10 ~ c(c, c)*wad7 + c(b, b)*wsi7
  
  wad12 ~ c(a, a)*wad10 + c(d, d)*wsi10
  wsi12 ~ c(c, c)*wad10 + c(b, b)*wsi10 
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMt_hyp.sex.lag.c grouped by sex}
RICLPMt_hyp.sex.lag.c.fit <- lavaan(RICLPMt_hyp.sex.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPMt_hyp.lag.c.fit and RICLPMt_hyp.sex.lag.c.fit}
lavTestLRT(RICLPMt_hyp.lag.c.fit, RICLPMt_hyp.sex.lag.c.fit, method = "satorra.bentler.2010")
```

The chi-square difference test of these two nested models is *non significant* (p=0.3255) but this was significant when using non-robust statistics (p=0.01516). 

### Inattention

```{r specify RICLPMt_inat.lag.c}
RICLPMt_inat.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*inet5 + 1*inet7 + 1*inet10 + 1*inet12 #x
  RIsi =~ 1*sisoet5 + 1*sisoet7 + 1*sisoet10 + 1*sisoet12 #y

  # Create within-person centered variables
  wad5 =~ 1*inet5
  wad7 =~ 1*inet7
  wad10 =~ 1*inet10 
  wad12 =~ 1*inet12
  wsi5 =~ 1*sisoet5
  wsi7 =~ 1*sisoet7
  wsi10 =~ 1*sisoet10
  wsi12 =~ 1*sisoet12
  
  # Constrained lagged effects between the within-person centered variables. c(group1/fetales, group2/males) - different values across groups, but the same values within groups and across lags. 
  wad7 ~ c(a1, a2)*wad5 + c(d1, d2)*wsi5 
  wsi7 ~ c(c1, c2)*wad5 + c(b1,b2)*wsi5
  
  wad10 ~ c(a1, a2)*wad7 + c(d1, d2)*wsi7
  wsi10 ~ c(c1,c2)*wad7 + c(b1,b2)*wsi7
  
  wad12 ~ c(a1, a2)*wad10 + c(d1,d2)*wsi10
  wsi12 ~ c(c1,c2)*wad10 + c(b1,b2)*wsi10
  
  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMt_inat.lag.c.fit split by sex}
RICLPMt_inat.lag.c.fit <- lavaan(RICLPMt_inat.lag.c, 
                      data = dat, 
                      missing = 'ML',
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

```{r specify RICLPMt_inat.sex.lag.c, class.source = 'fold-show'}
RICLPMt_inat.sex.lag.c <- '
  # Create between components (random intercepts treated as factors here)
  RIad =~ 1*inet5 + 1*inet7 + 1*inet10 + 1*inet12 #x
  RIsi =~ 1*sisoet5 + 1*sisoet7 + 1*sisoet10 + 1*sisoet12 #y

  # Create within-person centered variables
  wad5 =~ 1*inet5
  wad7 =~ 1*inet7
  wad10 =~ 1*inet10 
  wad12 =~ 1*inet12
  wsi5 =~ 1*sisoet5
  wsi7 =~ 1*sisoet7
  wsi10 =~ 1*sisoet10
  wsi12 =~ 1*sisoet12
  
  # Estimate the lagged effects between the within-person centered variables. Constrain the autoregressive effects across groups AND the lagged effects between the within-person centered variables. 
  wad7 ~ c(a, a)*wad5 + c(d, d)*wsi5
  wsi7 ~ c(c, c)*wad5 + c(b, b)*wsi5
  
  wad10 ~ c(a, a)*wad7 + c(d, d)*wsi7
  wsi10 ~ c(c, c)*wad7 + c(b, b)*wsi7
  
  wad12 ~ c(a, a)*wad10 + c(d, d)*wsi10
  wsi12 ~ c(c, c)*wad10 + c(b, b)*wsi10 

  # Estimate the covariance between the within-person centered variables at the first wave
  wad5 ~~ wsi5 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations)
  wad7 ~~ wsi7
  wad10 ~~ wsi10
  wad12 ~~ wsi12
  
  # Estimate the variance and covariance of the random intercepts
  RIad ~~ RIad
  RIsi ~~ RIsi
  RIad ~~ RIsi
  
  # Estimate the (residual) variance of the within-person centered variables.
  wad5 ~~ wad5 # Variances
  wsi5 ~~ wsi5 
  wad7 ~~ wad7 # Residual variances
  wsi7 ~~ wsi7 
  wad10 ~~ wad10 
  wsi10 ~~ wsi10 
  wad12 ~~ wad12 
  wsi12 ~~ wsi12
'
```

```{r fit RICLPMt_inat.sex.lag.c.fit grouped by sex}
RICLPMt_inat.sex.lag.c.fit <- lavaan(RICLPMt_inat.sex.lag.c, 
                      data = dat, 
                      missing = 'ML', 
                      group = "sex",
                      meanstructure = TRUE, 
                      int.ov.free = TRUE,
                      se = "robust",
                      estimator = "MLR" #maximum likelihood with robust (Huber-White) standard errors and a scaled (Yuan-Bentler) and robust test statistic
                      ) 
```

Now we see if there is a significantly worse fit when the lagged-parameters are constrained to be equal across groups. 

```{r LRT for RICLPMt_inat_lag.c.fit and RICLPMt_inat.sex.lag.c.fit}
lavTestLRT(RICLPMt_inat.lag.c.fit, RICLPMt_inat.sex.lag.c.fit, method = "satorra.bentler.2010")
```

The chi-square difference test of these two nested models is *non significant* (p=0.4818). 
